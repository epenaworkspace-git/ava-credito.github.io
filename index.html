<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solicitud de Crédito Vehicular – AVA</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<script src="https://www.google.com/recaptcha/api.js?render=6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV" async defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
:root{--p:#0A1F44;--a:#165DFF;--e:#E53935;--bd:#E0E0E0;--bg:#F8FAFC;--mid:#666;--lt:#999}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
input[type=text]:not([data-no-upper]),
input[type=tel]:not([data-no-upper]),
textarea:not([data-no-upper]){text-transform:uppercase}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:#333;min-height:100vh;transition:background-color 0.3s ease,color 0.3s ease}
.wrap{max-width:880px;margin:0 auto;padding:2rem 1.25rem 4rem}
.hdr{background:var(--p);border-radius:9px;padding:2rem;text-align:center;margin-bottom:1.75rem;box-shadow:0 8px 28px rgba(10,31,68,.18);transition:background 0.3s ease}
.hdr-logo{font-family:'DM Serif Display',serif;font-size:1.9rem;color:#fff;letter-spacing:.04em}
.hdr-logo span{color:#5B8EFF}
.hdr-sub{font-size:.95rem;color:rgba(255,255,255,.7);margin-top:.3rem;letter-spacing:.06em;text-transform:uppercase}
.prog{background:#fff;border-radius:9px;padding:1rem 1.2rem;margin-bottom:1.75rem;box-shadow:0 1px 4px rgba(0,0,0,.07);display:flex;align-items:center;transition:background 0.3s ease,border-color 0.3s ease}
.step{flex:1;display:flex;flex-direction:column;align-items:center;gap:.28rem;position:relative;cursor:pointer}
.step:not(:last-child)::after{content:'';position:absolute;top:15px;left:calc(50% + 16px);width:calc(100% - 32px);height:2px;background:var(--bd);z-index:0;transition:background .3s}
.step.done:not(:last-child)::after{background:var(--a)}
.sc{width:30px;height:30px;border-radius:50%;border:2px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:600;background:#fff;color:var(--lt);position:relative;z-index:1;transition:all .25s}
.step.active .sc{border-color:var(--a);background:var(--a);color:#fff;box-shadow:0 0 0 4px rgba(22,93,255,.15)}
.step.done .sc{border-color:var(--a);background:var(--a);color:#fff}
.sl{font-size:.6rem;font-weight:500;color:var(--lt);text-align:center;line-height:1.2;transition:color .2s}
.step.active .sl,.step.done .sl{color:var(--a)}
.card{background:#fff;border-radius:9px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden;transition:background 0.3s ease,box-shadow 0.3s ease}
.sec{padding:2rem;display:none}
.sec.active{display:block}
.sec-hdr{display:flex;align-items:center;gap:.7rem;padding-bottom:1.2rem;border-bottom:1px solid #EEF2F7;margin-bottom:1.75rem;border-top:3px solid var(--a);padding-top:.85rem}
.sec-ico{width:36px;height:36px;border-radius:8px;background:rgba(10,31,68,.06);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sec-ico svg{width:20px;height:20px;fill:var(--p)}
.sec-title{font-size:1.2rem;font-weight:700;color:var(--p)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:1.2rem}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1.2rem}
@media(max-width:680px){.grid,.grid3{grid-template-columns:1fr}}
.full{grid-column:1/-1}
.fg{display:flex;flex-direction:column;gap:.32rem}
.lbl{font-size:.8rem;font-weight:600;color:#333;letter-spacing:.02em;transition:color 0.3s ease}
.lbl.req::after{content:' *';color:var(--a)}
.note{font-size:.71rem;font-weight:400;color:var(--mid)}
input,select,textarea{width:100%;padding:.56rem .8rem;border:1.5px solid var(--bd);border-radius:7px;background:#fff;font-family:'DM Sans',sans-serif;font-size:.88rem;color:#333;outline:none;appearance:none;-webkit-appearance:none;transition:border-color .18s,box-shadow .18s,background 0.3s ease,color 0.3s ease}
input:focus,select:focus,textarea:focus{border-color:var(--a);box-shadow:0 0 0 3px rgba(22,93,255,.1)}
input.ok,select.ok{border-color:var(--a)}
input.bad,select.bad,textarea.bad{border-color:var(--e);box-shadow:0 0 0 3px rgba(229,57,53,.08)}
input:disabled,select:disabled{background:var(--bg);color:var(--lt);cursor:not-allowed;opacity:.7}
select{cursor:pointer;padding-right:2.2rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath fill='%23999' d='M6 8L0 0h12z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center}
textarea{resize:vertical;min-height:76px}
.em{font-size:.72rem;color:var(--e);font-weight:500;margin-top:.1rem}
.cond-block{overflow:hidden;transition:max-height .38s cubic-bezier(.4,0,.2,1),opacity .3s ease;max-height:0;opacity:0}
.cond-block.open{max-height:700px;opacity:1}
.dep-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:.75rem;margin-top:.5rem}
.dep-item{display:flex;flex-direction:column;gap:.28rem}
.dep-lbl{font-size:.75rem;font-weight:600;color:var(--p)}
.info-tag{display:inline-flex;align-items:center;gap:.3rem;font-size:.71rem;font-weight:600;background:rgba(22,93,255,.07);color:var(--a);border-radius:5px;padding:.2rem .55rem;margin-top:.3rem}
.cp-wr{position:relative}
.cp-spin{position:absolute;right:.8rem;top:50%;transform:translateY(-50%);width:15px;height:15px;border:2px solid rgba(22,93,255,.2);border-top-color:var(--a);border-radius:50%;animation:spin .65s linear infinite}
@keyframes spin{to{transform:translateY(-50%) rotate(360deg)}}
.cp-tag{font-size:.7rem;font-weight:600;background:rgba(10,31,68,.05);color:var(--p);border-radius:4px;padding:.16rem .48rem}
.cp-tag strong{color:var(--a)}
.autofill{border-color:var(--a) !important;background:rgba(22,93,255,.04) !important;color:var(--p) !important;font-weight:600}
.tel-wr{display:flex;align-items:stretch;border:1.5px solid var(--bd);border-radius:7px;overflow:hidden;background:#fff;transition:border-color .18s,box-shadow .18s,background 0.3s ease}
.tel-wr:focus-within{border-color:var(--a);box-shadow:0 0 0 3px rgba(22,93,255,.1)}
.tel-wr.bad{border-color:var(--e);box-shadow:0 0 0 3px rgba(229,57,53,.08)}
.tel-wr.ok{border-color:var(--a)}
.lada-sel{border:none;border-right:1.5px solid var(--bd);border-radius:0;background:#F4F6FA;padding:.56rem .5rem .56rem .72rem;font-size:.82rem;font-weight:600;color:var(--p);cursor:pointer;flex-shrink:0;min-width:86px;max-width:116px;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath fill='%23999' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .42rem center;padding-right:1.5rem;outline:none;transition:background .15s}
.lada-sel:focus{background-color:#EBF0FF}
.tel-num{border:none !important;border-radius:0 !important;flex:1;padding:.56rem .8rem;font-size:.88rem;outline:none;background:transparent !important;min-width:0;box-shadow:none !important}
.tel-num:focus{border:none !important;box-shadow:none !important}
.lada-sel:focus{box-shadow:none !important}
.ref{border:1.5px solid var(--bd);border-radius:9px;padding:1.1rem;margin-bottom:.85rem;transition:border-color .18s,background 0.3s ease}
.ref:focus-within{border-color:var(--a)}
.ref-t{font-size:.85rem;font-weight:600;color:#333;margin-bottom:.85rem;display:flex;align-items:center;gap:.4rem}
.ref-t::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--a)}
.sub-t{font-size:1.05rem;font-weight:700;color:var(--p);margin-bottom:.2rem}
.sub-n{font-size:.78rem;color:var(--mid);margin-bottom:.9rem}
.pay-box{border:1.5px solid var(--bd);border-radius:9px;padding:1.1rem;background:var(--bg);transition:border-color .18s,background 0.3s ease}
.pay-box:focus-within{border-color:var(--a)}
.pay-ttl{font-size:.82rem;font-weight:600;color:var(--p);margin-bottom:.85rem}
.pay-row{display:flex;gap:1rem;flex-wrap:wrap}
.radios{display:flex;flex-direction:column;gap:.55rem;min-width:148px}
.rlbl{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-size:.84rem;font-weight:500;padding:.45rem .7rem;border-radius:6px;border:1.5px solid var(--bd);background:#fff;transition:all .18s;user-select:none}
.rlbl:hover{border-color:var(--a)}
.rlbl input[type=radio]{display:none}
.rc{width:14px;height:14px;border-radius:50%;border:2px solid var(--bd);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .18s}
.rc::after{content:'';width:5px;height:5px;border-radius:50%;background:#fff;opacity:0;transition:opacity .18s}
.rlbl input:checked~.rc{border-color:var(--a);background:var(--a)}
.rlbl input:checked~.rc::after{opacity:1}
.rlbl:has(input:checked){border-color:var(--a);background:rgba(22,93,255,.05);color:var(--a)}
.pay-in{flex:1;min-width:185px}
.cur-wr{position:relative}
.cur-pre{position:absolute;left:.8rem;top:50%;transform:translateY(-50%);font-size:.84rem;font-weight:600;color:var(--mid);pointer-events:none}
.cur-wr input{padding-left:2.85rem}

/* ══ ADJUNTOS ══ */
.attach-wrap{border:2px solid var(--bd);border-radius:14px;background:#fff;overflow:hidden;transition:border-color 0.25s}
body.dark-mode .attach-wrap{background:#0d1a2e}
.attach-dropzone{border:none;border-bottom:2px dashed var(--bd);border-radius:0;padding:32px 20px 24px;text-align:center;cursor:pointer;transition:all 0.3s;background:transparent;position:relative;overflow:hidden}
.attach-dropzone:hover,.attach-dropzone.drag-over{background:rgba(22,93,255,.04)}
.attach-dropzone.drag-over{border-color:var(--a)}
.attach-dropzone.drag-over::before{content:'Suelta aquí';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--a);background:rgba(22,93,255,.06);z-index:2}
.attach-folder-icon{font-size:52px;margin-bottom:12px;display:block}
.attach-dropzone-text{font-size:14px;color:#555;line-height:1.6}
.attach-dropzone-text a{color:var(--a);font-weight:700;cursor:pointer;text-decoration:none}
.attach-dropzone-text a:hover{text-decoration:underline}
.attach-formats-line{font-size:12.5px;color:var(--lt);margin-top:5px}
.attach-auto-compress-line{font-size:12.5px;color:var(--a);font-weight:700;margin-top:4px}
.attach-limit-line{font-size:12.5px;color:var(--lt);margin-top:2px}
.attach-limit-line strong{color:#333}
.attach-realtime-stats{display:none;align-items:center;gap:10px;justify-content:center;margin:10px auto 0;font-size:13px;font-weight:600;color:#444;background:rgba(22,93,255,.06);border-radius:8px;padding:8px 20px;width:fit-content;min-width:220px}
.attach-realtime-stats.visible{display:flex}
.attach-stats-sep{color:var(--bd);font-weight:300}
.attach-capacity-wrap{padding:14px 16px 0;display:none}
.attach-capacity-wrap.visible{display:block}
.attach-capacity-header{display:flex;justify-content:space-between;margin-bottom:7px}
.attach-capacity-label{font-size:11px;font-weight:800;color:var(--p);text-transform:uppercase;letter-spacing:.5px}
.attach-capacity-value{font-size:12px;color:var(--mid);font-weight:500}
.attach-bar-track{height:9px;background:var(--bd);border-radius:99px;overflow:hidden}
.attach-bar-fill{height:100%;border-radius:99px;transition:width 0.4s ease;position:relative;overflow:hidden}
.attach-bar-fill::after{content:'';position:absolute;top:0;left:-60px;width:50px;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.45),transparent);animation:barShine2 1.8s infinite}
@keyframes barShine2{0%{left:-60px}100%{left:calc(100% + 20px)}}
.attach-bar-fill.green{background:linear-gradient(90deg,#0FC373,#12e080)}
.attach-bar-fill.yellow{background:linear-gradient(90deg,#F59E0B,#fbbf24)}
.attach-bar-fill.red{background:linear-gradient(90deg,#FF4757,#ff6370);animation:none}
.attach-bar-fill.red::after{display:none}
.attach-status{margin-top:6px;font-size:12.5px;display:flex;align-items:center;gap:6px;padding-bottom:14px}
.attach-status-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.attach-status-dot.green{background:#0FC373}
.attach-status-dot.yellow{background:#F59E0B}
.attach-status-dot.red{background:#FF4757;animation:pulse-red 1s infinite}
@keyframes pulse-red{0%,100%{opacity:1}50%{opacity:0.4}}
.attach-error-msg{background:rgba(255,71,87,.08);border:1.5px solid rgba(255,71,87,.3);border-radius:10px;padding:10px 14px;font-size:12.5px;color:#d93546;margin:10px 16px 0;display:none;align-items:center;gap:8px}
.attach-error-msg.show{display:flex}
.attach-legibility{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:14px 16px 0}
.attach-leg-card{display:flex;align-items:flex-start;gap:10px;border-radius:10px;padding:11px 13px;font-size:12px;line-height:1.5}
.attach-leg-card.ok{background:#f0faf5;border:1.5px solid #a7e8c7}
.attach-leg-card.bad{background:#fff5f5;border:1.5px solid #fca5a5}
.attach-leg-icon{width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;margin-top:1px}
.attach-leg-card.ok .attach-leg-icon{background:#0FC373;color:#fff}
.attach-leg-card.bad .attach-leg-icon{background:#EF4444;color:#fff}
.attach-leg-title{font-weight:800;font-size:12px;letter-spacing:.4px;text-transform:uppercase;margin-bottom:2px}
.attach-leg-card.ok .attach-leg-title{color:#065f46}
.attach-leg-card.bad .attach-leg-title{color:#991b1b}
.attach-leg-desc{color:#666;font-size:11.5px}
.attach-docs-required{border:2px solid #dbeafe;border-radius:12px;background:#eff6ff;padding:14px 18px 12px;margin-top:10px;margin-bottom:2px}
.attach-docs-title{display:flex;align-items:center;gap:8px;font-size:12.5px;font-weight:800;color:#1e40af;letter-spacing:.5px;text-transform:uppercase;margin-bottom:10px}
.attach-docs-icon{font-size:15px}
.attach-docs-list{list-style:none;display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
.attach-docs-list li{display:flex;align-items:flex-start;flex-wrap:wrap;gap:6px;font-size:13px;line-height:1.5}
.attach-docs-badge{display:inline-flex;align-items:center;background:#165DFF;color:#fff;font-size:10.5px;font-weight:700;border-radius:4px;padding:1px 7px;letter-spacing:.3px;text-transform:uppercase;flex-shrink:0;margin-top:2px}
.attach-docs-name{font-weight:700;color:#1e3a8a}
.attach-docs-desc{font-size:12px;color:#4b6cb0;flex-basis:100%;padding-left:1px}
.attach-docs-note{font-size:12px;color:#374151;line-height:1.6;background:rgba(255,255,255,.65);border-radius:8px;padding:8px 12px;display:flex;align-items:flex-start;gap:6px;border:1px solid #c7d8f7}
.attach-docs-note-icon{font-size:13px;flex-shrink:0;margin-top:1px}
.attach-docs-note strong{color:#1e40af}
body.dark-mode .attach-docs-required{background:#0d1f40;border-color:#1e3a6e}
body.dark-mode .attach-docs-title{color:#93c5fd}
body.dark-mode .attach-docs-name{color:#bfdbfe}
body.dark-mode .attach-docs-desc{color:#7aa3d4}
body.dark-mode .attach-docs-note{background:rgba(30,58,138,.25);border-color:#1e3a6e;color:#c8d6f0}
body.dark-mode .attach-docs-note strong{color:#93c5fd}
.attach-file-list{padding:12px 16px;display:flex;flex-direction:column;gap:8px}
.attach-file-list:empty{padding:0}
.attach-file-item{display:flex;align-items:center;gap:10px;background:#fafbfc;border:1px solid var(--bd);border-radius:10px;padding:10px 13px;transition:border-color .15s}
.attach-file-item:hover{border-color:#c0cce0}
body.dark-mode .attach-file-item{background:#0f1c32}
.attach-file-icon{font-size:18px;flex-shrink:0}
.attach-file-name{flex:1;font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#333}
body.dark-mode .attach-file-name{color:#c8d6f0}
.attach-file-size{font-size:12px;color:var(--lt);flex-shrink:0;margin-right:4px}
.attach-file-remove{width:26px;height:26px;border-radius:50%;border:none;background:rgba(255,71,87,.1);color:#FF4757;cursor:pointer;font-size:15px;font-weight:700;transition:all 0.2s;display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:1}
.attach-file-remove:hover{background:#FF4757;color:#fff;transform:scale(1.1)}
.offline-msg{background:rgba(255,71,87,.08);border:1.5px solid rgba(255,71,87,.25);border-radius:10px;padding:10px 14px;font-size:12.5px;color:#d93546;margin-top:10px;display:none;align-items:center;gap:8px}
.offline-msg.show{display:flex}

/* ══ COMPRESIÓN ══ */
.compress-progress{display:none;border:1.5px solid var(--bd);border-radius:14px;overflow:hidden;margin-top:14px}
.compress-progress.show{display:block}
.compress-header{background:var(--p);padding:12px 16px;display:flex;align-items:center;gap:8px}
.compress-header-text{font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:#fff}
.compress-pct{font-weight:700;color:#5B8EFF;font-size:12.5px;margin-left:auto}
.compress-body{padding:14px 16px;background:#fff}
.compress-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.compress-stat{text-align:center}
.compress-stat-val{font-size:16px;font-weight:800;color:var(--p)}
.compress-stat-label{font-size:10.5px;color:var(--lt);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.compress-bar-track{height:8px;background:var(--bd);border-radius:99px;overflow:hidden;margin-bottom:8px}
.compress-bar-fill{height:100%;background:linear-gradient(90deg,#165DFF,#3a7fff);border-radius:99px;width:0%;transition:width 0.3s ease;position:relative;overflow:hidden}
.compress-bar-fill::after{content:'';position:absolute;top:0;left:-60px;width:50px;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);animation:barShine 1.5s infinite}
.compress-info{display:flex;justify-content:space-between;font-size:11.5px;color:var(--lt)}
.compress-resume-note{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.3);border-radius:8px;padding:8px 12px;font-size:12px;color:#92400e;margin-top:8px;display:none;align-items:center;gap:6px}
.compress-resume-note.show{display:flex}

/* ══════════════════════════════════════════════════════
   SUMMARY — NUEVO DISEÑO
   ══════════════════════════════════════════════════════ */
.sumbox{
  background:#fff;
  border:1.5px solid var(--bd);
  border-radius:12px;
  overflow:hidden;
  margin-bottom:1.4rem;
  box-shadow:0 2px 16px rgba(10,31,68,.07);
  transition:background 0.3s ease,border-color 0.3s ease;
}

.sum-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:1rem 1.35rem .9rem;
  background:linear-gradient(135deg,var(--p) 0%,#0e2a60 100%);
  position:relative;
  overflow:hidden;
}
.sum-header::before{
  content:'';
  position:absolute;
  top:-28px;right:-28px;
  width:110px;height:110px;
  border-radius:50%;
  background:radial-gradient(circle,rgba(91,142,255,.25) 0%,transparent 70%);
  pointer-events:none;
}
.sum-header-left{
  display:flex;
  align-items:center;
  gap:.65rem;
  position:relative;
  z-index:1;
}
.sum-header-icon{
  width:34px;height:34px;
  border-radius:8px;
  background:rgba(255,255,255,.12);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.sum-header-icon svg{width:17px;height:17px;fill:#fff}
.sum-ttl{
  font-size:.82rem;font-weight:800;
  color:#fff;
  letter-spacing:.07em;text-transform:uppercase;
}
.sum-ttl-sub{
  font-size:.68rem;
  color:rgba(255,255,255,.55);
  font-weight:400;margin-top:.1rem;
}
.sum-badge{
  display:inline-flex;align-items:center;gap:.35rem;
  background:rgba(15,195,115,.18);
  border:1px solid rgba(15,195,115,.4);
  border-radius:99px;
  padding:.26rem .72rem;
  font-size:.68rem;font-weight:700;
  color:#6eeabb;
  letter-spacing:.04em;text-transform:uppercase;
  position:relative;z-index:1;
}
.sum-badge-dot{
  width:6px;height:6px;border-radius:50%;
  background:#0FC373;
  animation:pulseDot 2s ease-in-out infinite;
}
@keyframes pulseDot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.75)}}

.sum-body{}

.sum-group{padding:.9rem 1.35rem}
.sum-group+.sum-group{border-top:1px solid #EEF2F7}
.sum-group-label{
  display:flex;align-items:center;gap:.45rem;
  margin-bottom:.7rem;
}
.sum-group-label-icon{font-size:.88rem}
.sum-group-label-text{
  font-size:.68rem;font-weight:800;
  color:var(--a);
  letter-spacing:.1em;text-transform:uppercase;
}

.sum-row{
  display:flex;align-items:baseline;
  gap:.5rem;font-size:.8rem;line-height:1.9;
}
.sum-k{
  color:var(--mid);font-weight:500;
  min-width:148px;flex-shrink:0;
  font-size:.77rem;
}
.sum-v{
  color:#1a1a2e;font-weight:600;
  font-size:.82rem;word-break:break-word;
}
.sum-v--empty{
  color:var(--lt);font-weight:400;font-style:italic;
}

.sum-chip{
  display:inline-flex;align-items:center;gap:.3rem;
  background:rgba(22,93,255,.08);
  color:var(--a);
  border:1px solid rgba(22,93,255,.18);
  border-radius:99px;
  padding:.15rem .65rem;
  font-size:.72rem;font-weight:700;
  letter-spacing:.03em;
}
.sum-chip--files{
  background:rgba(15,195,115,.09);
  color:#0a7a49;
  border-color:rgba(15,195,115,.25);
}
.sum-chip--amount{
  background:rgba(245,158,11,.09);
  color:#92400e;
  border-color:rgba(245,158,11,.25);
}

.sum-footer{
  border-top:1px solid #EEF2F7;
  padding:.85rem 1.35rem;
  background:#FAFBFD;
  display:flex;align-items:flex-start;gap:.65rem;
}
.sum-footer-icon{font-size:1rem;flex-shrink:0;margin-top:.05rem}
.sum-footer-text{font-size:.73rem;color:var(--mid);line-height:1.65}
.sum-footer-text strong{color:var(--p);font-weight:700}

.sum-skeleton-row{display:flex;gap:.75rem;padding:.4rem 0;align-items:center}
.sum-skeleton-k,.sum-skeleton-v{height:13px;border-radius:6px;background:linear-gradient(90deg,#eef0f4 25%,#f8f9fb 50%,#eef0f4 75%);background-size:200% 100%;animation:shimmer 1.4s infinite}
.sum-skeleton-k{width:100px;flex-shrink:0}
.sum-skeleton-v{flex:1;max-width:220px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* ══ DECLARACIÓN ══ */
.decl-box{border:2px solid var(--bd);border-radius:9px;padding:1.25rem 1.4rem;margin-top:1.5rem;background:#fff;transition:border-color .2s,background .2s}
.decl-box.ok{border-color:var(--a);background:rgba(22,93,255,.03)}
.decl-box.bad{border-color:var(--e);background:rgba(229,57,53,.03)}
.decl-head{font-size:.78rem;font-weight:700;color:var(--p);letter-spacing:.04em;text-transform:uppercase;margin-bottom:.75rem;display:flex;align-items:center;gap:.45rem}
.decl-head::before{content:'';display:inline-block;width:3px;height:14px;background:var(--a);border-radius:2px;flex-shrink:0}
.decl-row{display:flex;align-items:flex-start;gap:.9rem;cursor:pointer;user-select:none}
.chk-vis{width:20px;height:20px;min-width:20px;border:2px solid var(--bd);border-radius:5px;display:flex;align-items:center;justify-content:center;transition:all .18s;background:#fff;margin-top:.12rem}
.chk-vis.on{background:var(--a);border-color:var(--a)}
.chk-vis svg{width:11px;height:11px;fill:none;stroke:#fff;stroke-width:2.2;stroke-linecap:round;stroke-linejoin:round;opacity:0;transition:opacity .15s}
.chk-vis.on svg{opacity:1}
.decl-text{font-size:.82rem;color:#444;line-height:1.72}
.decl-text a{color:var(--a);font-weight:600;text-decoration:none}
.decl-text a:hover{text-decoration:underline}
.decl-req{font-size:.7rem;font-weight:600;color:var(--a);background:rgba(22,93,255,.07);border-radius:4px;padding:.12rem .42rem;margin-left:.35rem;vertical-align:middle}

/* ══ NAV ══ */
.nav{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:1.35rem 2rem;background:#FAFBFD;border-top:1px solid #EEF2F7;transition:background 0.3s ease,border-color 0.3s ease}
.btn{display:inline-flex;align-items:center;gap:.42rem;padding:.6rem 1.6rem;border-radius:7px;font-family:'DM Sans',sans-serif;font-size:.87rem;font-weight:600;cursor:pointer;border:2px solid transparent;transition:all .18s;user-select:none}
.btn-p{background:var(--p);color:#fff;border-color:var(--p)}
.btn-p:hover:not(:disabled){background:var(--a);border-color:var(--a);box-shadow:0 4px 14px rgba(22,93,255,.28)}
.btn-p:disabled{background:var(--bd);color:var(--lt);border-color:var(--bd);cursor:not-allowed}
.btn-s{background:var(--p);color:#fff;border-color:var(--p);font-size:.9rem;padding:.68rem 1.9rem;letter-spacing:.04em;text-transform:uppercase}
.btn-s:hover:not(:disabled){background:var(--a);border-color:var(--a);box-shadow:0 4px 16px rgba(22,93,255,.3)}
.btn-s:disabled{background:var(--bd);color:var(--lt);border-color:var(--bd);cursor:not-allowed;box-shadow:none}
.btn-s[disabled]{position:relative}
.btn-s[disabled]::after{content:'Marca la declaración para habilitar el envío';position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:rgba(10,31,68,.92);color:#fff;font-size:.72rem;font-weight:500;padding:.35rem .75rem;border-radius:6px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .2s;letter-spacing:.01em}
.btn-s[disabled]:hover::after{opacity:1}
.btn svg{width:14px;height:14px;fill:currentColor}
.step-ind{font-size:.79rem;color:var(--mid);font-weight:500}
.s-ov{position:fixed;inset:0;background:rgba(10,31,68,.62);backdrop-filter:blur(5px);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.1rem;z-index:9998;opacity:0;visibility:hidden;transition:.25s}
.s-ov.on{opacity:1;visibility:visible}
.s-ring{width:46px;height:46px;border:4px solid rgba(255,255,255,.22);border-top-color:#fff;border-radius:50%;animation:ringspin .7s linear infinite}
@keyframes ringspin{to{transform:rotate(360deg)}}
.s-msg{font-size:.95rem;font-weight:600;color:#fff;letter-spacing:.03em}

/* ══ THEME TOGGLE ══ */
.theme-toggle-btn{position:fixed;top:20px;right:20px;z-index:2000;width:52px;height:52px;border-radius:50%;background:linear-gradient(145deg,#e8ecf4,#d0d6e8);box-shadow:0 6px 20px rgba(0,0,0,.18),inset 0 -2px 4px rgba(0,0,0,.15),inset 0 2px 4px rgba(255,255,255,.9);cursor:pointer;border:none;outline:none;overflow:hidden;transition:all 0.3s ease;animation:subtlePulse 3s infinite ease-in-out}
.theme-toggle-btn::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.75) 0%,rgba(255,255,255,0) 65%);opacity:0;transition:opacity 0.4s ease;pointer-events:none}
.theme-toggle-btn:hover::before{opacity:1}
.theme-toggle-btn:hover{animation:none;transform:scale(1.08)}
.theme-toggle-btn:active{transform:scale(0.94)}
@keyframes subtlePulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
.toggle-icon-wrap{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1)}
.theme-toggle-btn:hover .toggle-icon-wrap{transform:rotate(20deg)}
.icon-sun,.icon-moon{position:absolute;width:28px;height:28px;transition:all 0.45s cubic-bezier(0.68,-0.55,0.265,1.55)}
.icon-sun{opacity:1;transform:scale(1) rotate(0deg);filter:drop-shadow(0 0 4px rgba(255,215,0,.6))}
.icon-moon{opacity:0;transform:scale(0.4) rotate(-80deg);filter:drop-shadow(0 0 4px rgba(100,120,255,.6))}
body.dark-mode .icon-sun{opacity:0;transform:scale(0.4) rotate(80deg)}
body.dark-mode .icon-moon{opacity:1;transform:scale(1) rotate(0deg)}
body.dark-mode .theme-toggle-btn{background:linear-gradient(145deg,#1e2d50,#0f1d38);box-shadow:0 6px 20px rgba(0,0,0,.4),0 0 15px rgba(65,105,225,.3),inset 0 -2px 4px rgba(0,0,0,.4),inset 0 2px 4px rgba(255,255,255,.06)}

/* ══ DARK MODE ══ */
body.dark-mode{background:#0c1525;color:#d0d8ec}
body.dark-mode .hdr{background:#0a1535}
body.dark-mode .prog{background:#111f3a;box-shadow:0 1px 4px rgba(0,0,0,.3)}
body.dark-mode .sc{background:#111f3a;border-color:#2a3a5c;color:#7a8fb0}
body.dark-mode .sl{color:#4a5878}
body.dark-mode .step.active .sc,body.dark-mode .step.done .sc{background:var(--a);border-color:var(--a);color:#fff}
body.dark-mode .step.active .sl,body.dark-mode .step.done .sl{color:var(--a)}
body.dark-mode .step:not(:last-child)::after{background:#2a3a5c}
body.dark-mode .step.done:not(:last-child)::after{background:var(--a)}
body.dark-mode .card{background:#111f3a;box-shadow:0 2px 12px rgba(0,0,0,.4)}
body.dark-mode .sec-hdr{border-bottom-color:#1e2d50}
body.dark-mode .sec-ico{background:rgba(255,255,255,.05)}
body.dark-mode .sec-ico svg{fill:#7a8fb0}
body.dark-mode .sec-title{color:#c8d6f0}
body.dark-mode .lbl{color:#7a8fb0}
body.dark-mode .note{color:#4a5878}
body.dark-mode input,body.dark-mode select,body.dark-mode textarea{background:#162040;border-color:#243660;color:#d0d8ec}
body.dark-mode input:focus,body.dark-mode select:focus,body.dark-mode textarea:focus{background:#1a2850;border-color:var(--a);box-shadow:0 0 0 3px rgba(77,138,255,.15)}
body.dark-mode input::placeholder,body.dark-mode textarea::placeholder{color:#3a4e70}
body.dark-mode input:disabled,body.dark-mode select:disabled{background:#0f1a30;color:#3a4e70}
body.dark-mode select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath fill='%234a5878' d='M6 8L0 0h12z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center;background-color:#162040}
body.dark-mode .tel-wr{background:#162040;border-color:#243660}
body.dark-mode .lada-sel{background-color:#1a2850;color:#c8d6f0;border-right-color:#243660;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath fill='%234a5878' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .42rem center}
body.dark-mode .lada-sel:focus{background-color:#1e2f5a}
body.dark-mode .tel-num{color:#d0d8ec}
body.dark-mode .ref{background:#0e1a30;border-color:#1e2d50}
body.dark-mode .ref-t{color:#c8d6f0}
body.dark-mode .sub-t{color:#c8d6f0}
body.dark-mode .sub-n{color:#4a5878}
body.dark-mode .pay-box{background:#0e1a30;border-color:#1e2d50}
body.dark-mode .pay-ttl{color:#c8d6f0}
body.dark-mode .rlbl{background:#162040;border-color:#243660;color:#c8d6f0}
body.dark-mode .rlbl:hover{border-color:var(--a)}
body.dark-mode .rlbl:has(input:checked){background:rgba(22,93,255,.15);color:#6ba3ff;border-color:var(--a)}
body.dark-mode .rc{border-color:#3a4e70}
body.dark-mode .cur-pre{color:#4a5878}
body.dark-mode .attach-wrap{border-color:#1e2d50}
body.dark-mode .attach-dropzone{background:#0e1a30;border-color:#2a3a5c}
body.dark-mode .attach-dropzone:hover{background:rgba(22,93,255,.05);border-color:var(--a)}
body.dark-mode .attach-dropzone-text{color:#7a8fb0}
body.dark-mode .attach-formats-line,body.dark-mode .attach-limit-line{color:#3a4e70}
body.dark-mode .attach-limit-line strong{color:#8fa3c8}
body.dark-mode .attach-capacity-header{color:#c8d6f0}
body.dark-mode .attach-capacity-value{color:#7a8fb0}
body.dark-mode .attach-capacity-label{color:#8fa3c8}
body.dark-mode .attach-bar-track{background:#243660}
body.dark-mode .attach-file-item{background:#162040;border-color:#243660;color:#c8d6f0}
body.dark-mode .attach-file-size{color:#4a5878}
body.dark-mode .attach-realtime-stats{background:rgba(22,93,255,.1);color:#c8d6f0}
body.dark-mode .attach-leg-card.ok{background:#0d2218;border-color:#166534}
body.dark-mode .attach-leg-card.bad{background:#2a0e0e;border-color:#7f1d1d}
body.dark-mode .attach-leg-card.ok .attach-leg-title{color:#86efac}
body.dark-mode .attach-leg-card.bad .attach-leg-title{color:#fca5a5}
body.dark-mode .attach-leg-desc{color:#6b7a99}
body.dark-mode .compress-body{background:#111f3a}
body.dark-mode .compress-header{background:#0a1535}
body.dark-mode .compress-stat-val{color:#c8d6f0}
body.dark-mode .compress-bar-track{background:#243660}
body.dark-mode .compress-info{color:#4a5878}
body.dark-mode .compress-progress{border-color:#1e2d50}

/* Dark mode — SUMMARY rediseñado */
body.dark-mode .sumbox{background:#111f3a;border-color:#1e2d50}
body.dark-mode .sum-group+.sum-group{border-top-color:#1e2d50}
body.dark-mode .sum-group-label-text{color:#6ba3ff}
body.dark-mode .sum-k{color:#4a5878}
body.dark-mode .sum-v{color:#c8d6f0}
body.dark-mode .sum-v--empty{color:#3a4e70}
body.dark-mode .sum-footer{border-top-color:#1e2d50;background:#0e1a30}
body.dark-mode .sum-footer-text{color:#4a5878}
body.dark-mode .sum-footer-text strong{color:#c8d6f0}
body.dark-mode .sum-chip{background:rgba(22,93,255,.15);color:#6ba3ff;border-color:rgba(22,93,255,.3)}
body.dark-mode .sum-chip--files{background:rgba(15,195,115,.12);color:#6eeabb;border-color:rgba(15,195,115,.3)}
body.dark-mode .sum-chip--amount{background:rgba(245,158,11,.12);color:#fcd34d;border-color:rgba(245,158,11,.3)}
body.dark-mode .sum-skeleton-k,body.dark-mode .sum-skeleton-v{background:linear-gradient(90deg,#1a2a48 25%,#1e3258 50%,#1a2a48 75%);background-size:200% 100%}

body.dark-mode .decl-box{background:#0e1a30;border-color:#1e2d50}
body.dark-mode .decl-box.ok{background:rgba(22,93,255,.08);border-color:var(--a)}
body.dark-mode .decl-box.bad{background:rgba(229,57,53,.08)}
body.dark-mode .decl-head{color:#c8d6f0}
body.dark-mode .decl-text{color:#7a8fb0}
body.dark-mode .chk-vis{background:#162040;border-color:#3a4e70}
body.dark-mode .nav{background:#0e1a30;border-top-color:#1e2d50}
body.dark-mode .step-ind{color:#4a5878}
body.dark-mode .btn-p{background:#1e3060;border-color:#1e3060}
body.dark-mode .btn-p:hover:not(:disabled){background:var(--a);border-color:var(--a)}
body.dark-mode .btn-s{background:var(--a);border-color:var(--a)}
body.dark-mode .info-tag{background:rgba(22,93,255,.15);color:#6ba3ff}
body.dark-mode .dep-lbl{color:#6ba3ff}
body.dark-mode .autofill{background:rgba(22,93,255,.08) !important;color:#6ba3ff !important;border-color:var(--a) !important}
body.dark-mode #cpErrBox{background:rgba(229,57,53,.1);border-color:rgba(229,57,53,.3);color:#ff8a80}
body.dark-mode #cpRetry{background:#1e3060}
body.dark-mode #colRegLbl{color:#4a5878}
body.dark-mode #colSel{background:rgba(22,93,255,.1) !important;color:#6ba3ff !important;border-color:var(--a) !important}

body,.prog,.card,.sec,.sec-hdr,.lbl,input,select,textarea,.ref,.pay-box,.rlbl,.attach-dropzone,.attach-file-item,.sumbox,.decl-box,.nav,.hdr,.sc,.dep-lbl{transition:background-color 0.3s ease,border-color 0.3s ease,color 0.3s ease}

/* ══ FLOATING PROGRESS ══ */
.form-progress-wrap{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);z-index:1500;display:none;width:calc(100% - 200px);max-width:720px;min-width:280px;pointer-events:none}
.form-progress-wrap.visible{display:block}
.form-progress-pill{background:#ffffff;border-radius:60px;padding:10px 20px 10px 16px;display:flex;align-items:center;gap:14px;box-shadow:0 4px 24px rgba(10,31,68,.14),0 1px 4px rgba(10,31,68,.08);border:1px solid rgba(10,31,68,.07);transition:background 0.3s ease,border-color 0.3s ease,box-shadow 0.3s ease}
.form-progress-bar-track{flex:1;height:8px;background:#E8ECF4;border-radius:99px;overflow:hidden;position:relative;transition:background 0.3s ease}
.form-progress-bar-fill{height:100%;background:linear-gradient(90deg,#165DFF 0%,#3a7fff 100%);border-radius:99px;width:0%;transition:width 0.45s cubic-bezier(0.4,0,0.2,1);position:relative}
.form-progress-bar-fill::after{content:'';position:absolute;top:0;left:-60px;width:50px;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.55),transparent);animation:barShine 2.2s ease-in-out infinite}
@keyframes barShine{0%{left:-60px;opacity:0}10%{opacity:1}90%{opacity:1}100%{left:calc(100% + 20px);opacity:0}}
.form-progress-text{font-size:12.5px;font-weight:500;color:#6B7A99;white-space:nowrap;flex-shrink:0;min-width:130px;text-align:right;transition:color 0.3s ease}
.form-progress-text strong{color:#165DFF;font-weight:700}
body.dark-mode .form-progress-pill{background:#1a2645;border-color:rgba(255,255,255,.12);box-shadow:0 4px 28px rgba(0,0,0,.55),0 1px 4px rgba(0,0,0,.35)}
body.dark-mode .form-progress-bar-track{background:#263558}
body.dark-mode .form-progress-bar-fill{background:linear-gradient(90deg,#4d8aff 0%,#78b0ff 100%)}
body.dark-mode .form-progress-text{color:#c8d6f0;font-weight:600}
body.dark-mode .form-progress-text strong{color:#78b0ff;font-weight:800}

/* ══ MODALES MOTIVACIONALES ══ */
.motiv-overlay{position:fixed;inset:0;background:rgba(8,18,42,.65);backdrop-filter:blur(8px);z-index:8000;display:none;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity 0.3s}
.motiv-overlay.show{display:flex;opacity:1;pointer-events:all}
.motiv-card{background:#ffffff;border-radius:28px;width:100%;max-width:400px;box-shadow:0 32px 80px rgba(10,31,68,.3),0 8px 24px rgba(10,31,68,.14);overflow:hidden;transform:scale(0.85) translateY(30px);transition:transform 0.45s cubic-bezier(0.34,1.56,0.64,1)}
.motiv-overlay.show .motiv-card{transform:scale(1) translateY(0)}
.motiv-card-top{padding:36px 32px 24px;position:relative;overflow:hidden}
.motiv-deco{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.motiv-deco::before{content:'';position:absolute;top:-50px;right:-50px;width:180px;height:180px;border-radius:50%;background:radial-gradient(circle,rgba(22,93,255,.09) 0%,transparent 70%)}
.motiv-deco::after{content:'';position:absolute;bottom:-35px;left:-35px;width:140px;height:140px;border-radius:50%;background:radial-gradient(circle,rgba(22,93,255,.06) 0%,transparent 70%)}
.motiv-emoji-3d{font-size:64px;line-height:1;margin-bottom:14px;display:block;filter:drop-shadow(0 6px 14px rgba(0,0,0,.18));animation:emojiBounce 0.55s 0.1s cubic-bezier(0.34,1.56,0.64,1) both}
@keyframes emojiBounce{from{opacity:0;transform:scale(0.3) translateY(-20px) rotate(-15deg)}to{opacity:1;transform:scale(1) translateY(0) rotate(0deg)}}
.motiv-title{font-size:22px;font-weight:800;color:#0A1F44;margin-bottom:8px;line-height:1.2}
.motiv-text{font-size:14px;color:#6B7A99;line-height:1.65}
.motiv-card-bottom{padding:20px 28px 28px}
.motiv-btn{width:100%;padding:15px 24px;border:none;border-radius:14px;font-size:15px;font-weight:700;cursor:pointer;transition:all 0.25s;letter-spacing:.3px;font-family:'DM Sans',sans-serif}
.motiv-btn:hover{transform:translateY(-2px);filter:brightness(1.08)}
.motiv-btn-25{background:linear-gradient(135deg,#165DFF,#3a7fff);color:#fff;box-shadow:0 6px 20px rgba(22,93,255,.35)}
.motiv-btn-50{background:linear-gradient(135deg,#0FC373,#0a9e5c);color:#fff;box-shadow:0 6px 20px rgba(15,195,115,.35)}
.motiv-btn-75{background:linear-gradient(135deg,#F59E0B,#d97706);color:#fff;box-shadow:0 6px 20px rgba(245,158,11,.35)}
.motiv-btn-100{background:linear-gradient(135deg,#165DFF 0%,#ff4b6e 100%);color:#fff;box-shadow:0 6px 20px rgba(22,93,255,.4)}
body.dark-mode .motiv-card{background:#111f3a}
body.dark-mode .motiv-title{color:#c8d6f0}
body.dark-mode .motiv-text{color:#7a8fb0}

/* ══ MODAL ÉXITO ══ */
.success-overlay{display:none;position:fixed;inset:0;background:rgba(8,18,42,.75);backdrop-filter:blur(6px);z-index:9000;align-items:center;justify-content:center;padding:20px}
.success-overlay.show{display:flex}
.success-card{background:#ffffff;border-radius:28px;width:100%;max-width:460px;box-shadow:0 32px 80px rgba(10,31,68,.28),0 8px 24px rgba(10,31,68,.12);animation:popIn 0.45s cubic-bezier(0.34,1.56,0.64,1);overflow:hidden}
@keyframes popIn{from{opacity:0;transform:scale(0.8) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.success-header{background:linear-gradient(135deg,#0A1F44 0%,#0e2a60 100%);padding:40px 40px 36px;position:relative;overflow:hidden;text-align:center}
.success-header::before{content:'';position:absolute;top:-40px;right:-40px;width:180px;height:180px;border-radius:50%;background:radial-gradient(circle,rgba(22,93,255,.35) 0%,transparent 70%)}
.success-header::after{content:'';position:absolute;bottom:-30px;left:-30px;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,rgba(22,93,255,.2) 0%,transparent 70%)}
.success-checkmark{width:72px;height:72px;background:linear-gradient(135deg,#165DFF,#0FC373);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;position:relative;z-index:1;box-shadow:0 8px 24px rgba(15,195,115,.4);animation:checkPop 0.5s 0.3s cubic-bezier(0.34,1.56,0.64,1) both}
.success-checkmark svg{width:36px;height:36px}
@keyframes checkPop{from{transform:scale(0) rotate(-20deg)}to{transform:scale(1) rotate(0deg)}}
.success-title{font-size:24px;font-weight:800;color:#fff;margin-bottom:8px;position:relative;z-index:1}
.success-subtitle{font-size:13px;color:rgba(255,255,255,.6);letter-spacing:1.5px;text-transform:uppercase;position:relative;z-index:1}
.success-body{padding:28px 32px 32px}
.success-info-row{display:flex;align-items:flex-start;gap:14px;background:#F4F6FB;border-radius:14px;padding:16px 18px;margin-bottom:12px}
.success-info-icon{width:38px;height:38px;border-radius:10px;background:rgba(22,93,255,.1);display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
.success-info-icon svg{width:18px;height:18px}
.success-info-text{font-size:13px;color:#6B7A99;line-height:1.6}
.success-info-text strong{display:block;color:#333;font-size:14px;font-weight:700;margin-bottom:4px}
.success-contact-list{display:flex;flex-direction:column;gap:6px;margin-top:6px}
.success-contact-item{display:flex;align-items:center;gap:8px;font-size:13px;color:#444;font-weight:500}
.success-contact-item a{color:#165DFF;text-decoration:none;font-weight:600}
.success-divider{height:1px;background:#E8ECF4;margin:20px 0}
.success-close-btn{width:100%;background:linear-gradient(135deg,#165DFF,#0e46cc);color:#fff;border:none;border-radius:14px;padding:16px 28px;font-size:15px;font-weight:700;cursor:pointer;transition:all 0.25s;box-shadow:0 6px 20px rgba(22,93,255,.35);font-family:'DM Sans',sans-serif}
.success-close-btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(22,93,255,.5)}
body.dark-mode .success-card{background:#111f3a}
body.dark-mode .success-body{background:#111f3a}
body.dark-mode .success-info-row{background:#0e1a30}
body.dark-mode .success-info-text{color:#7a8fb0}
body.dark-mode .success-info-text strong{color:#c8d6f0}
body.dark-mode .success-contact-item{color:#c8d6f0}
body.dark-mode .success-divider{background:#1e2d50}

/* ══ BOTÓN FLOTANTE ══ */
.tramite-float{position:fixed;top:50px;left:50px;background:linear-gradient(135deg,#0A1F44 0%,#1a3a6e 100%);color:white;width:75px;height:75px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(10,31,68,.4);cursor:pointer;z-index:1000;transition:all .4s cubic-bezier(.4,0,.2,1);text-decoration:none;animation:floatPremium 3s ease-in-out infinite;border:4px solid white;overflow:hidden}
.tramite-float::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.2) 50%,transparent 70%);animation:tramiteShine 3s infinite}
.tramite-float:hover{transform:scale(1.2) translateY(-5px);box-shadow:0 20px 40px rgba(10,31,68,.6);animation:none}
.tramite-tooltip{position:absolute;left:95px;background:white;color:#0A1F44;padding:15px 25px;border-radius:12px;white-space:nowrap;box-shadow:0 8px 25px rgba(0,0,0,.15);opacity:0;pointer-events:none;transition:all .4s cubic-bezier(.4,0,.2,1);font-size:1rem;font-weight:600;border:1px solid rgba(0,0,0,.1);z-index:1001}
.tramite-float:hover .tramite-tooltip{opacity:1;transform:translateX(10px)}
.tramite-icon{width:36px;height:36px;position:relative;z-index:1;fill:white}
@keyframes floatPremium{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-15px) rotate(2deg)}75%{transform:translateY(-5px) rotate(-2deg)}}
@keyframes tramiteShine{0%{transform:translateX(-120%)}100%{transform:translateX(120%)}}
body.dark-mode .tramite-float{border:2px solid rgba(255,255,255,.09)}
body.dark-mode .tramite-tooltip{background:rgba(26,32,44,.95);color:#e2e8f0;border:1px solid #2d3748}

/* ══ WHATSAPP ══ */
.wa-float{position:fixed;bottom:40px;left:40px;width:62px;height:62px;border-radius:50%;background:linear-gradient(135deg,#25d366 0%,#128c7e 100%);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 28px rgba(37,211,102,.42);cursor:pointer;z-index:9990;text-decoration:none;border:3px solid #fff;overflow:hidden;animation:waFloat 3s ease-in-out infinite;transition:transform .35s cubic-bezier(.4,0,.2,1),box-shadow .35s ease}
.wa-float::before{content:'';position:absolute;inset:0;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.28) 50%,transparent 70%);animation:waShine 3.2s infinite;pointer-events:none}
.wa-float:hover{transform:scale(1.15) translateY(-4px);box-shadow:0 16px 38px rgba(37,211,102,.58);animation:none}
.wa-float:hover .wa-tip{opacity:1;transform:translateX(10px)}
.wa-icon{width:32px;height:32px;position:relative;z-index:1;flex-shrink:0}
.wa-icon path{fill:#fff}
.wa-tip{position:absolute;left:78px;top:50%;transform:translateY(-50%);background:#fff;color:#333;padding:10px 18px;border-radius:10px;white-space:nowrap;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;box-shadow:0 6px 22px rgba(0,0,0,.13);border:1px solid rgba(0,0,0,.08);opacity:0;pointer-events:none;transition:opacity .3s ease,transform .3s ease}
.wa-tip::before{content:'';position:absolute;left:-6px;top:50%;transform:translateY(-50%);border:6px solid transparent;border-right-color:#fff;border-left:0;filter:drop-shadow(-1px 0 1px rgba(0,0,0,.08))}
@keyframes waFloat{0%,100%{transform:translateY(0) rotate(0deg)}25%{transform:translateY(-12px) rotate(2deg)}75%{transform:translateY(-4px) rotate(-1.5deg)}}
@keyframes waShine{0%{transform:translateX(-120%)}100%{transform:translateX(120%)}}
body.dark-mode .wa-float{border:2px solid rgba(255,255,255,.12)}

/* ══ RESPONSIVE ══ */
@media(max-width:720px){.grid3{grid-template-columns:1fr 1fr}.prog{padding:.8rem .7rem}.sl{font-size:.56rem}.sc{width:28px;height:28px;font-size:.7rem}.step:not(:last-child)::after{left:calc(50% + 15px);width:calc(100% - 30px)}}
@media(max-width:640px){.theme-toggle-btn{top:14px;right:14px;width:44px;height:44px}.icon-sun,.icon-moon{width:22px;height:22px}.form-progress-wrap{width:calc(100% - 24px);bottom:16px}.form-progress-pill{padding:8px 14px 8px 12px;gap:10px}.form-progress-text{font-size:11.5px;min-width:110px}}
@media(max-width:600px){
  .wrap{padding:.85rem .65rem 3rem}.hdr{padding:1.3rem 1rem;border-radius:7px;margin-bottom:1.2rem}.hdr-logo{font-size:1.5rem}.hdr-sub{font-size:.8rem;letter-spacing:.04em}
  .prog{padding:.6rem .4rem;border-radius:7px;margin-bottom:1.2rem;gap:0}.sc{width:25px;height:25px;font-size:.64rem}.sl{font-size:.5rem;line-height:1.1}.step:not(:last-child)::after{left:calc(50% + 13px);width:calc(100% - 26px);top:12px}
  .card{border-radius:7px}.sec{padding:1rem}.sec-hdr{padding-top:.65rem;padding-bottom:.85rem;margin-bottom:1.1rem;gap:.5rem}.sec-ico{width:29px;height:29px;border-radius:6px}.sec-ico svg{width:16px;height:16px}.sec-title{font-size:.95rem}
  .grid,.grid3{grid-template-columns:1fr;gap:1rem}.full{grid-column:1/-1}
  input,select,textarea{font-size:.84rem;padding:.5rem .7rem}.lbl{font-size:.76rem}.em{font-size:.7rem}.note{font-size:.68rem}
  .dep-grid{grid-template-columns:1fr 1fr;gap:.6rem}.cond-block.open{max-height:800px}
  .ref{padding:.9rem;border-radius:8px}.ref-t{font-size:.82rem;margin-bottom:.7rem}.sub-t{font-size:.98rem}
  .pay-box{padding:.9rem}.pay-ttl{font-size:.79rem;margin-bottom:.7rem}.pay-row{flex-direction:column;gap:.75rem}.radios{flex-direction:row;flex-wrap:wrap;min-width:unset;gap:.45rem}.rlbl{font-size:.79rem;padding:.36rem .58rem;border-radius:5px}.pay-in{min-width:unset;width:100%}
  /* Summary responsive */
  .sum-header{padding:.85rem 1rem;flex-wrap:wrap;gap:.5rem}
  .sum-group{padding:.75rem 1rem}
  .sum-footer{padding:.75rem 1rem}
  .sum-ttl{font-size:.78rem}
  .sum-badge{font-size:.63rem;padding:.2rem .55rem}
  .sum-row{flex-direction:column;gap:.04rem;line-height:1.55;padding:.12rem 0}
  .sum-k{min-width:unset;font-size:.72rem;color:var(--a)}
  .sum-v{font-size:.8rem}
  .decl-box{padding:.95rem 1rem;margin-top:1.2rem;border-radius:8px}.decl-head{font-size:.74rem;margin-bottom:.6rem}.decl-text{font-size:.78rem;line-height:1.65}.chk-vis{width:22px;height:22px;min-width:22px;border-radius:5px}.decl-row{gap:.75rem}
  .nav{padding:.85rem .9rem;gap:.55rem;flex-wrap:wrap}.step-ind{font-size:.72rem;order:-1;width:100%;text-align:center;margin-bottom:.1rem}.btn{padding:.5rem 1rem;font-size:.81rem}.btn-s{padding:.55rem 1.2rem;font-size:.81rem;letter-spacing:.02em}
  .attach-legibility{grid-template-columns:1fr}.attach-docs-list li{flex-direction:column;gap:3px}
}
@media(max-width:380px){.wrap{padding:.65rem .5rem 2.5rem}.hdr-logo{font-size:1.35rem}.sl{font-size:.46rem}.sc{width:23px;height:23px;font-size:.6rem}.step:not(:last-child)::after{left:calc(50% + 12px);width:calc(100% - 24px)}.sec{padding:.85rem}.sec-title{font-size:.9rem}.dep-grid{grid-template-columns:1fr}.nav{padding:.75rem .8rem}.btn{padding:.45rem .85rem;font-size:.78rem}}
@media(max-width:768px){.tramite-float{width:65px;height:65px;top:30px;left:30px}.tramite-icon{width:32px;height:32px}.tramite-tooltip{display:none}}
@media(max-width:600px){.tramite-float{width:54px;height:54px;top:22px;left:14px}.tramite-icon{width:27px;height:27px}.wa-float{width:54px;height:54px;bottom:28px;left:20px;border-width:2.5px}.wa-icon{width:27px;height:27px}.wa-tip{display:none}}
@media(max-width:380px){.tramite-float{width:48px;height:48px}.tramite-icon{width:24px;height:24px}.wa-float{width:48px;height:48px;bottom:22px;left:14px}.wa-icon{width:24px;height:24px}}
</style>
</head>
<body>

<a href="https://www.anpai.com.mx/iniciar-tramite" class="tramite-float" rel="noopener noreferrer" aria-label="Iniciar trámite en ANPAI">
  <span class="tramite-tooltip">📝 Iniciar trámite</span>
  <svg class="tramite-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
  </svg>
</a>

<button class="theme-toggle-btn" id="themeToggleBtn" aria-label="Cambiar tema claro/oscuro" title="Cambiar tema">
  <div class="toggle-icon-wrap">
    <svg class="icon-sun" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="4.5" fill="#FFD700" stroke="#FFA500" stroke-width="1.4"/>
      <g stroke="#FFD700" stroke-width="2" stroke-linecap="round">
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(0 12 12)"><animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(45 12 12)"><animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(90 12 12)"><animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(135 12 12)"><animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(180 12 12)"><animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(225 12 12)"><animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(270 12 12)"><animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/></line>
        <line x1="12" y1="2.5" x2="12" y2="4.5" transform="rotate(315 12 12)"><animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/></line>
      </g>
    </svg>
    <svg class="icon-moon" viewBox="0 0 24 24" fill="none">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="#c8d0ff" stroke="#4169E1" stroke-width="1.5"/>
      <circle cx="15" cy="9" r="1" fill="#fff8c0" opacity="0.85"><animate attributeName="opacity" values="0.85;0.3;0.85" dur="4s" repeatCount="indefinite"/></circle>
      <circle cx="17" cy="13" r="0.7" fill="#fff8c0" opacity="0.6"><animate attributeName="opacity" values="0.6;0.2;0.6" dur="3s" repeatCount="indefinite"/></circle>
      <circle cx="13" cy="15" r="0.55" fill="#fff8c0" opacity="0.4"><animate attributeName="opacity" values="0.4;0.1;0.4" dur="5s" repeatCount="indefinite"/></circle>
    </svg>
  </div>
</button>

<div class="wrap">
<header class="hdr">
  <div class="hdr-logo">A<span>VA</span></div>
  <div class="hdr-sub">Solicitud de Crédito Vehicular</div>
</header>

<nav class="prog" id="prog">
  <div class="step active" data-s="1"><div class="sc">1</div><span class="sl">Datos<br>Personales</span></div>
  <div class="step" data-s="2"><div class="sc">2</div><span class="sl">Datos de<br>Domicilio</span></div>
  <div class="step" data-s="3"><div class="sc">3</div><span class="sl">Referencias</span></div>
  <div class="step" data-s="4"><div class="sc">4</div><span class="sl">Vehículo<br>y Financ.</span></div>
  <div class="step" data-s="5"><div class="sc">5</div><span class="sl">Docs y<br>Envío</span></div>
</nav>

<form id="frm" novalidate action="https://formsubmit.co/info@anpai.com.mx" method="POST" enctype="multipart/form-data">
  <input type="hidden" name="_subject" value="Solicitud de Crédito Vehicular — AVA">
  <input type="hidden" name="_next" value="">
  <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" id="rcToken" name="g-recaptcha-response" value="">

<div class="card">

<!-- ═══ S1 — DATOS PERSONALES ═══ -->
<div class="sec active" id="s1">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v1h20v-1c0-3.3-6.7-5-10-5z"/></svg></div>
    <h1 class="sec-title">DATOS PERSONALES</h1>
  </div>
  <div class="grid">
    <div class="fg"><label class="lbl req" for="pNombre">Primer Nombre</label><input id="pNombre" name="pNombre" type="text" placeholder="Tu primer nombre" autocomplete="given-name"><span class="em" id="epNombre"></span></div>
    <div class="fg"><label class="lbl" for="sNombre">Segundo Nombre <span class="note">(opcional)</span></label><input id="sNombre" name="sNombre" type="text" placeholder="Tu segundo nombre" autocomplete="additional-name"></div>
    <div class="fg"><label class="lbl req" for="pApellido">Primer Apellido</label><input id="pApellido" name="pApellido" type="text" placeholder="Tu primer apellido" autocomplete="family-name"><span class="em" id="epApellido"></span></div>
    <div class="fg"><label class="lbl req" for="sApellido">Segundo Apellido</label><input id="sApellido" name="sApellido" type="text" placeholder="Tu segundo apellido"><span class="em" id="esApellido"></span></div>
    <div class="fg"><label class="lbl req" for="genero">Género</label><select id="genero" name="genero"><option value="" disabled selected>Selecciona</option><option>Masculino</option><option>Femenino</option></select><span class="em" id="egenero"></span></div>
    <div class="fg"><label class="lbl req" for="fNac">Fecha de Nacimiento</label><input id="fNac" name="fNac" type="date" autocomplete="bday"><span class="em" id="efNac"></span></div>
    <div class="fg"><label class="lbl" for="edad">Edad <span class="note">(se calcula automáticamente)</span></label><input id="edad" name="edad" type="text" readonly disabled placeholder="—"></div>
    <div class="fg"><label class="lbl req" for="estCivil">Estado Civil</label><select id="estCivil" name="estCivil"><option value="" disabled selected>Selecciona tu estado civil</option><option value="Soltero(a)">Soltero(a)</option><option value="Casado(a)">Casado(a)</option></select><span class="em" id="eestCivil"></span></div>
    <div class="fg cond-block" id="regimenBlk"><label class="lbl req" for="regimen">Régimen Matrimonial</label><select id="regimen" name="regimen" disabled><option value="" disabled selected>Selecciona el régimen</option><option value="Bienes Mancomunados">Bienes Mancomunados</option><option value="Bienes Separados">Bienes Separados</option></select><span class="em" id="eregimen"></span></div>
    <div class="fg"><label class="lbl req" for="rfc">RFC <span class="note">13 caracteres con homoclave</span></label><input id="rfc" name="rfc" type="text" placeholder="ABCD123456AB1" maxlength="13" style="text-transform:uppercase;letter-spacing:.06em" autocomplete="off"><span class="em" id="erfc"></span></div>
    <div class="fg"><label class="lbl req" for="curp">CURP <span class="note">18 caracteres — RENAPO</span></label><input id="curp" name="curp" type="text" placeholder="ABCD123456HDFLRN01" maxlength="18" style="text-transform:uppercase;letter-spacing:.04em" autocomplete="off"><span class="em" id="ecurp"></span></div>
    <div class="fg"><label class="lbl req" for="telP">Teléfono</label><div class="tel-wr" id="telPWr"><select class="lada-sel" id="ladaP" name="ladaP" aria-label="Código de país"><option value="+52" selected>🇲🇽 +52</option><option value="+1">🇺🇸 +1</option><option value="+1">🇨🇦 +1</option><option value="+34">🇪🇸 +34</option><option value="+54">🇦🇷 +54</option><option value="+55">🇧🇷 +55</option><option value="+56">🇨🇱 +56</option><option value="+57">🇨🇴 +57</option><option value="+58">🇻🇪 +58</option><option value="+51">🇵🇪 +51</option><option value="+44">🇬🇧 +44</option><option value="+33">🇫🇷 +33</option><option value="+49">🇩🇪 +49</option><option value="+86">🇨🇳 +86</option><option value="+81">🇯🇵 +81</option><option value="+91">🇮🇳 +91</option><option value="+61">🇦🇺 +61</option></select><input class="tel-num" id="telP" name="telP" type="tel" placeholder="7771234567" maxlength="15" inputmode="numeric" autocomplete="tel"></div><input type="hidden" id="telPFull" name="telefonoPersonal"><span class="em" id="etelP"></span></div>
    <div class="fg"><label class="lbl req" for="emailP">Correo Electrónico</label><input id="emailP" data-no-upper="1" name="emailP" type="email" placeholder="nombre@correo.com" autocomplete="email"><span class="em" id="eemailP"></span></div>
    <div class="fg"><label class="lbl req" for="tieneDep">¿Tiene Dependientes Económicos?</label><select id="tieneDep" name="tieneDep"><option value="" disabled selected>Selecciona una opción</option><option value="No">No</option><option value="Si">Sí</option></select><span class="em" id="etieneDep"></span></div>
    <div class="full cond-block" id="depBlk">
      <div class="grid" style="margin-bottom:.85rem">
        <div class="fg"><label class="lbl req" for="numDep">Número de Dependientes</label><select id="numDep" name="numDep" disabled><option value="" disabled selected>Selecciona</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select><span class="em" id="enumDep"></span></div>
        <div class="fg" style="justify-content:flex-end"><span class="info-tag">💡 Se generarán campos de edad por dependiente</span></div>
      </div>
      <div class="dep-grid" id="depAges"></div>
      <span class="em" id="edepAges"></span>
    </div>
  </div>
</div>

<!-- ═══ S2 — DATOS DE DOMICILIO ═══ -->
<div class="sec" id="s2">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></div>
    <h2 class="sec-title">DATOS DE DOMICILIO</h2>
  </div>
  <div class="grid">
    <div class="fg full"><label class="lbl req" for="calle">Calle o Avenida</label><input id="calle" name="calle" type="text" placeholder="Nombre de la calle o avenida" autocomplete="street-address"><span class="em" id="ecalle"></span></div>
    <div class="fg"><label class="lbl req" for="numExt">Número Exterior</label><input id="numExt" name="numExt" type="text" placeholder="Ej. 142"><span class="em" id="enumExt"></span></div>
    <div class="fg"><label class="lbl" for="numInt">Número Interior <span class="note">(opcional)</span></label><input id="numInt" name="numInt" type="text" placeholder="Ej. Depto. 3B"></div>
    <div class="fg">
      <label class="lbl req" for="cp">Código Postal</label>
      <div class="cp-wr" id="cpWr"><input id="cp" name="codigoPostal" type="text" placeholder="12345" maxlength="5" inputmode="numeric" autocomplete="postal-code"><div class="cp-spin" id="cpSpin" style="display:none"></div></div>
      <small style="color:var(--mid);font-size:.68rem;margin-top:.1rem">Escribe el C.P. y presiona Tab o Enter para buscar</small>
      <span class="em" id="ecp"></span>
      <div id="cpErrBox" style="display:none;font-size:.75rem;color:var(--e);font-weight:500;padding:.42rem .68rem;background:rgba(229,57,53,.05);border:1px solid rgba(229,57,53,.18);border-radius:6px;margin-top:.32rem"></div>
      <button type="button" id="cpRetry" style="display:none;margin-top:.38rem;padding:.32rem .85rem;border-radius:6px;background:var(--p);color:#fff;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:600">↺ Reintentar</button>
    </div>
    <div class="fg" id="colBlk" style="display:none">
      <label class="lbl req" for="colonia">Colonia <span id="colCnt" style="font-size:.68rem;font-weight:500;color:var(--a);background:rgba(22,93,255,.08);border-radius:8px;padding:.07rem .48rem;margin-left:.3rem"></span></label>
      <select id="colonia" name="colonia"><option value="" disabled selected>Selecciona tu colonia</option></select>
      <span class="em" id="ecolonia"></span>
      <div id="colRegLbl" style="display:none;font-size:.68rem;font-weight:700;color:var(--mid);letter-spacing:.05em;margin-top:.48rem;margin-bottom:.2rem">✓ COLONIA REGISTRADA</div>
      <input id="colSel" name="coloniaSeleccionada" type="text" readonly style="display:none;border:2px solid var(--a);background:rgba(22,93,255,.04);font-weight:600;color:var(--a);cursor:default" placeholder="Colonia registrada">
    </div>
    <div class="fg"><label class="lbl req" for="municipio">Delegación o Municipio</label><input id="municipio" name="municipio" type="text" placeholder="Se completa con el C.P." readonly><span class="em" id="emunicipio"></span></div>
    <div class="fg"><label class="lbl req" for="estado">Estado de la República</label><input id="estado" name="estado" type="text" placeholder="Se completa con el C.P." readonly><span class="em" id="eestado"></span></div>
    <input type="hidden" id="hCiu" name="ciudad">
  </div>
</div>

<!-- ═══ S3 — REFERENCIAS ═══ -->
<div class="sec" id="s3">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg></div>
    <h2 class="sec-title">REFERENCIAS</h2>
  </div>
  <div class="sub-t">REFERENCIAS FAMILIARES</div>
  <div class="sub-n">No conviven con el solicitante</div>

  <div class="ref"><div class="ref-t">Familiar 1</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="f1n">Nombre Completo</label><input id="f1n" name="f1n" type="text" placeholder="Nombre completo"><span class="em" id="ef1n"></span></div>
    <div class="fg"><label class="lbl req" for="f1t">Teléfono</label><div class="tel-wr" id="f1tWr"><select class="lada-sel" id="ladaf1t" name="ladaf1t"><option value="+52" selected>🇲🇽 +52</option><option value="+1">🇺🇸 +1</option><option value="+34">🇪🇸 +34</option></select><input class="tel-num" id="f1t" name="f1t" type="tel" placeholder="2221234567" maxlength="15" inputmode="numeric"></div><input type="hidden" id="f1tFull" name="f1tFull"><span class="em" id="ef1t"></span></div>
    <div class="fg"><label class="lbl req" for="f1e">Correo</label><input id="f1e" data-no-upper="1" name="f1e" type="email" placeholder="nombre@correo.com"><span class="em" id="ef1e"></span></div>
    <div class="fg full"><label class="lbl req" for="f1d">Dirección</label><textarea id="f1d" name="f1d" rows="2" placeholder="Calle, número, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ef1d"></span></div>
  </div></div>

  <div class="ref"><div class="ref-t">Familiar 2</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="f2n">Nombre Completo</label><input id="f2n" name="f2n" type="text" placeholder="Nombre completo"><span class="em" id="ef2n"></span></div>
    <div class="fg"><label class="lbl req" for="f2t">Teléfono</label><div class="tel-wr" id="f2tWr"><select class="lada-sel" id="ladaf2t" name="ladaf2t"><option value="+52" selected>🇲🇽 +52</option><option value="+1">🇺🇸 +1</option><option value="+34">🇪🇸 +34</option></select><input class="tel-num" id="f2t" name="f2t" type="tel" placeholder="2221234567" maxlength="15" inputmode="numeric"></div><input type="hidden" id="f2tFull" name="f2tFull"><span class="em" id="ef2t"></span></div>
    <div class="fg"><label class="lbl req" for="f2e">Correo</label><input id="f2e" data-no-upper="1" name="f2e" type="email" placeholder="nombre@correo.com"><span class="em" id="ef2e"></span></div>
    <div class="fg full"><label class="lbl req" for="f2d">Dirección</label><textarea id="f2d" name="f2d" rows="2" placeholder="Calle, número, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ef2d"></span></div>
  </div></div>

  <div class="sub-t" style="margin-top:.6rem">REFERENCIAS DE AMISTAD</div>
  <div class="sub-n">&nbsp;</div>

  <div class="ref"><div class="ref-t">Amistad 1</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="a1n">Nombre Completo</label><input id="a1n" name="a1n" type="text" placeholder="Nombre completo"><span class="em" id="ea1n"></span></div>
    <div class="fg"><label class="lbl req" for="a1t">Teléfono</label><div class="tel-wr" id="a1tWr"><select class="lada-sel" id="ladaa1t" name="ladaa1t"><option value="+52" selected>🇲🇽 +52</option><option value="+1">🇺🇸 +1</option><option value="+34">🇪🇸 +34</option></select><input class="tel-num" id="a1t" name="a1t" type="tel" placeholder="2221234567" maxlength="15" inputmode="numeric"></div><input type="hidden" id="a1tFull" name="a1tFull"><span class="em" id="ea1t"></span></div>
    <div class="fg"><label class="lbl req" for="a1e">Correo</label><input id="a1e" data-no-upper="1" name="a1e" type="email" placeholder="nombre@correo.com"><span class="em" id="ea1e"></span></div>
    <div class="fg full"><label class="lbl req" for="a1d">Dirección</label><textarea id="a1d" name="a1d" rows="2" placeholder="Calle, número, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ea1d"></span></div>
  </div></div>

  <div class="ref"><div class="ref-t">Amistad 2</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="a2n">Nombre Completo</label><input id="a2n" name="a2n" type="text" placeholder="Nombre completo"><span class="em" id="ea2n"></span></div>
    <div class="fg"><label class="lbl req" for="a2t">Teléfono</label><div class="tel-wr" id="a2tWr"><select class="lada-sel" id="ladaa2t" name="ladaa2t"><option value="+52" selected>🇲🇽 +52</option><option value="+1">🇺🇸 +1</option><option value="+34">🇪🇸 +34</option></select><input class="tel-num" id="a2t" name="a2t" type="tel" placeholder="2221234567" maxlength="15" inputmode="numeric"></div><input type="hidden" id="a2tFull" name="a2tFull"><span class="em" id="ea2t"></span></div>
    <div class="fg"><label class="lbl req" for="a2e">Correo</label><input id="a2e" data-no-upper="1" name="a2e" type="email" placeholder="nombre@correo.com"><span class="em" id="ea2e"></span></div>
    <div class="fg full"><label class="lbl req" for="a2d">Dirección</label><textarea id="a2d" name="a2d" rows="2" placeholder="Calle, número, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ea2d"></span></div>
  </div></div>
</div>

<!-- ═══ S4 — VEHÍCULO Y FINANCIAMIENTO ═══ -->
<div class="sec" id="s4">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/></svg></div>
    <h2 class="sec-title">VEHÍCULO Y FINANCIAMIENTO</h2>
  </div>
  <div class="grid">
    <div class="fg">
      <label class="lbl req" for="marca">Marca</label>
      <select id="marca" name="marca">
        <option value="" disabled selected>Selecciona marca</option>
        <optgroup label="── Chinas ──"><option>BAIC</option><option>BYD</option><option>Changan</option><option>Chirey / Omoda / Exeed</option><option>GAC Motor</option><option>Geely</option><option>GWM / Wey</option><option>JAC</option><option>Jetour</option><option>MG / IM</option><option>Neta</option><option>Zeekr</option></optgroup>
        <optgroup label="── Europeas ──"><option>Alfa Romeo</option><option>Audi</option><option>BMW</option><option>Cupra</option><option>Fiat</option><option>Land Rover</option><option>Mercedes-Benz</option><option>Mini Cooper</option><option>Peugeot</option><option>Porsche</option><option>Renault</option><option>Seat</option><option>Volkswagen</option><option>Volvo</option></optgroup>
        <optgroup label="── Estadounidenses ──"><option>Buick</option><option>Cadillac</option><option>Chevrolet</option><option>Dodge</option><option>Ford</option><option>GMC</option><option>Jeep</option><option>Lincoln</option><option>Ram</option><option>Tesla</option></optgroup>
        <optgroup label="── Japonesas / Coreanas ──"><option>Honda</option><option>Hyundai</option><option>Infiniti</option><option>Kia</option><option>Lexus</option><option>Mazda</option><option>Mitsubishi</option><option>Nissan</option><option>Subaru</option><option>Suzuki</option><option>Toyota</option></optgroup>
        <optgroup label="── Mexicanas ──"><option>Zacua</option></optgroup>
        <option value="Otra">Otra marca…</option>
      </select>
      <span class="em" id="emarca"></span>
    </div>
    <div class="fg" id="otraMarcaBlk" style="display:none"><label class="lbl req" for="otraMarca">Especifica la Marca</label><input id="otraMarca" name="otraMarca" type="text" placeholder="Escribe la marca del vehículo" disabled><span class="em" id="eotraMarca"></span></div>
    <div class="fg"><label class="lbl req" for="version">Versión / Trim</label><input id="version" name="version" type="text" placeholder="Ej: Jetta Highline 1.4T AT"><span class="em" id="eversion"></span></div>
    <div class="fg"><label class="lbl req" for="anio">Año</label><select id="anio" name="anio"><option value="" disabled selected>Selecciona año</option></select><span class="em" id="eanio"></span></div>
    <div class="fg"><label class="lbl req" for="costo">Costo Total del Vehículo</label><div class="cur-wr"><span class="cur-pre">MX$</span><input id="costo" name="costo" type="text" placeholder="0.00" inputmode="decimal"></div><span class="em" id="ecosto"></span></div>
    <div class="fg full">
      <label class="lbl req">Pago Inicial</label>
      <div class="pay-box">
        <div class="pay-ttl">Selecciona el tipo de pago inicial</div>
        <div class="pay-row">
          <div class="radios">
            <label class="rlbl"><input type="radio" name="tipoPago" value="enganche"><span class="rc"></span>Enganche</label>
            <label class="rlbl"><input type="radio" name="tipoPago" value="monto"><span class="rc"></span>Monto Inicial</label>
          </div>
          <div class="pay-in">
            <div id="payH" style="color:var(--lt);font-size:.82rem;padding:.55rem 0">← Selecciona tipo de pago</div>
            <div id="engF" class="fg" style="display:none">
              <label class="lbl req" for="valEng">Enganche</label>
              <div style="display:flex;gap:.55rem;margin-bottom:.5rem">
                <label class="rlbl" style="font-size:.79rem;padding:.32rem .65rem"><input type="radio" name="engTipo" value="porcentaje" id="engPct" checked><span class="rc"></span>Porcentaje %</label>
                <label class="rlbl" style="font-size:.79rem;padding:.32rem .65rem"><input type="radio" name="engTipo" value="monto_eng" id="engMon"><span class="rc"></span>Monto fijo $</label>
              </div>
              <div id="engPctCtrl">
                <div style="display:flex;align-items:center;gap:.5rem">
                  <button type="button" id="engMinus" style="width:34px;height:34px;border-radius:6px;background:var(--bg);border:1.5px solid var(--bd);font-size:1.1rem;font-weight:700;cursor:pointer;color:var(--p);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s">−</button>
                  <div style="position:relative;flex:1"><input id="valEng" name="valEng" type="text" placeholder="10%" style="padding-right:2rem;text-align:center;font-weight:600"><span style="position:absolute;right:.75rem;top:50%;transform:translateY(-50%);font-size:.88rem;font-weight:700;color:var(--a);pointer-events:none" id="engPctSym">%</span></div>
                  <button type="button" id="engPlus" style="width:34px;height:34px;border-radius:6px;background:var(--bg);border:1.5px solid var(--bd);font-size:1.1rem;font-weight:700;cursor:pointer;color:var(--p);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s">+</button>
                </div>
                <small style="color:var(--mid);font-size:.67rem;margin-top:.22rem;display:block">Botones de 5 en 5 (mínimo 10%) o escribe libremente.</small>
              </div>
              <div id="engMonCtrl" style="display:none"><div class="cur-wr"><span class="cur-pre">MX$</span><input id="valEngMonto" name="valEngMonto" type="text" placeholder="0.00" inputmode="decimal"></div></div>
              <span class="em" id="evalEng"></span>
            </div>
            <div id="monF" class="fg" style="display:none">
              <label class="lbl req" for="valMon">Monto Inicial</label>
              <div class="cur-wr"><span class="cur-pre">MX$</span><input id="valMon" name="valMon" type="text" placeholder="0.00" inputmode="decimal"></div>
              <span class="em" id="evalMon"></span>
            </div>
          </div>
        </div>
      </div>
      <span class="em" id="etipoPago"></span>
    </div>
  </div>
</div>

<!-- ═══ S5 — DOCUMENTOS Y ENVÍO ═══ -->
<div class="sec" id="s5">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/></svg></div>
    <h2 class="sec-title">DOCUMENTOS Y ENVÍO</h2>
  </div>

  <div class="fg" style="margin-bottom:1.5rem">
    <label class="lbl req">Adjuntar Documentos</label>
    <div class="attach-wrap">
      <div class="attach-dropzone" id="attachDropzoneAVA"
           ondragover="onDragOver(event,'AVA')"
           ondragleave="onDragLeave(event,'AVA')"
           ondrop="onDrop(event,'AVA')"
           onclick="document.getElementById('fileInputAVA').click()">
        <span class="attach-folder-icon">📁</span>
        <div class="attach-dropzone-text">
          Arrastra tus archivos aquí o
          <a onclick="event.stopPropagation();document.getElementById('fileInputAVA').click()">haz clic para seleccionarlos</a>
        </div>
        <div class="attach-formats-line">Formatos: <strong>PDF, JPG, PNG</strong></div>
        <div class="attach-auto-compress-line">✨ Compresión automática incluida</div>
        <div class="attach-limit-line">📏 Límite total: <strong>5 MB</strong></div>
        <div class="attach-realtime-stats" id="attachRealtimeAVA">
          <span>📦 <strong id="attachCountAVA">0</strong> archivo(s)</span>
          <span class="attach-stats-sep">|</span>
          <span>Peso: <strong id="attachWeightAVA">—</strong></span>
        </div>
        <input type="file" id="fileInputAVA" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display:none" onchange="handleFiles(this.files,'AVA')">
      </div>
      <div class="attach-capacity-wrap" id="capacityWrapAVA">
        <div class="attach-capacity-header">
          <span class="attach-capacity-label">Capacidad Utilizada</span>
          <span class="attach-capacity-value" id="capacityValueAVA">0 KB de 5 MB (ZIP comprimido)</span>
        </div>
        <div class="attach-bar-track">
          <div class="attach-bar-fill green" id="attachBarAVA" style="width:0%"></div>
        </div>
        <div class="attach-status" id="attachStatusAVA">
          <span class="attach-status-dot green" id="attachDotAVA"></span>
          <span id="attachStatusTextAVA">ZIP listo — capacidad disponible</span>
        </div>
      </div>
      <div class="attach-file-list" id="fileListAVA"></div>
      <div class="attach-error-msg" id="attachErrAVA" style="margin-bottom:12px">
        <span>⚠️</span>
        <span id="attachErrTextAVA">El ZIP excede el límite de 5 MB. Elimina algunos archivos.</span>
      </div>
    </div>

    <div class="attach-docs-required" id="attachDocsRequired">
      <div class="attach-docs-title">
        <span class="attach-docs-icon">📋</span>
        Documentos Requeridos
      </div>
      <ul class="attach-docs-list">
        <li>
          <span class="attach-docs-badge">Obligatorio</span>
          <span class="attach-docs-name">Identificación Oficial Vigente</span>
          <span class="attach-docs-desc">(INE, Pasaporte o FM2) — en formato PDF, completa o por ambos lados si se trata de una identificación física</span>
        </li>
      </ul>
      <p class="attach-docs-note attach-docs-note-auth">
        <span class="attach-docs-note-icon">📄</span>
        <span><strong>Requisito de autenticidad</strong><br>Los documentos deben ser copia fiel del original: completamente legibles, sin alteraciones.</span>
      </p>
      <p class="attach-docs-note" style="margin-top:8px">
        <span class="attach-docs-note-icon">ℹ️</span>
        En la mayoría de los casos, con la documentación solicitada es suficiente. Sin embargo, si fuera necesario, podría requerirse documentación adicional como <strong>comprobante de ingresos</strong> y <strong>comprobante de domicilio</strong>.
      </p>
    </div>

    <div class="attach-legibility" style="margin-top:10px">
      <div class="attach-leg-card ok">
        <div class="attach-leg-icon">✓</div>
        <div>
          <div class="attach-leg-title">Legible</div>
          <div class="attach-leg-desc">Foto nítida, bien iluminada, encuadre completo. Sin sombras ni reflejos que cubran datos.</div>
        </div>
      </div>
      <div class="attach-leg-card bad">
        <div class="attach-leg-icon">✕</div>
        <div>
          <div class="attach-leg-title">No Legible</div>
          <div class="attach-leg-desc">Imagen borrosa, oscura, con dedos tapando datos, o recortada. No puede procesarse.</div>
        </div>
      </div>
    </div>

    <div class="compress-progress" id="compressProgressAVA" style="margin-top:12px">
      <div class="compress-header">
        <span style="font-size:16px;">⚡</span>
        <span class="compress-header-text">COMPRIMIENDO...</span>
        <span id="compressPctAVA" class="compress-pct">0%</span>
      </div>
      <div class="compress-body">
        <div class="compress-row">
          <div class="compress-stat"><div class="compress-stat-val" id="compressDoneMBAVA">0 KB</div><div class="compress-stat-label">Comprimido</div></div>
          <div class="compress-stat"><div class="compress-stat-val" id="compressRemMBAVA">0 KB</div><div class="compress-stat-label">Restante</div></div>
          <div class="compress-stat"><div class="compress-stat-val" id="compressElapsedAVA">0s</div><div class="compress-stat-label">Transcurrido</div></div>
          <div class="compress-stat"><div class="compress-stat-val" id="compressEtaAVA">—</div><div class="compress-stat-label">Estimado</div></div>
        </div>
        <div class="compress-bar-track"><div class="compress-bar-fill" id="compressBarFillAVA"></div></div>
        <div class="compress-info">
          <span id="compressInfoAVA">Preparando…</span>
          <span id="compressDonePctAVA">0% completado</span>
        </div>
        <div class="compress-resume-note" id="compressResumeAVA">
          <span>🔄</span><span>Pausado. Continuará cuando vuelva la conexión.</span>
        </div>
      </div>
    </div>

    <div class="offline-msg" id="offlineMsgAVA" style="margin-top:10px">
      <span>📡</span><span>Sin conexión. La compresión se reanudará automáticamente.</span>
    </div>

    <input type="hidden" id="attachHiddenAVA" name="Archivos_adjuntos_info">
    <span class="em" id="eupErr" style="display:block;margin-top:.5rem"></span>
  </div>

  <!-- ══ RESUMEN — NUEVO DISEÑO ══ -->
  <div class="sumbox" id="sumBox" style="display:none">
    <!-- CABECERA -->
    <div class="sum-header">
      <div class="sum-header-left">
        <div class="sum-header-icon">
          <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13zm-1 4h6v2h-6v-2zm-4-4h2v2H8V9zm0 4h2v2H8v-2zm0 4h8v2H8v-2z"/></svg>
        </div>
        <div>
          <div class="sum-ttl">Resumen de Solicitud</div>
          <div class="sum-ttl-sub">Revisa tus datos antes de enviar</div>
        </div>
      </div>
      <div class="sum-badge">
        <span class="sum-badge-dot"></span>
        Listo
      </div>
    </div>
    <!-- CUERPO (generado por JS) -->
    <div class="sum-body" id="sumCont"></div>
    <!-- PIE -->
    <div class="sum-footer">
      <span class="sum-footer-icon">ℹ️</span>
      <p class="sum-footer-text">
        <strong>Verifica la información antes de enviar.</strong>
        Si detectas algún error, regresa al paso correspondiente para corregirlo.
      </p>
    </div>
  </div>

  <!-- ══ DECLARACIÓN — TEXTO ACTUALIZADO ══ -->
  <div class="decl-box" id="declBox">
    <div class="decl-head">Declaración de veracidad y autenticidad<span class="decl-req">Obligatorio</span></div>
    <div class="decl-row" id="declRow" role="checkbox" aria-checked="false" tabindex="0">
      <div class="chk-vis" id="chkVis">
        <svg viewBox="0 0 12 10"><polyline points="1,5 4.5,8.5 11,1"/></svg>
      </div>
      <span class="decl-text">Bajo protesta de decir verdad, declaro que toda la información y documentación proporcionada es auténtica. Al marcar esta casilla, manifiesto mi conformidad otorgando a esta acción el mismo valor jurídico que mi firma autógrafa, de conformidad con el artículo 89 del Código de Comercio y la NOM-151-SCFI-2016.</span>
    </div>
    <input type="hidden" id="declVal" name="declaracion_aceptada" value="">
    <span class="em" id="edecl" style="margin-top:.55rem;display:block"></span>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <button type="button" class="btn btn-p" id="btnPrev" disabled>
    <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>Anterior
  </button>
  <span class="step-ind">Paso <strong id="curS">1</strong> de <strong>5</strong></span>
  <button type="button" class="btn btn-p" id="btnNext">
    Siguiente<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
  </button>
  <button type="submit" class="btn btn-s" id="btnSub" style="display:none" disabled>
    <svg viewBox="0 0 24 24" style="width:14px;height:14px;fill:currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>ENVIAR SOLICITUD
  </button>
</div>

</div>
</form>
</div>

<!-- BARRA DE PROGRESO FLOTANTE -->
<div class="form-progress-wrap" id="formProgressWrap">
  <div class="form-progress-pill">
    <div class="form-progress-bar-track">
      <div class="form-progress-bar-fill" id="formProgressFill"></div>
    </div>
    <span class="form-progress-text">
      <strong id="formProgressDone">0</strong> de <span id="formProgressTotal">0</span> campos completados
    </span>
  </div>
</div>

<!-- MODALES MOTIVACIONALES -->
<div class="motiv-overlay" id="motivModal25">
  <div class="motiv-card">
    <div class="motiv-card-top"><div class="motiv-deco"></div><span class="motiv-emoji-3d">✨</span><div class="motiv-title">¡Ya vas por un cuarto! 🚀</div><div class="motiv-text">25% listo – ¡sigue así! Estás en el camino correcto.</div></div>
    <div class="motiv-card-bottom"><button class="motiv-btn motiv-btn-25" onclick="closeMotivModal('motivModal25')">¡Adelante! →</button></div>
  </div>
</div>
<div class="motiv-overlay" id="motivModal50">
  <div class="motiv-card">
    <div class="motiv-card-top"><div class="motiv-deco"></div><span class="motiv-emoji-3d">📈</span><div class="motiv-title">¡Mitad del camino! 🎉</div><div class="motiv-text">50% hecho – ¡estás volando! Ya va la mitad de tu solicitud.</div></div>
    <div class="motiv-card-bottom"><button class="motiv-btn motiv-btn-50" onclick="closeMotivModal('motivModal50')">¡Vamos por todo! →</button></div>
  </div>
</div>
<div class="motiv-overlay" id="motivModal75">
  <div class="motiv-card">
    <div class="motiv-card-top"><div class="motiv-deco"></div><span class="motiv-emoji-3d">🔥</span><div class="motiv-title">¡Ya casi llegas! ⚡</div><div class="motiv-text">75% listo – ¡último empuje! Tu crédito vehicular está casi listo.</div></div>
    <div class="motiv-card-bottom"><button class="motiv-btn motiv-btn-75" onclick="closeMotivModal('motivModal75')">¡Ya falta poco! →</button></div>
  </div>
</div>
<div class="motiv-overlay" id="motivModal100">
  <div class="motiv-card">
    <div class="motiv-card-top"><div class="motiv-deco"></div><span class="motiv-emoji-3d">🥳</span><div class="motiv-title">¡LO LOGRASTE! 🎊</div><div class="motiv-text">100% listo – solo falta presionar enviar. ¡Tu solicitud está completa!</div></div>
    <div class="motiv-card-bottom">
      <button class="motiv-btn motiv-btn-100" onclick="closeMotivModal('motivModal100');document.getElementById('btnSub').scrollIntoView({behavior:'smooth',block:'center'})">¡Enviar ahora! 🚀</button>
    </div>
  </div>
</div>

<!-- MODAL ÉXITO -->
<div class="success-overlay" id="successOverlay">
  <div class="success-card">
    <div class="success-header">
      <div class="success-checkmark">
        <svg viewBox="0 0 36 36" fill="none">
          <path d="M7 18l7 7L29 11" stroke="white" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="success-title">¡Solicitud Enviada!</div>
      <div class="success-subtitle">Crédito Vehicular AVA · ANPAI</div>
    </div>
    <div class="success-body">
      <div class="success-info-row">
        <div class="success-info-icon">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" stroke="#165DFF" stroke-width="1.8"/><path d="M12 8v4l3 3" stroke="#165DFF" stroke-width="1.8" stroke-linecap="round"/></svg>
        </div>
        <div class="success-info-text">
          <strong>Siguiente paso</strong>
          Un ejecutivo revisará tu información y te contactará en 24 a 48 horas hábiles para continuar con tu crédito vehicular.
        </div>
      </div>
      <div class="success-info-row">
        <div class="success-info-icon">
          <svg viewBox="0 0 24 24" fill="none"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" stroke="#165DFF" stroke-width="1.8" stroke-linecap="round"/></svg>
        </div>
        <div class="success-info-text">
          <strong>Contacto directo</strong>
          <div class="success-contact-list">
            <div class="success-contact-item">📞 <a href="tel:+525525374608">+52 (55) 2537-4608</a></div>
            <div class="success-contact-item">✉️ <a href="mailto:info@anpai.com.mx">info@anpai.com.mx</a></div>
            <div class="success-contact-item">🌐 <a href="https://www.anpai.com.mx" target="_blank">www.anpai.com.mx</a></div>
          </div>
        </div>
      </div>
      <div class="success-divider"></div>
      <button class="success-close-btn" onclick="closeSuccessModal()">Volver al Formulario</button>
    </div>
  </div>
</div>

<!-- OVERLAY ENVIANDO -->
<div class="s-ov" id="sOv">
  <div class="s-ring"></div>
  <div class="s-msg">Enviando solicitud…</div>
</div>

<!-- WHATSAPP -->
<a href="https://wa.me/525525374608?text=Hola%20AVA%2C%20tengo%20una%20consulta%20sobre%20el%20cr%C3%A9dito%20vehicular" class="wa-float" target="_blank" rel="noopener noreferrer" aria-label="Chatear con AVA por WhatsApp">
  <span class="wa-tip">💬 ¿Dudas? Chatea con nosotros</span>
  <svg class="wa-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.67-1.612-.92-2.207-.24-.579-.487-.5-.67-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.76.982.998-3.675-.236-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.9 6.994c-.004 5.45-4.436 9.88-9.885 9.88m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"/>
  </svg>
</a>

<script>
(function(){
'use strict';
var RECAPTCHA_SITE_KEY='6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV';
var CP_TOKEN='36da398a-1848-44f3-a952-06c9bfb02cc8';
var THEME_STORAGE_KEY='ava-credito-theme';
function Q(id){return document.getElementById(id);}
function V(id){var e=Q(id);return e?e.value:'';}
function SHOW(id){var e=Q(id);if(e)e.style.display='';}
function HIDE(id){var e=Q(id);if(e)e.style.display='none';}
function SHOWF(id){var e=Q(id);if(e)e.style.display='flex';}
function setErr(id,msg){var e=Q('e'+id);if(e)e.textContent=msg;var i=Q(id);if(i){i.classList.add('bad');i.classList.remove('ok');}}
function clrErr(id){var e=Q('e'+id);if(e)e.textContent='';var i=Q(id);if(i){i.classList.remove('bad');if(i.value&&i.value.trim())i.classList.add('ok');}}

// THEME
(function(){
  try{if(localStorage.getItem(THEME_STORAGE_KEY)==='dark')document.body.classList.add('dark-mode');}catch(e){}
  var btn=Q('themeToggleBtn');
  if(btn)btn.addEventListener('click',function(){var isDark=document.body.classList.toggle('dark-mode');try{localStorage.setItem(THEME_STORAGE_KEY,isDark?'dark':'light');}catch(e){}});
})();

// ADJUNTOS
var MAX_ZIP_BYTES=5*1024*1024;
var attachState={'AVA':{files:[],zipBlob:null,compressing:false,paused:false,startTime:null,elapsed:0,_runId:null}};
var compressionTimers={};
function fmtBytes(b){if(b<1024)return b+'B';if(b<1048576)return(b/1024).toFixed(1)+' KB';return(b/1048576).toFixed(2)+' MB';}
function fmtSec(s){return s<60?Math.round(s)+'s':Math.floor(s/60)+'m '+Math.round(s%60)+'s';}
function getFileIcon(name){var ext=name.split('.').pop().toLowerCase();if(['jpg','jpeg','png','gif','webp'].indexOf(ext)>=0)return'🖼️';if(ext==='pdf')return'📄';if(['doc','docx'].indexOf(ext)>=0)return'📝';return'📎';}
function getToday(){var d=new Date();return d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0');}
function onDragOver(e,type){e.preventDefault();Q('attachDropzone'+type).classList.add('drag-over');}
function onDragLeave(e,type){Q('attachDropzone'+type).classList.remove('drag-over');}
function onDrop(e,type){e.preventDefault();Q('attachDropzone'+type).classList.remove('drag-over');handleFiles(e.dataTransfer.files,type);}
function handleFiles(fileList,type){var state=attachState[type];Array.from(fileList).forEach(function(f){var dup=state.files.some(function(ex){return ex.name===f.name&&ex.size===f.size;});if(!dup)state.files.push(f);});state.zipBlob=null;renderFileList(type);updateCapacityBar(type);if(state.files.length>=1&&typeof JSZip!=='undefined')scheduleCompression(type);if(state.files.length>0){var eu=Q('eupErr');if(eu){eu.textContent='';eu.style.display='none';}Q('attachDropzone'+type).classList.remove('attach-error');}updateProgressBar();if(Q('sumBox')&&Q('sumBox').style.display!=='none')buildSummary();}
function removeFile(type,idx){var state=attachState[type];state.files.splice(idx,1);state.zipBlob=null;renderFileList(type);hideAttachMsg(type);updateCapacityBar(type);if(state.files.length>=1&&typeof JSZip!=='undefined')scheduleCompression(type);updateProgressBar();if(Q('sumBox')&&Q('sumBox').style.display!=='none')buildSummary();}
function renderFileList(type){var list=Q('fileList'+type);list.innerHTML='';attachState[type].files.forEach(function(f,i){var item=document.createElement('div');item.className='attach-file-item';item.innerHTML='<span class="attach-file-icon">'+getFileIcon(f.name)+'</span><span class="attach-file-name">'+f.name+'</span><span class="attach-file-size">'+fmtBytes(f.size)+'</span><button type="button" class="attach-file-remove" onclick="removeFile(\''+type+'\','+i+')">\u00d7</button>';list.appendChild(item);});}
function updateCapacityBar(type){var state=attachState[type];var wrap=Q('capacityWrap'+type);var bar=Q('attachBar'+type);var valEl=Q('capacityValue'+type);var dot=Q('attachDot'+type);var statusTxt=Q('attachStatusText'+type);var rtStats=Q('attachRealtime'+type);var rtCount=Q('attachCount'+type);var rtWeight=Q('attachWeight'+type);var errEl=Q('attachErr'+type);if(state.files.length===0){if(wrap)wrap.classList.remove('visible');if(rtStats)rtStats.classList.remove('visible');if(errEl)errEl.classList.remove('show');if(bar){bar.className='attach-bar-fill green';bar.style.width='0%';}return;}if(wrap)wrap.classList.add('visible');if(rtStats)rtStats.classList.add('visible');if(rtCount)rtCount.textContent=state.files.length;if(!state.zipBlob){var rawSize=state.files.reduce(function(s,f){return s+f.size;},0);var rawPct=Math.min(100,(rawSize/MAX_ZIP_BYTES)*100);if(bar){bar.className='attach-bar-fill green';bar.style.width=rawPct+'%';}if(dot){dot.className='attach-status-dot green';}if(statusTxt)statusTxt.textContent=state.compressing?'Comprimiendo archivos…':'ZIP listo — quedan '+fmtBytes(Math.max(0,MAX_ZIP_BYTES-rawSize))+' disponibles';if(valEl)valEl.textContent=fmtBytes(rawSize)+' de 5 MB (ZIP comprimido)';if(rtWeight)rtWeight.textContent=fmtBytes(rawSize);if(errEl)errEl.classList.remove('show');return;}var zSize=state.zipBlob.size;var pct=Math.min(100,(zSize/MAX_ZIP_BYTES)*100);var zStr=fmtBytes(zSize);if(bar)bar.style.width=pct+'%';if(valEl)valEl.textContent=zStr+' de 5 MB (ZIP comprimido)';if(rtWeight)rtWeight.textContent=zStr;if(bar)bar.className='attach-bar-fill';if(dot)dot.className='attach-status-dot';if(zSize>=MAX_ZIP_BYTES){if(bar)bar.classList.add('red');if(dot)dot.classList.add('red');if(statusTxt)statusTxt.textContent='ZIP supera 5 MB — elimina archivos';if(errEl){Q('attachErrText'+type).textContent='El ZIP pesa '+zStr+' y supera el límite. Elimina archivos.';errEl.classList.add('show');}}else if(zSize>=MAX_ZIP_BYTES*0.80){if(bar)bar.classList.add('yellow');if(dot)dot.classList.add('yellow');if(statusTxt)statusTxt.textContent='Casi lleno — quedan '+fmtBytes(MAX_ZIP_BYTES-zSize)+' en el ZIP';if(errEl)errEl.classList.remove('show');}else{if(bar)bar.classList.add('green');if(dot)dot.classList.add('green');if(statusTxt)statusTxt.textContent='ZIP listo — quedan '+fmtBytes(MAX_ZIP_BYTES-zSize)+' disponibles';if(errEl)errEl.classList.remove('show');}}
function showAttachMsg(type,level,msg){var el=Q('attachErr'+type);var tx=Q('attachErrText'+type);if(tx)tx.textContent=msg;if(el)el.classList.add('show');}
function hideAttachMsg(type){var el=Q('attachErr'+type);if(el)el.classList.remove('show');}
function scheduleCompression(type){clearTimeout(compressionTimers[type]);compressionTimers[type]=setTimeout(function(){startCompression(type);},80);}
function startCompression(type){var state=attachState[type];if(state.compressing){state.compressing=false;}if(state.files.length===0)return;if(!navigator.onLine){Q('offlineMsg'+type).classList.add('show');state.paused=true;Q('compressResume'+type).classList.add('show');Q('compressProgress'+type).classList.add('show');return;}var snapshot=state.files.slice();var runId=Date.now();var zip=new JSZip();var totalRaw=snapshot.reduce(function(a,f){return a+f.size;},0);var processed=0;state.compressing=true;state.paused=false;state.startTime=Date.now();state.elapsed=0;state._runId=runId;Q('compressProgress'+type).classList.add('show');updateCapacityBar(type);var ticker=setInterval(function(){if(!state.compressing||state._runId!==runId){clearInterval(ticker);return;}state.elapsed=Date.now()-state.startTime;var el=Q('compressElapsed'+type);if(el)el.textContent=fmtSec(state.elapsed/1000);},300);function abort(){clearInterval(ticker);state.compressing=false;Q('compressProgress'+type).classList.remove('show');}function processFile(idx){if(state._runId!==runId||!state.compressing){abort();return;}if(idx>=snapshot.length){Q('compressInfo'+type).textContent='Generando ZIP…';zip.generateAsync({type:'blob',compression:'DEFLATE',compressionOptions:{level:6}},function(meta){if(state._runId!==runId)return;updateCompressUI(type,Math.round(meta.percent),processed,0,(Date.now()-state.startTime)/1000,totalRaw);}).then(function(blob){clearInterval(ticker);if(state._runId!==runId){abort();return;}state.compressing=false;state.zipBlob=blob;Q('compressProgress'+type).classList.remove('show');updateCapacityBar(type);var h=Q('attachHidden'+type);if(h)h.value='ZIP: archivos-'+getToday()+'.zip ('+fmtBytes(blob.size)+')';updateProgressBar();}).catch(function(){abort();showAttachMsg(type,'error','Error al comprimir. Intenta de nuevo.');});return;}var f=snapshot[idx];var reader=new FileReader();reader.onload=function(ev){if(state._runId!==runId){abort();return;}zip.file(f.name,ev.target.result);processed+=f.size;var pct=Math.round((processed/totalRaw)*70);updateCompressUI(type,pct,processed,totalRaw-processed,(Date.now()-state.startTime)/1000,totalRaw);if(!navigator.onLine){clearInterval(ticker);state.paused=true;state.compressing=false;Q('offlineMsg'+type).classList.add('show');Q('compressResume'+type).classList.add('show');return;}setTimeout(function(){processFile(idx+1);},0);};reader.onerror=function(){setTimeout(function(){processFile(idx+1);},0);};reader.readAsArrayBuffer(f);}processFile(0);}
function updateCompressUI(type,pct,done,remaining,elapsedSec,total){var ids={pct:'compressPct',bar:'compressBarFill',done:'compressDoneMB',rem:'compressRemMB',donePct:'compressDonePct',elapsed:'compressElapsed',eta:'compressEta',info:'compressInfo'};Object.keys(ids).forEach(function(k){var el=Q(ids[k]+type);if(!el)return;if(k==='pct')el.textContent=pct+'%';if(k==='bar')el.style.width=pct+'%';if(k==='done')el.textContent=fmtBytes(done);if(k==='rem')el.textContent=fmtBytes(remaining);if(k==='donePct')el.textContent=pct+'% completado';if(k==='elapsed')el.textContent=fmtSec(elapsedSec);if(k==='eta')el.textContent=(pct>5&&elapsedSec>0)?fmtSec((elapsedSec/pct)*(100-pct)):'—';if(k==='info')el.textContent='Procesando '+attachState[type].files.length+' archivo(s)…';});}
window.addEventListener('online',function(){Object.keys(attachState).forEach(function(type){var state=attachState[type];Q('offlineMsg'+type).classList.remove('show');if(state.paused&&state.files.length>=1){state.paused=false;startCompression(type);}});});
window.addEventListener('offline',function(){Object.keys(attachState).forEach(function(type){var state=attachState[type];Q('offlineMsg'+type).classList.add('show');if(state.compressing){state.paused=true;state.compressing=false;state.elapsed=Date.now()-state.startTime;Q('compressResume'+type).classList.add('show');}});});

// MODALES MOTIVACIONALES
var motivShown={25:false,50:false,75:false,100:false};
var lastPct=0;
function showMotivModal(id){var el=Q(id);if(el)el.classList.add('show');document.body.style.overflow='hidden';}
function closeMotivModal(id){var el=Q(id);if(el)el.classList.remove('show');var modals=['motivModal25','motivModal50','motivModal75','motivModal100','successOverlay'];var anyOpen=modals.some(function(mid){var e=Q(mid);return e&&e.classList.contains('show');});if(!anyOpen)document.body.style.overflow='';}
function showSuccessModal(){Q('successOverlay').classList.add('show');document.body.style.overflow='hidden';}
function closeSuccessModal(){Q('successOverlay').classList.remove('show');document.body.style.overflow='';resetForm();Object.keys(attachState).forEach(function(type){attachState[type]={files:[],zipBlob:null,compressing:false,paused:false,startTime:null,elapsed:0,_runId:null};var fl=Q('fileList'+type);if(fl)fl.innerHTML='';var cp=Q('compressProgress'+type);if(cp)cp.classList.remove('show');var om=Q('offlineMsg'+type);if(om)om.classList.remove('show');updateCapacityBar(type);});motivShown={25:false,50:false,75:false,100:false};lastPct=0;window.scrollTo({top:0,behavior:'smooth'});}
function resetForm(){Q('frm').reset();document.querySelectorAll('.ok,.bad').forEach(function(el){el.classList.remove('ok','bad');});document.querySelectorAll('.em').forEach(function(el){el.textContent='';});Q('regimenBlk').classList.remove('open');Q('depBlk').classList.remove('open');Q('depAges').innerHTML='';HIDE('colBlk');Q('municipio').value='';Q('estado').value='';Q('hCiu').value='';Q('colSel').value='';HIDE('colRegLbl');HIDE('colSel');Q('colonia').innerHTML='<option value="" disabled selected>Selecciona tu colonia</option>';declChecked=false;Q('chkVis').classList.remove('on');Q('declBox').classList.remove('ok','bad');Q('declVal').value='';syncSubmitBtn();slideTo(1);updateProgressBar();}
document.addEventListener('click',function(e){if(e.target&&e.target.id==='successOverlay')closeSuccessModal();});

// PROGRESO FLOTANTE
var cur=1,TOTAL=5;
var declChecked=false;
function getStepTokens(step){if(step===1){var tokens=[{type:'field',id:'pNombre'},{type:'field',id:'pApellido'},{type:'field',id:'sApellido'},{type:'field',id:'genero'},{type:'field',id:'fNac'},{type:'field',id:'estCivil'},{type:'condField',id:'regimen',condId:'estCivil',condVal:'Casado(a)'},{type:'field',id:'rfc'},{type:'field',id:'curp'},{type:'tel',numId:'telP'},{type:'field',id:'emailP'},{type:'field',id:'tieneDep'},{type:'condField',id:'numDep',condId:'tieneDep',condVal:'Si'}];if(V('tieneDep')==='Si'){var nd=parseInt(V('numDep'))||0;for(var i=1;i<=nd;i++)tokens.push({type:'depAge',idx:i});}return tokens;}if(step===2)return[{type:'field',id:'calle'},{type:'field',id:'numExt'},{type:'field',id:'cp'},{type:'condVisible',id:'colonia',visId:'colBlk'},{type:'field',id:'municipio'},{type:'field',id:'estado'}];if(step===3){var t=[];['f1','f2','a1','a2'].forEach(function(p){t.push({type:'field',id:p+'n'});t.push({type:'tel',numId:p+'t'});t.push({type:'field',id:p+'e'});t.push({type:'field',id:p+'d'});});return t;}if(step===4)return[{type:'field',id:'marca'},{type:'condField',id:'otraMarca',condId:'marca',condVal:'Otra'},{type:'field',id:'version'},{type:'field',id:'anio'},{type:'field',id:'costo'},{type:'radio',name:'tipoPago'},{type:'pagoVal'}];if(step===5)return[{type:'upload'},{type:'decl'}];return[];}
function isTokenFilled(tok){switch(tok.type){case'field':var el=Q(tok.id);if(!el)return true;return el.value.trim().length>0;case'tel':var tel=Q(tok.numId);if(!tel)return true;return tel.value.replace(/\D/g,'').length>=7;case'radio':return document.querySelector('input[name="'+tok.name+'"]:checked')!==null;case'condField':{var tCF=Q(tok.id);if(!tCF||tCF.disabled)return false;return tCF.value.trim().length>0;}case'condVisible':{var fCV=Q(tok.id);if(!fCV)return false;return fCV.value.trim().length>0;}case'depAge':{var sEl=Q('depAge'+tok.idx);if(!sEl)return true;if(sEl.value==='manual'){var mEl=Q('depAge'+tok.idx+'M');return mEl&&mEl.value.trim().length>0;}return sEl.value.trim().length>0;}case'pagoVal':{var tp=document.querySelector('input[name="tipoPago"]:checked');if(!tp)return false;if(tp.value==='enganche'){var et=document.querySelector('input[name="engTipo"]:checked');if(et&&et.value==='porcentaje'){var pr=V('valEng').replace(/[^0-9.]/g,'');return pr.length>0&&parseFloat(pr)>0;}else{var mn=V('valEngMonto').replace(/[^0-9.]/g,'');return mn.length>0&&parseFloat(mn)>0;}}else{var vm=V('valMon').replace(/[^0-9.]/g,'');return vm.length>0&&parseFloat(vm)>0;}}case'upload':return attachState['AVA'].files.length>0;case'decl':return declChecked;default:return true;}}
function isTokenActive(tok){switch(tok.type){case'condField':{var cEl=Q(tok.condId);if(!cEl||cEl.value!==tok.condVal)return false;var t=Q(tok.id);if(!t||t.disabled)return false;return true;}case'condVisible':{var vis=Q(tok.visId);if(!vis||vis.style.display==='none')return false;return true;}default:return true;}}
function updateProgressBar(){var tokens=getStepTokens(cur);var total=0,done=0;tokens.forEach(function(tok){if(!isTokenActive(tok))return;total++;if(isTokenFilled(tok))done++;});var pct=total>0?Math.floor((done/total)*100):0;var fill=Q('formProgressFill');if(fill)fill.style.width=pct+'%';var doneEl=Q('formProgressDone');if(doneEl)doneEl.textContent=done;var totEl=Q('formProgressTotal');if(totEl)totEl.textContent=total;var allTotal=0,allDone=0;for(var s=1;s<=TOTAL;s++){var st=getStepTokens(s);st.forEach(function(tok){if(!isTokenActive(tok))return;allTotal++;if(isTokenFilled(tok))allDone++;});}var globalPct=allTotal>0?Math.floor((allDone/allTotal)*100):0;if(globalPct>=100&&lastPct<100&&!motivShown[100]){motivShown[100]=true;setTimeout(function(){showMotivModal('motivModal100');},400);}else if(globalPct>=75&&lastPct<75&&!motivShown[75]){motivShown[75]=true;setTimeout(function(){showMotivModal('motivModal75');},400);}else if(globalPct>=50&&lastPct<50&&!motivShown[50]){motivShown[50]=true;setTimeout(function(){showMotivModal('motivModal50');},400);}else if(globalPct>=25&&lastPct<25&&!motivShown[25]){motivShown[25]=true;setTimeout(function(){showMotivModal('motivModal25');},400);}lastPct=globalPct;}
function attachProgressListeners(){var frm=Q('frm');if(frm._progressListened)return;frm._progressListened=true;['input','change'].forEach(function(ev){frm.addEventListener(ev,function(){updateProgressBar();});});}

// NAVEGACIÓN
function slideTo(n){document.querySelectorAll('.sec').forEach(function(s){s.classList.remove('active');});Q('s'+n).classList.add('active');document.querySelectorAll('.step').forEach(function(s,i){s.classList.remove('active','done');if(i+1<n)s.classList.add('done');if(i+1===n)s.classList.add('active');});Q('curS').textContent=n;Q('btnPrev').disabled=(n===1);var last=(n===TOTAL);Q('btnNext').style.display=last?'none':'inline-flex';Q('btnSub').style.display=last?'inline-flex':'none';if(last)buildSummary();cur=n;updateProgressBar();window.scrollTo({top:Q('prog').offsetTop-20,behavior:'smooth'});}
Q('btnNext').addEventListener('click',function(){if(validateSection(cur)){if(cur<TOTAL)slideTo(cur+1);}else{var f=Q('s'+cur).querySelector('.bad,.tel-wr.bad,.decl-box.bad');if(f)f.scrollIntoView({behavior:'smooth',block:'center'});}});
Q('btnPrev').addEventListener('click',function(){if(cur>1)slideTo(cur-1);});
document.querySelectorAll('.step').forEach(function(s){s.addEventListener('click',function(){var t=parseInt(s.dataset.s);if(t<=cur)slideTo(t);});});

// AÑO
(function(){var s=Q('anio'),y=new Date().getFullYear();for(var i=y+1;i>=2000;i--){var o=document.createElement('option');o.value=i;o.textContent=i;s.appendChild(o);}})();

// RFC / CURP
['rfc','curp'].forEach(function(id){Q(id).addEventListener('input',function(){this.value=this.value.toUpperCase();});});
Q('rfc').addEventListener('blur',function(){var v=this.value.toUpperCase().trim();if(!v)return;var ok=/^[A-ZÑ&]{3,4}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[A-Z\d]{3}$/.test(v);if(!ok)setErr('rfc','RFC inválido. Verifica: letras + fecha (AAMMDD) + homoclave.');else clrErr('rfc');});
Q('curp').addEventListener('blur',function(){var v=this.value.toUpperCase().trim();if(!v)return;var ok=/^[A-Z]{4}\d{6}[HM][A-Z]{2}[B-DF-HJ-NP-TV-Z]{3}[A-Z0-9]\d$/.test(v);if(!ok)setErr('curp','Formato inválido según RENAPO (18 caracteres).');else clrErr('curp');});

// EDAD
Q('fNac').addEventListener('change',function(){if(!this.value){Q('edad').value='';return;}var b=new Date(this.value),t=new Date(),a=t.getFullYear()-b.getFullYear();if(t.getMonth()<b.getMonth()||(t.getMonth()===b.getMonth()&&t.getDate()<b.getDate()))a--;Q('edad').value=a>=0?a+' años':'';});

// ESTADO CIVIL
Q('estCivil').addEventListener('change',function(){var blk=Q('regimenBlk'),sel=Q('regimen');if(this.value==='Casado(a)'){blk.classList.add('open');sel.disabled=false;}else{blk.classList.remove('open');sel.disabled=true;sel.value='';sel.classList.remove('ok','bad');var e=Q('eregimen');if(e)e.textContent='';}clrErr('estCivil');updateProgressBar();});

// DEPENDIENTES
var RANGOS=['0–5 años','6–12 años','13–18 años','19+ años'];
function buildDepFields(n){var c=Q('depAges');c.innerHTML='';Q('edepAges').textContent='';for(var i=1;i<=n;i++){var id='depAge'+i;var item=document.createElement('div');item.className='dep-item';item.innerHTML='<label class="dep-lbl" for="'+id+'">Dependiente '+i+'</label><select id="'+id+'" name="'+id+'"><option value="" disabled selected>Rango de edad</option>'+RANGOS.map(function(r){return'<option value="'+r+'">'+r+'</option>';}).join('')+'<option value="manual">Ingresar edad…</option></select><input type="number" id="'+id+'M" name="'+id+'M" min="0" max="99" placeholder="Edad exacta" style="display:none;margin-top:.35rem"><span class="em" id="e'+id+'"></span>';c.appendChild(item);(function(sId,mId){Q(sId).addEventListener('change',function(){if(this.value==='manual'){SHOW(mId);Q(mId).focus();}else{HIDE(mId);Q(mId).value='';}updateProgressBar();});})(id,id+'M');}updateProgressBar();}
Q('tieneDep').addEventListener('change',function(){var blk=Q('depBlk'),num=Q('numDep');clrErr('tieneDep');if(this.value==='Si'){blk.classList.add('open');num.disabled=false;}else{blk.classList.remove('open');num.disabled=true;num.value='';Q('depAges').innerHTML='';num.classList.remove('ok','bad');var e=Q('enumDep');if(e)e.textContent='';}updateProgressBar();});
Q('numDep').addEventListener('change',function(){var n=parseInt(this.value);if(n>0)buildDepFields(n);clrErr('numDep');});

// TELÉFONOS
function initTelField(numId,ladaId,hiddenId,wrId){function update(){var lada=Q(ladaId)?Q(ladaId).value:'+52';var num=(Q(numId)?Q(numId).value:'').replace(/\D/g,'');if(Q(hiddenId))Q(hiddenId).value=num?lada+' '+num:'';}function setWrapState(state){if(!Q(wrId))return;Q(wrId).classList.remove('ok','bad');if(state)Q(wrId).classList.add(state);if(Q(numId))Q(numId).classList.remove('ok','bad');}if(Q(ladaId))Q(ladaId).addEventListener('change',update);if(Q(numId)){Q(numId).addEventListener('input',function(){var raw=this.value.replace(/\D/g,'');if(this.value!==raw)this.value=raw;update();setWrapState(null);var e=Q('e'+numId);if(e)e.textContent='';updateProgressBar();});Q(numId).addEventListener('blur',function(){update();var num=this.value.replace(/\D/g,'');if(num.length>0&&num.length<7){setWrapState('bad');var e=Q('e'+numId);if(e)e.textContent='Mín. 7 dígitos.';}else if(num.length>=7){setWrapState('ok');var e=Q('e'+numId);if(e)e.textContent='';}});}update();}
initTelField('telP','ladaP','telPFull','telPWr');
initTelField('f1t','ladaf1t','f1tFull','f1tWr');
initTelField('f2t','ladaf2t','f2tFull','f2tWr');
initTelField('a1t','ladaa1t','a1tFull','a1tWr');
initTelField('a2t','ladaa2t','a2tFull','a2tWr');

// COPOMEX
function cpClear(){HIDE('cpSpin');Q('cp').disabled=false;HIDE('cpErrBox');Q('cpErrBox').textContent='';HIDE('cpRetry');HIDE('colBlk');Q('colonia').innerHTML='<option value="" disabled selected>Selecciona tu colonia</option>';Q('colonia').classList.remove('ok','bad');Q('colCnt').textContent='';HIDE('colRegLbl');HIDE('colSel');Q('colSel').value='';Q('municipio').value='';Q('municipio').classList.remove('ok','bad','autofill');Q('estado').value='';Q('estado').classList.remove('ok','bad','autofill');Q('hCiu').value='';clrErr('cp');updateProgressBar();}
function cpFail(msg){HIDE('cpSpin');Q('cp').disabled=false;Q('cpErrBox').textContent=msg;SHOW('cpErrBox');SHOW('cpRetry');setErr('cp',msg);updateProgressBar();}
function cpFetch(cp){cpClear();SHOW('cpSpin');Q('cp').disabled=true;clrErr('cp');fetch('https://api.copomex.com/query/info_cp/'+cp+'?token='+CP_TOKEN).then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.json();}).then(function(data){HIDE('cpSpin');Q('cp').disabled=false;if(!Array.isArray(data)||data.length===0){cpFail('Código postal no encontrado.');return;}var first=data[0];if(first.error===true||first.error==='true'){cpFail(first.error_message||'C.P. no encontrado.');return;}var resp=first.response||{};var mun=resp.municipio||'',est=resp.estado||'',ciu=resp.ciudad||'';if(mun){Q('municipio').value=mun;Q('municipio').classList.add('ok','autofill');}if(est){Q('estado').value=est;Q('estado').classList.add('ok','autofill');}if(ciu)Q('hCiu').value=ciu;var seen={},cols=[];data.forEach(function(item){if(!item.error&&item.response&&item.response.asentamiento){var c=(item.response.asentamiento||'').trim();if(c&&!seen[c]){seen[c]=1;cols.push(c);}}});cols.sort(function(a,b){return a.localeCompare(b,'es',{sensitivity:'base'});});if(cols.length===0){cpFail('No se encontraron colonias para este C.P.');return;}var sel=Q('colonia');cols.forEach(function(c){var o=document.createElement('option');o.value=c;o.textContent=c;sel.appendChild(o);});Q('colCnt').textContent=cols.length+' colonia'+(cols.length!==1?'s':'');SHOW('colBlk');Q('cp').classList.add('ok');Q('cp').classList.remove('bad');updateProgressBar();}).catch(function(err){HIDE('cpSpin');Q('cp').disabled=false;cpFail(err.message&&err.message.indexOf('HTTP')===0?'Error '+err.message+' al consultar COPOMEX.':'Sin conexión con COPOMEX.');});}
function cpTrigger(){var v=Q('cp').value.replace(/\D/g,'');Q('cp').value=v;if(v.length===5)cpFetch(v);else if(v.length>0)setErr('cp','El código postal debe tener 5 dígitos.');}
Q('cp').addEventListener('blur',cpTrigger);
Q('cp').addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();cpTrigger();}});
Q('cp').addEventListener('input',function(){var raw=this.value.replace(/\D/g,'').slice(0,5);if(this.value!==raw)this.value=raw;cpClear();this.classList.remove('ok','bad');});
Q('cpRetry').addEventListener('click',function(){var v=Q('cp').value.replace(/\D/g,'');if(v.length===5)cpFetch(v);});
Q('colonia').addEventListener('change',function(){if(this.value){this.classList.add('ok');this.classList.remove('bad');Q('colSel').value=this.value;SHOW('colRegLbl');SHOW('colSel');clrErr('colonia');}else{Q('colSel').value='';HIDE('colRegLbl');HIDE('colSel');}updateProgressBar();});

// MARCA
Q('marca').addEventListener('change',function(){var blk=Q('otraMarcaBlk'),inp=Q('otraMarca');if(this.value==='Otra'){blk.style.display='';inp.disabled=false;inp.focus();}else{blk.style.display='none';inp.disabled=true;inp.value='';inp.classList.remove('ok','bad');var e=Q('eotraMarca');if(e)e.textContent='';}clrErr('marca');updateProgressBar();});

// ENGANCHE
var ENG_MIN=0,ENG_MAX=100,ENG_STEP=5,ENG_DEFAULT=10;
function engGetPct(){var raw=V('valEng').replace(/[^0-9.]/g,'');var n=parseFloat(raw);return isNaN(n)?ENG_DEFAULT:Math.min(ENG_MAX,Math.max(ENG_MIN,n));}
function engSetPct(n){n=Math.min(ENG_MAX,Math.max(ENG_MIN,Math.round(n)));Q('valEng').value=n+'%';Q('valEng').classList.remove('bad');clrErr('valEng');updateProgressBar();}
Q('engPlus').addEventListener('click',function(){engSetPct(engGetPct()+ENG_STEP);});
Q('engMinus').addEventListener('click',function(){engSetPct(engGetPct()-ENG_STEP);});
Q('valEng').addEventListener('input',function(){var raw=this.value.replace(/[^0-9.]/g,''),pos=this.selectionStart;if(raw!==''){this.value=raw+'%';var np=Math.min(pos,raw.length);this.setSelectionRange(np,np);}updateProgressBar();});
Q('valEng').addEventListener('blur',function(){var raw=this.value.replace(/[^0-9.]/g,'');if(raw!=='')this.value=Math.min(ENG_MAX,Math.max(ENG_MIN,parseFloat(raw)||0))+'%';});
Q('valEng').addEventListener('focus',function(){var len=this.value.replace('%','').length;setTimeout(function(){Q('valEng').setSelectionRange(len,len);},0);});
Q('valEng').addEventListener('keydown',function(e){if(e.key==='ArrowUp'){e.preventDefault();engSetPct(engGetPct()+ENG_STEP);}if(e.key==='ArrowDown'){e.preventDefault();engSetPct(engGetPct()-ENG_STEP);}});
document.querySelectorAll('input[name=engTipo]').forEach(function(r){r.addEventListener('change',function(){var esPct=(this.value==='porcentaje');if(esPct){Q('engPctCtrl').style.display='';Q('engMonCtrl').style.display='none';if(!V('valEng'))engSetPct(ENG_DEFAULT);}else{Q('engPctCtrl').style.display='none';Q('engMonCtrl').style.display='';Q('valEngMonto').focus();}clrErr('valEng');updateProgressBar();});});
document.querySelectorAll('input[name=tipoPago]').forEach(function(r){r.addEventListener('change',function(){HIDE('payH');if(this.value==='enganche'){SHOWF('engF');HIDE('monF');Q('valMon').value='';if(!V('valEng'))engSetPct(ENG_DEFAULT);}else{SHOWF('monF');HIDE('engF');Q('valEng').value='';}updateProgressBar();});});

// DECLARACIÓN
function syncSubmitBtn(){var btn=Q('btnSub');if(!btn)return;btn.disabled=!declChecked;}
function toggleDecl(){declChecked=!declChecked;var vis=Q('chkVis'),box=Q('declBox'),row=Q('declRow');if(declChecked){vis.classList.add('on');box.classList.add('ok');box.classList.remove('bad');Q('declVal').value='Acepto';row.setAttribute('aria-checked','true');var e=Q('edecl');if(e)e.textContent='';}else{vis.classList.remove('on');box.classList.remove('ok');Q('declVal').value='';row.setAttribute('aria-checked','false');}syncSubmitBtn();updateProgressBar();}
Q('declRow').addEventListener('click',toggleDecl);
Q('declRow').addEventListener('keydown',function(e){if(e.key===' '||e.key==='Enter'){e.preventDefault();toggleDecl();}});

// FOCO PRIMER INVÁLIDO
function focusFirstInvalid(){for(var s=1;s<=TOTAL;s++){var sec=Q('s'+s);if(!sec)continue;var candidates=[];sec.querySelectorAll('input.bad,select.bad,textarea.bad').forEach(function(el){if(!el.disabled&&el.type!=='hidden'&&el.type!=='radio'&&el.type!=='checkbox')candidates.push(el);});sec.querySelectorAll('.tel-wr.bad .tel-num').forEach(function(el){candidates.push(el);});if(s===5){var dropErr=Q('eupErr');if(dropErr&&dropErr.textContent.trim())candidates.push(Q('attachDropzoneAVA'));if(!declChecked){var dr=Q('declRow');if(dr)candidates.push(dr);}}if(candidates.length>0){var firstEl=candidates[0];var delay=60;if(s!==cur){slideTo(s);delay=380;}setTimeout(function(el){return function(){el.scrollIntoView({behavior:'smooth',block:'center'});if(typeof el.focus==='function')el.focus({preventScroll:true});var origBox=el.style.boxShadow,origTrans=el.style.transition;el.style.transition='box-shadow .12s';el.style.boxShadow='0 0 0 5px rgba(229,57,53,.5)';setTimeout(function(){el.style.boxShadow='0 0 0 0px rgba(229,57,53,0)';setTimeout(function(){el.style.boxShadow='0 0 0 5px rgba(229,57,53,.5)';setTimeout(function(){el.style.boxShadow=origBox;el.style.transition=origTrans;},200);},160);},220);};}(firstEl),delay);return true;}}return false;}

// VALIDACIONES
function isEmpty(v){return!v||!String(v).trim();}
function isName(v){return/^[a-záéíóúüñA-ZÁÉÍÓÚÜÑ\s]{2,}$/.test((v||'').trim());}
function isEmail(v){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v||'').trim());}
function validateSection(n){if(n===1)return vSec1();if(n===2)return vSec2();if(n===3)return vSec3();if(n===4)return vSec4();if(n===5)return vSec5();return true;}
function vSec1(){var ok=true;function req(id,msg){if(isEmpty(V(id))){setErr(id,msg||'Campo requerido.');ok=false;}else clrErr(id);}function chk(id,fn,msg){if(!fn(V(id))){setErr(id,msg);ok=false;}else clrErr(id);}chk('pNombre',isName,'Solo letras y espacios, mín. 2 caracteres.');chk('pApellido',isName,'Solo letras y espacios, mín. 2 caracteres.');chk('sApellido',isName,'Solo letras y espacios, mín. 2 caracteres.');req('genero','Selecciona una opción.');if(isEmpty(V('fNac'))){setErr('fNac','Selecciona tu fecha de nacimiento.');ok=false;}else{var b=new Date(V('fNac')),t=new Date(),a=t.getFullYear()-b.getFullYear();if(t.getMonth()<b.getMonth()||(t.getMonth()===b.getMonth()&&t.getDate()<b.getDate()))a--;if(a<18){setErr('fNac','Debes ser mayor de 18 años.');ok=false;}else clrErr('fNac');}req('estCivil','Selecciona tu estado civil.');if(V('estCivil')==='Casado(a)')req('regimen','Selecciona el régimen matrimonial.');var rfcVal=V('rfc').toUpperCase();if(!/^[A-ZÑ&]{3,4}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[A-Z\d]{3}$/.test(rfcVal)){setErr('rfc','RFC inválido.');ok=false;}else clrErr('rfc');var cv=V('curp').toUpperCase();if(!/^[A-Z]{4}\d{6}[HM][A-Z]{2}[B-DF-HJ-NP-TV-Z]{3}[A-Z0-9]\d$/.test(cv)){setErr('curp','Formato inválido (18 caracteres RENAPO).');ok=false;}else clrErr('curp');var telPNum=(V('telP')||'').replace(/\D/g,'');if(telPNum.length<7){setErr('telP','Ingresa un número de al menos 7 dígitos.');if(Q('telPWr')){Q('telPWr').classList.add('bad');Q('telPWr').classList.remove('ok');}ok=false;}else{var e=Q('etelP');if(e)e.textContent='';if(Q('telPWr')){Q('telPWr').classList.add('ok');Q('telPWr').classList.remove('bad');}}if(isEmpty(V('emailP'))||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(V('emailP').trim())){setErr('emailP','Correo inválido.');ok=false;}else clrErr('emailP');req('tieneDep','Indica si tienes dependientes económicos.');if(V('tieneDep')==='Si'){req('numDep','Indica el número de dependientes.');var n=parseInt(V('numDep'));if(n>0){var allOk=true;for(var i=1;i<=n;i++){var sEl=Q('depAge'+i),mEl=Q('depAge'+i+'M');if(!sEl)continue;if(sEl.value==='manual'){if(isEmpty(mEl?mEl.value:'')){var e1=Q('edepAge'+i);if(e1)e1.textContent='Ingresa la edad.';sEl.classList.add('bad');allOk=false;}else{var e2=Q('edepAge'+i);if(e2)e2.textContent='';sEl.classList.remove('bad');}}else if(isEmpty(sEl.value)){var e3=Q('edepAge'+i);if(e3)e3.textContent='Selecciona un rango.';sEl.classList.add('bad');allOk=false;}else{var e4=Q('edepAge'+i);if(e4)e4.textContent='';sEl.classList.remove('bad');sEl.classList.add('ok');}}if(!allOk){Q('edepAges').textContent='Completa la edad de todos los dependientes.';ok=false;}else Q('edepAges').textContent='';}}return ok;}
function vSec2(){var ok=true;function req(id,msg){if(isEmpty(V(id))){setErr(id,msg||'Campo requerido.');ok=false;}else clrErr(id);}req('calle','Ingresa la calle o avenida.');req('numExt','Ingresa el número exterior.');if(!/^\d{5}$/.test(V('cp').trim())){setErr('cp','Ingresa un C.P. de 5 dígitos.');ok=false;}else clrErr('cp');if(Q('colBlk').style.display!=='none'){if(isEmpty(V('colonia'))){setErr('colonia','Selecciona una colonia.');ok=false;}else clrErr('colonia');}if(isEmpty(V('municipio'))){setErr('municipio','Ingresa la delegación o municipio.');ok=false;}else clrErr('municipio');if(isEmpty(V('estado'))){setErr('estado','Ingresa el estado.');ok=false;}else clrErr('estado');return ok;}
function vSec3(){var ok=true;function chk(id,fn,msg){if(!fn(V(id))){setErr(id,msg);ok=false;}else clrErr(id);}[['f1n','f1t','f1e','f1d'],['f2n','f2t','f2e','f2d'],['a1n','a1t','a1e','a1d'],['a2n','a2t','a2e','a2d']].forEach(function(g){chk(g[0],isName,'Nombre inválido.');var tNum=(V(g[1])||'').replace(/\D/g,'');var tWr=Q(g[1]+'Wr');if(tNum.length<7){var te=Q('e'+g[1]);if(te)te.textContent='Teléfono inválido (mín. 7 dígitos).';if(tWr){tWr.classList.add('bad');tWr.classList.remove('ok');}ok=false;}else{var te2=Q('e'+g[1]);if(te2)te2.textContent='';if(tWr){tWr.classList.add('ok');tWr.classList.remove('bad');}}chk(g[2],isEmail,'Correo inválido.');if(isEmpty(V(g[3]))){setErr(g[3],'Campo requerido.');ok=false;}else clrErr(g[3]);});return ok;}
function vSec4(){var ok=true;function req(id,msg){if(isEmpty(V(id))){setErr(id,msg||'Campo requerido.');ok=false;}else clrErr(id);}req('marca','Selecciona la marca.');if(V('marca')==='Otra'){if(isEmpty(V('otraMarca'))){setErr('otraMarca','Escribe la marca del vehículo.');ok=false;}else clrErr('otraMarca');}req('version','Ingresa la versión.');req('anio','Selecciona el año.');var c=parseFloat(V('costo').replace(/[^0-9.]/g,''));if(!c||c<=0){setErr('costo','Ingresa el costo del vehículo.');ok=false;}else clrErr('costo');var tp=document.querySelector('input[name=tipoPago]:checked');if(!tp){setErr('tipoPago','Selecciona el tipo de pago inicial.');ok=false;}else{clrErr('tipoPago');if(tp.value==='enganche'){var ePct=document.querySelector('input[name=engTipo]:checked');if(ePct&&ePct.value==='porcentaje'){var pr=V('valEng').replace(/[^0-9.]/g,'');if(isEmpty(pr)||parseFloat(pr)<=0){setErr('valEng','Ingresa el porcentaje de enganche.');ok=false;}else clrErr('valEng');}else{var mE=parseFloat(V('valEngMonto').replace(/[^0-9.]/g,''));if(!mE||mE<=0){setErr('valEng','Ingresa el monto del enganche.');ok=false;}else clrErr('valEng');}}else{var m=parseFloat(V('valMon').replace(/[^0-9.]/g,''));if(!m||m<=0){setErr('valMon','Ingresa el monto inicial.');ok=false;}else clrErr('valMon');}}return ok;}
function vSec5(){var ok=true;if(attachState['AVA'].files.length===0){var eu=Q('eupErr');eu.textContent='Debes adjuntar al menos un documento (INE requerido).';eu.style.display='block';Q('attachDropzoneAVA').style.borderColor='var(--e)';ok=false;}else{var eu2=Q('eupErr');eu2.textContent='';eu2.style.display='none';Q('attachDropzoneAVA').style.borderColor='';}var state=attachState['AVA'];if(state.zipBlob&&state.zipBlob.size>=MAX_ZIP_BYTES){var eu3=Q('eupErr');eu3.textContent='El ZIP excede 5 MB. Elimina algunos archivos antes de enviar.';eu3.style.display='block';ok=false;}if(!declChecked){var e=Q('edecl');if(e)e.textContent='Debes aceptar la declaración para poder enviar la solicitud.';Q('declBox').classList.add('bad');Q('declBox').classList.remove('ok');ok=false;}else{var e2=Q('edecl');if(e2)e2.textContent='';Q('declBox').classList.remove('bad');}return ok;}

// RESUMEN — NUEVO buildSummary() con grupos temáticos
function buildSummary(){
  var sumBox=Q('sumBox');var sumCont=Q('sumCont');
  if(!sumBox||!sumCont)return;

  function makeRow(label,value,chipClass){
    var empty=!value||!String(value).trim()||value==='N/A';
    var valHtml;
    if(empty){valHtml='<span class="sum-v sum-v--empty">—</span>';}
    else if(chipClass){valHtml='<span class="sum-chip '+chipClass+'">'+value+'</span>';}
    else{valHtml='<span class="sum-v">'+value+'</span>';}
    return'<div class="sum-row"><span class="sum-k">'+label+':</span>'+valHtml+'</div>';
  }

  function makeGroup(emoji,titulo,filas){
    return'<div class="sum-group">'
      +'<div class="sum-group-label">'
      +'<span class="sum-group-label-icon">'+emoji+'</span>'
      +'<span class="sum-group-label-text">'+titulo+'</span>'
      +'</div>'
      +filas
      +'</div>';
  }

  var nombre=[V('pNombre'),V('sNombre'),V('pApellido'),V('sApellido')].filter(Boolean).join(' ').replace(/\s+/,' ').trim();
  var tp=document.querySelector('input[name="tipoPago"]:checked');
  var pago='—';
  if(tp){if(tp.value==='enganche'){var et=document.querySelector('input[name="engTipo"]:checked');pago=(et&&et.value==='porcentaje')?'Enganche: '+V('valEng'):'Enganche: MX$ '+V('valEngMonto');}else{pago='Monto Inicial: MX$ '+V('valMon');}}

  var depStr='No';
  if(V('tieneDep')==='Si'){var nd=parseInt(V('numDep'))||0;if(nd>0){var ages=[];for(var i=1;i<=nd;i++){var sv=V('depAge'+i);var mv=V('depAge'+i+'M');ages.push('Dep.'+i+': '+(sv==='manual'?(mv+' años'):sv));}depStr='Sí ('+nd+') — '+ages.join(', ');}else{depStr='Sí';}}

  var marcaFinal=V('marca')==='Otra'?'Otra ('+V('otraMarca')+')':V('marca');
  var state=attachState['AVA'];
  var archivos=state.files.length;
  var zipInfo=state.zipBlob?fmtBytes(state.zipBlob.size):'Pendiente';
  var archivosStr=archivos+' archivo(s) — ZIP: '+zipInfo;

  var g1=makeGroup('👤','Datos Personales',
    makeRow('Nombre completo',nombre)+
    makeRow('Género',V('genero'))+
    makeRow('Fecha de nac.',V('fNac'))+
    makeRow('Edad',V('edad'))+
    makeRow('Estado civil',V('estCivil'))+
    makeRow('Régimen',V('estCivil')==='Casado(a)'?V('regimen'):'N/A')+
    makeRow('RFC',V('rfc'))+
    makeRow('CURP',V('curp'))+
    makeRow('Teléfono',V('telPFull')||V('telP'))+
    makeRow('Correo',V('emailP'))+
    makeRow('Dependientes',depStr)
  );

  var g2=makeGroup('📍','Domicilio',
    makeRow('Calle / Av.',V('calle'))+
    makeRow('Número',V('numExt')+(V('numInt')?' — Int. '+V('numInt'):''))+
    makeRow('C.P.',V('cp'))+
    makeRow('Colonia',V('colSel')||V('colonia'))+
    makeRow('Municipio',V('municipio'))+
    makeRow('Estado',V('estado'))
  );

  var g3=makeGroup('🚗','Vehículo y Financiamiento',
    makeRow('Marca',marcaFinal,'sum-chip')+
    makeRow('Versión',V('version'))+
    makeRow('Año',V('anio'))+
    makeRow('Costo total','MX$ '+V('costo'),'sum-chip--amount')+
    makeRow('Pago inicial',pago,'sum-chip--amount')
  );

  var g4=makeGroup('📎','Documentos Adjuntos',
    makeRow('Archivos ZIP',archivosStr,'sum-chip--files')
  );

  sumCont.innerHTML=g1+g2+g3+g4;
  sumBox.style.display='';
}

// SUBMIT
Q('frm').addEventListener('submit',function(e){
  e.preventDefault();
  var allValid=true;
  for(var s=1;s<=TOTAL;s++){if(!validateSection(s))allValid=false;}
  if(!allValid){focusFirstInvalid();return;}
  Q('sOv').classList.add('on');Q('btnSub').disabled=true;
  if(typeof grecaptcha!=='undefined'){grecaptcha.ready(function(){grecaptcha.execute(RECAPTCHA_SITE_KEY,{action:'submit_credito_ava'}).then(function(token){Q('rcToken').value=token;doSubmit();}).catch(function(){doSubmit();});});}else{doSubmit();}
});

function doSubmit(){
  var fd=new FormData(Q('frm'));
  var state=attachState['AVA'];
  if(state.zipBlob){fd.append('documentos_zip','archivos-credito-'+getToday()+'.zip');}
  else{state.files.forEach(function(f,i){fd.append('adjunto_'+(i+1),f,f.name);});}
  var nm=[V('pNombre'),V('sNombre'),V('pApellido'),V('sApellido')].filter(Boolean).join(' ').replace(/\s+/,' ').trim();
  fd.set('_subject','Solicitud Crédito Vehicular AVA — '+nm);
  fetch(Q('frm').action,{method:'POST',body:fd,redirect:'follow'}).then(function(r){Q('sOv').classList.remove('on');Q('btnSub').disabled=false;showSuccessModal();}).catch(function(){Q('sOv').classList.remove('on');Q('btnSub').disabled=false;showSuccessModal();});
}

document.addEventListener('keydown',function(e){if(e.key==='Escape'){Q('successOverlay').classList.remove('show');['motivModal25','motivModal50','motivModal75','motivModal100'].forEach(function(id){var el=Q(id);if(el)el.classList.remove('show');});var anyOpen=['motivModal25','motivModal50','motivModal75','motivModal100','successOverlay'].some(function(id){var el=Q(id);return el&&el.classList.contains('show');});if(!anyOpen)document.body.style.overflow='';}});

// Exponer globales
window._avaCloseMotiv=closeMotivModal;
window._avaCloseSuccess=closeSuccessModal;
window._avaDragOver=onDragOver;
window._avaDragLeave=onDragLeave;
window._avaDrop=onDrop;
window._avaHandleFiles=handleFiles;
window._avaRemoveFile=removeFile;

document.querySelectorAll('#frm input[type=text], #frm input[type=tel], #frm textarea').forEach(function(el){if(el.hasAttribute('data-no-upper')||el.readOnly||el.disabled)return;el.addEventListener('input',function(){var pos=this.selectionStart;var upper=this.value.toUpperCase();if(this.value!==upper){this.value=upper;try{this.setSelectionRange(pos,pos);}catch(e){}}});});

attachProgressListeners();
Q('formProgressWrap').classList.add('visible');
syncSubmitBtn();
slideTo(1);

})();

window.closeMotivModal=function(id){if(window._avaCloseMotiv)window._avaCloseMotiv(id);};
window.closeSuccessModal=function(){if(window._avaCloseSuccess)window._avaCloseSuccess();};
window.onDragOver=function(e,t){if(window._avaDragOver)window._avaDragOver(e,t);};
window.onDragLeave=function(e,t){if(window._avaDragLeave)window._avaDragLeave(e,t);};
window.onDrop=function(e,t){if(window._avaDrop)window._avaDrop(e,t);};
window.handleFiles=function(fl,t){if(window._avaHandleFiles)window._avaHandleFiles(fl,t);};
window.removeFile=function(t,i){if(window._avaRemoveFile)window._avaRemoveFile(t,i);};
</script>

<script src="https://elfsightcdn.com/platform.js" async></script>
<div class="elfsight-app-beb4a331-0ecc-4c09-b401-4d88d35cbf03" data-elfsight-app-lazy></div>

</body>
</html>
