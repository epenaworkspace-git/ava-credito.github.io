<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solicitud de CrÃ©dito Vehicular â€“ AVA</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     reCAPTCHA v3
     Site Key:   6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV
     Secret Key: 6Lc9zGUsAAAAAHifaydBuJYHlSEX77P_6zCtACum
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="https://www.google.com/recaptcha/api.js?render=6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV" async defer></script>
<style>
:root{--p:#0A1F44;--a:#165DFF;--e:#E53935;--bd:#E0E0E0;--bg:#F8FAFC;--mid:#666;--lt:#999}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:#333;min-height:100vh}
.wrap{max-width:860px;margin:0 auto;padding:2rem 1.25rem 4rem}

/* HEADER */
.hdr{background:var(--p);border-radius:9px;padding:2rem;text-align:center;margin-bottom:1.75rem;box-shadow:0 8px 28px rgba(10,31,68,.18)}
.hdr-logo{font-family:'DM Serif Display',serif;font-size:1.9rem;color:#fff;letter-spacing:.04em}
.hdr-logo span{color:#5B8EFF}
.hdr-sub{font-size:.95rem;color:rgba(255,255,255,.7);margin-top:.3rem;letter-spacing:.06em;text-transform:uppercase}

/* PROGRESS */
.prog{background:#fff;border-radius:9px;padding:1.1rem 1.5rem;margin-bottom:1.75rem;box-shadow:0 1px 4px rgba(0,0,0,.07);display:flex;align-items:center}
.step{flex:1;display:flex;flex-direction:column;align-items:center;gap:.3rem;position:relative;cursor:pointer}
.step:not(:last-child)::after{content:'';position:absolute;top:15px;left:calc(50% + 17px);width:calc(100% - 34px);height:2px;background:var(--bd);z-index:0;transition:background .3s}
.step.done:not(:last-child)::after{background:var(--a)}
.sc{width:32px;height:32px;border-radius:50%;border:2px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:.76rem;font-weight:600;background:#fff;color:var(--lt);position:relative;z-index:1;transition:all .25s}
.step.active .sc{border-color:var(--a);background:var(--a);color:#fff;box-shadow:0 0 0 4px rgba(22,93,255,.15)}
.step.done .sc{border-color:var(--a);background:var(--a);color:#fff}
.sl{font-size:.64rem;font-weight:500;color:var(--lt);text-align:center;line-height:1.2;transition:color .2s}
.step.active .sl,.step.done .sl{color:var(--a)}

/* CARD */
.card{background:#fff;border-radius:9px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}

/* SECCIONES */
.sec{padding:2rem;display:none}
.sec.active{display:block}

/* SECTION HEADER */
.sec-hdr{display:flex;align-items:center;gap:.7rem;padding-bottom:1.2rem;border-bottom:1px solid #EEF2F7;margin-bottom:1.75rem;border-top:3px solid var(--a);padding-top:.85rem}
.sec-ico{width:36px;height:36px;border-radius:8px;background:rgba(10,31,68,.06);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sec-ico svg{width:20px;height:20px;fill:var(--p)}
.sec-title{font-size:1.25rem;font-weight:700;color:var(--p)}

/* GRID / FIELD */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:1.2rem}
@media(max-width:600px){.grid{grid-template-columns:1fr}}
.full{grid-column:1/-1}
.fg{display:flex;flex-direction:column;gap:.32rem}
.lbl{font-size:.8rem;font-weight:600;color:#333;letter-spacing:.02em}
.lbl.req::after{content:' *';color:var(--a)}
.note{font-size:.71rem;font-weight:400;color:var(--mid)}

input,select,textarea{width:100%;padding:.56rem .8rem;border:1.5px solid var(--bd);border-radius:7px;background:#fff;font-family:'DM Sans',sans-serif;font-size:.88rem;color:#333;outline:none;appearance:none;-webkit-appearance:none;transition:border-color .18s,box-shadow .18s}
input:focus,select:focus,textarea:focus{border-color:var(--a);box-shadow:0 0 0 3px rgba(22,93,255,.1)}
input.ok,select.ok{border-color:var(--a)}
input.bad,select.bad,textarea.bad{border-color:var(--e);box-shadow:0 0 0 3px rgba(229,57,53,.08)}
input:disabled,select:disabled{background:var(--bg);color:var(--lt);cursor:not-allowed;opacity:.7}
select{cursor:pointer;padding-right:2.2rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath fill='%23999' d='M6 8L0 0h12z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center}
textarea{resize:vertical;min-height:76px}
.em{font-size:.72rem;color:var(--e);font-weight:500;margin-top:.1rem}

/* CURP â€” solo validaciÃ³n de formato, sin widget de estado */

/* CONDITIONAL BLOCKS */
.cond-block{overflow:hidden;transition:max-height .38s cubic-bezier(.4,0,.2,1),opacity .3s ease;max-height:0;opacity:0}
.cond-block.open{max-height:700px;opacity:1}

/* DEPENDIENTES */
.dep-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:.75rem;margin-top:.5rem}
.dep-item{display:flex;flex-direction:column;gap:.28rem}
.dep-lbl{font-size:.75rem;font-weight:600;color:var(--p)}
.info-tag{display:inline-flex;align-items:center;gap:.3rem;font-size:.71rem;font-weight:600;background:rgba(22,93,255,.07);color:var(--a);border-radius:5px;padding:.2rem .55rem;margin-top:.3rem}

/* CP */
.cp-wr{position:relative}
.cp-spin{position:absolute;right:.8rem;top:50%;transform:translateY(-50%);width:15px;height:15px;border:2px solid rgba(22,93,255,.2);border-top-color:var(--a);border-radius:50%;animation:spin .65s linear infinite}
@keyframes spin{to{transform:translateY(-50%) rotate(360deg)}}
.cp-tag{font-size:.7rem;font-weight:600;background:rgba(10,31,68,.05);color:var(--p);border-radius:4px;padding:.16rem .48rem}
.cp-tag strong{color:var(--a)}

/* REF */
.ref{border:1.5px solid var(--bd);border-radius:9px;padding:1.1rem;margin-bottom:.85rem;transition:border-color .18s}
.ref:focus-within{border-color:var(--a)}
.ref-t{font-size:.85rem;font-weight:600;color:#333;margin-bottom:.85rem;display:flex;align-items:center;gap:.4rem}
.ref-t::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--a)}
.sub-t{font-size:1.05rem;font-weight:700;color:var(--p);margin-bottom:.2rem}
.sub-n{font-size:.78rem;color:var(--mid);margin-bottom:.9rem}

/* PAYMENT */
.pay-box{border:1.5px solid var(--bd);border-radius:9px;padding:1.1rem;background:var(--bg);transition:border-color .18s}
.pay-box:focus-within{border-color:var(--a)}
.pay-ttl{font-size:.82rem;font-weight:600;color:var(--p);margin-bottom:.85rem}
.pay-row{display:flex;gap:1rem;flex-wrap:wrap}
.radios{display:flex;flex-direction:column;gap:.55rem;min-width:148px}
.rlbl{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-size:.84rem;font-weight:500;padding:.45rem .7rem;border-radius:6px;border:1.5px solid var(--bd);background:#fff;transition:all .18s;user-select:none}
.rlbl:hover{border-color:var(--a)}
.rlbl input[type=radio]{display:none}
.rc{width:14px;height:14px;border-radius:50%;border:2px solid var(--bd);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .18s}
.rc::after{content:'';width:5px;height:5px;border-radius:50%;background:#fff;opacity:0;transition:opacity .18s}
.rlbl input:checked~.rc{border-color:var(--a);background:var(--a)}
.rlbl input:checked~.rc::after{opacity:1}
.rlbl:has(input:checked){border-color:var(--a);background:rgba(22,93,255,.05);color:var(--a)}
.pay-in{flex:1;min-width:185px}
.cur-wr{position:relative}
.cur-pre{position:absolute;left:.8rem;top:50%;transform:translateY(-50%);font-size:.84rem;font-weight:600;color:var(--mid);pointer-events:none}
.cur-wr input{padding-left:2.85rem}

/* UPLOAD */
.up-area{border:2px dashed var(--bd);border-radius:9px;padding:1.65rem;text-align:center;cursor:pointer;background:var(--bg);position:relative;transition:all .18s}
.up-area:hover,.up-area.drag{border-color:var(--a);background:rgba(22,93,255,.03)}
.up-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%}
.up-main{font-size:.9rem;font-weight:600;color:var(--p);margin-bottom:.28rem}
.up-sub{font-size:.74rem;color:var(--mid)}
.up-sub strong{color:var(--a)}
.f-list{margin-top:.8rem;display:flex;flex-direction:column;gap:.42rem}
.f-item{display:flex;align-items:center;gap:.6rem;padding:.52rem .78rem;background:#fff;border:1.5px solid var(--bd);border-radius:7px;font-size:.79rem}
.f-nm{flex:1;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.f-sz{color:var(--mid);white-space:nowrap}
.f-ok{font-size:.68rem;color:var(--a);font-weight:600}
.f-rm{background:none;border:none;color:var(--e);cursor:pointer;font-size:.95rem;padding:.1rem .28rem;border-radius:4px}

/* SUMMARY */
.sumbox{background:var(--bg);border:1.5px solid var(--bd);border-radius:9px;padding:1.1rem;margin-bottom:1.4rem}
.sum-ttl{font-size:.84rem;font-weight:600;color:var(--p);margin-bottom:.65rem}
.sum-row{display:flex;gap:.45rem;font-size:.79rem;line-height:1.85}
.sum-k{color:var(--p);font-weight:600;min-width:160px;flex-shrink:0}
.sum-sep{border:none;border-top:1px solid #EEF2F7;margin:.4rem 0}

/* DECLARACIÃ“N CHECKBOX */
.decl-box{border:2px solid var(--bd);border-radius:9px;padding:1.25rem 1.4rem;margin-top:1.5rem;background:#fff;transition:border-color .2s,background .2s}
.decl-box.ok{border-color:var(--a);background:rgba(22,93,255,.03)}
.decl-box.bad{border-color:var(--e);background:rgba(229,57,53,.03)}
.decl-head{font-size:.78rem;font-weight:700;color:var(--p);letter-spacing:.04em;text-transform:uppercase;margin-bottom:.75rem;display:flex;align-items:center;gap:.45rem}
.decl-head::before{content:'';display:inline-block;width:3px;height:14px;background:var(--a);border-radius:2px;flex-shrink:0}
.decl-row{display:flex;align-items:flex-start;gap:.9rem;cursor:pointer;user-select:none}
.chk-vis{width:20px;height:20px;min-width:20px;border:2px solid var(--bd);border-radius:5px;display:flex;align-items:center;justify-content:center;transition:all .18s;background:#fff;margin-top:.12rem}
.chk-vis.on{background:var(--a);border-color:var(--a)}
.chk-vis svg{width:11px;height:11px;fill:none;stroke:#fff;stroke-width:2.2;stroke-linecap:round;stroke-linejoin:round;opacity:0;transition:opacity .15s}
.chk-vis.on svg{opacity:1}
.decl-text{font-size:.82rem;color:#444;line-height:1.72;font-style:italic}
.decl-req{font-size:.7rem;font-weight:600;color:var(--a);background:rgba(22,93,255,.07);border-radius:4px;padding:.12rem .42rem;margin-left:.35rem;vertical-align:middle}

/* NAV */
.nav{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:1.35rem 2rem;background:#FAFBFD;border-top:1px solid #EEF2F7}
.btn{display:inline-flex;align-items:center;gap:.42rem;padding:.6rem 1.6rem;border-radius:7px;font-family:'DM Sans',sans-serif;font-size:.87rem;font-weight:600;cursor:pointer;border:2px solid transparent;transition:all .18s;user-select:none}
.btn-p{background:var(--p);color:#fff;border-color:var(--p)}
.btn-p:hover:not(:disabled){background:var(--a);border-color:var(--a);box-shadow:0 4px 14px rgba(22,93,255,.28)}
.btn-p:disabled{background:var(--bd);color:var(--lt);border-color:var(--bd);cursor:not-allowed}
.btn-s{background:var(--p);color:#fff;border-color:var(--p);font-size:.9rem;padding:.68rem 1.9rem;letter-spacing:.04em;text-transform:uppercase}
.btn-s:hover:not(:disabled){background:var(--a);border-color:var(--a);box-shadow:0 4px 16px rgba(22,93,255,.3)}
.btn-s:disabled{background:var(--bd);color:var(--lt);border-color:var(--bd);cursor:not-allowed}
.btn svg{width:14px;height:14px;fill:currentColor}
.step-ind{font-size:.79rem;color:var(--mid);font-weight:500}

/* MODAL */
.modal{position:fixed;inset:0;background:rgba(10,31,68,.5);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:9999;padding:1.5rem;opacity:0;visibility:hidden;transition:.3s}
.modal.on{opacity:1;visibility:visible}
.mbox{background:#fff;border-radius:14px;padding:2.2rem 1.7rem;max-width:400px;width:100%;text-align:center;transform:scale(.9);transition:.3s cubic-bezier(.34,1.56,.64,1)}
.modal.on .mbox{transform:scale(1)}
.m-ico{width:60px;height:60px;border-radius:50%;background:rgba(22,93,255,.1);margin:0 auto .9rem;display:flex;align-items:center;justify-content:center}
.m-ico svg{width:30px;height:30px;fill:var(--a)}
.m-t{font-family:'DM Serif Display',serif;font-size:1.35rem;color:var(--p);margin-bottom:.45rem}
.m-m{font-size:.88rem;color:var(--mid);line-height:1.65;margin-bottom:1.25rem}
.m-m strong{color:var(--a)}
.m-btn{background:var(--p);color:#fff;border:none;padding:.6rem 1.65rem;border-radius:7px;font-family:'DM Sans',sans-serif;font-size:.87rem;font-weight:600;cursor:pointer;transition:background .18s}
.m-btn:hover{background:var(--a)}

/* SENDING OVERLAY */
.s-ov{position:fixed;inset:0;background:rgba(10,31,68,.62);backdrop-filter:blur(5px);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.1rem;z-index:9998;opacity:0;visibility:hidden;transition:.25s}
.s-ov.on{opacity:1;visibility:visible}
.s-ring{width:46px;height:46px;border:4px solid rgba(255,255,255,.22);border-top-color:#fff;border-radius:50%;animation:ringspin .7s linear infinite}
@keyframes ringspin{to{transform:rotate(360deg)}}
.s-msg{font-size:.95rem;font-weight:600;color:#fff;letter-spacing:.03em}

@media(max-width:600px){
  .nav{padding:1rem 1.25rem;flex-wrap:wrap}
  .sec{padding:1.25rem}
  .dep-grid{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>
<div class="wrap">

<header class="hdr">
  <div class="hdr-logo">A<span>VA</span></div>
  <div class="hdr-sub">Solicitud de CrÃ©dito Vehicular</div>
</header>

<nav class="prog" id="prog">
  <div class="step active" data-s="1"><div class="sc">1</div><span class="sl">Datos<br>Personales</span></div>
  <div class="step" data-s="2"><div class="sc">2</div><span class="sl">Referencias</span></div>
  <div class="step" data-s="3"><div class="sc">3</div><span class="sl">VehÃ­culo<br>y Financ.</span></div>
  <div class="step" data-s="4"><div class="sc">4</div><span class="sl">Docs y<br>EnvÃ­o</span></div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SUBMITFORM
     Destino: info@anpai.com.mx
     DocumentaciÃ³n: https://submitform.io
     El action envÃ­a todos los campos + archivos adjuntos (multipart/form-data)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<form id="frm" novalidate
      action="https://formsubmit.co/info@anpai.com.mx"
      method="POST"
      enctype="multipart/form-data">

  <!-- Campos de control FormSubmit.co -->
  <input type="hidden" name="_subject"  value="Solicitud de CrÃ©dito Vehicular â€” AVA">
  <!-- Evitar redirecciÃ³n a pÃ¡gina de agradecimiento de FormSubmit -->
  <input type="hidden" name="_next"     value="">
  <!-- Honeypot antispam â€” debe permanecer vacÃ­o -->
  <input type="text"   name="_honey"    style="display:none" tabindex="-1" autocomplete="off">
  <!-- Desactivar el CAPTCHA propio de FormSubmit (usamos reCAPTCHA v3) -->
  <input type="hidden" name="_captcha"  value="false">
  <!-- Token reCAPTCHA v3 â€” se inyecta por JS antes del submit -->
  <input type="hidden" id="rcToken"     name="g-recaptcha-response" value="">

<div class="card">

<!-- â•â•â• S1 â€” DATOS PERSONALES â•â•â• -->
<div class="sec" id="s1">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v1h20v-1c0-3.3-6.7-5-10-5z"/></svg></div>
    <h1 class="sec-title">DATOS PERSONALES</h1>
  </div>
  <div class="grid">
    <div class="fg">
      <label class="lbl req" for="pNombre">Primer Nombre</label>
      <input id="pNombre" name="pNombre" type="text" placeholder="Tu primer nombre">
      <span class="em" id="epNombre"></span>
    </div>
    <div class="fg">
      <label class="lbl" for="sNombre">Segundo Nombre <span class="note">(opcional)</span></label>
      <input id="sNombre" name="sNombre" type="text" placeholder="Tu segundo nombre">
    </div>
    <div class="fg">
      <label class="lbl req" for="pApellido">Primer Apellido</label>
      <input id="pApellido" name="pApellido" type="text" placeholder="Tu primer apellido">
      <span class="em" id="epApellido"></span>
    </div>
    <div class="fg">
      <label class="lbl req" for="sApellido">Segundo Apellido</label>
      <input id="sApellido" name="sApellido" type="text" placeholder="Tu segundo apellido">
      <span class="em" id="esApellido"></span>
    </div>
    <div class="fg">
      <label class="lbl req" for="genero">GÃ©nero</label>
      <select id="genero" name="genero">
        <option value="" disabled selected>Selecciona</option>
        <option>Masculino</option><option>Femenino</option>
      </select>
      <span class="em" id="egenero"></span>
    </div>
    <div class="fg">
      <label class="lbl req" for="fNac">Fecha de Nacimiento</label>
      <input id="fNac" name="fNac" type="date">
      <span class="em" id="efNac"></span>
    </div>
    <div class="fg">
      <label class="lbl" for="edad">Edad <span class="note">(auto)</span></label>
      <input id="edad" name="edad" type="text" readonly disabled placeholder="â€”">
    </div>
    <div class="fg">
      <label class="lbl req" for="estCivil">Estado Civil</label>
      <select id="estCivil" name="estCivil">
        <option value="" disabled selected>Selecciona tu estado civil</option>
        <option value="Soltero(a)">Soltero(a)</option>
        <option value="Casado(a)">Casado(a)</option>
      </select>
      <span class="em" id="eestCivil"></span>
    </div>
    <div class="fg cond-block" id="regimenBlk">
      <label class="lbl req" for="regimen">RÃ©gimen Matrimonial</label>
      <select id="regimen" name="regimen" disabled>
        <option value="" disabled selected>Selecciona el rÃ©gimen matrimonial</option>
        <option value="Bienes Mancomunados">Bienes Mancomunados</option>
        <option value="Bienes Separados">Bienes Separados</option>
      </select>
      <span class="em" id="eregimen"></span>
    </div>
    <div class="fg">
      <label class="lbl req" for="rfc">RFC <span class="note">ej: ABC123456XYZ</span></label>
      <input id="rfc" name="rfc" type="text" placeholder="ABC123456XYZ0" maxlength="13" style="text-transform:uppercase">
      <span class="em" id="erfc"></span>
    </div>

    <!-- CURP â€” validaciÃ³n de formato Ãºnicamente -->
    <div class="fg">
      <label class="lbl req" for="curp">CURP</label>
      <input id="curp" name="curp" type="text" placeholder="ABCD123456HDFLRN01" maxlength="18" style="text-transform:uppercase" autocomplete="off">
      <span class="em" id="ecurp"></span>
    </div>

    <div class="fg">
      <label class="lbl req" for="tieneDep">Â¿Tiene Dependientes EconÃ³micos?</label>
      <select id="tieneDep" name="tieneDep">
        <option value="" disabled selected>Â¿Tienes dependientes econÃ³micos?</option>
        <option value="No">No</option>
        <option value="Si">SÃ­</option>
      </select>
      <span class="em" id="etieneDep"></span>
    </div>
    <div class="full cond-block" id="depBlk">
      <div class="grid" style="margin-bottom:.85rem">
        <div class="fg">
          <label class="lbl req" for="numDep">NÃºmero de Dependientes</label>
          <select id="numDep" name="numDep" disabled>
            <option value="" disabled selected>NÃºmero de dependientes</option>
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
          </select>
          <span class="em" id="enumDep"></span>
        </div>
        <div class="fg" style="justify-content:flex-end">
          <span class="info-tag">ğŸ’¡ Se generarÃ¡n campos de edad por dependiente</span>
        </div>
      </div>
      <div class="dep-grid" id="depAges"></div>
      <span class="em" id="edepAges"></span>
    </div>

    <!-- CÃ“DIGO POSTAL -->
    <div class="fg">
      <label class="lbl req" for="cp">CÃ³digo Postal</label>
      <div class="cp-wr" id="cpWr">
        <input id="cp" name="codigoPostal" type="text" placeholder="12345" maxlength="5" inputmode="numeric" autocomplete="off">
        <div class="cp-spin" id="cpSpin" style="display:none"></div>
      </div>
      <small style="color:var(--mid);font-size:.69rem;margin-top:.12rem">Escribe el C.P. y presiona Tab o Enter</small>
      <span class="em" id="ecp"></span>
      <div id="cpErrBox" style="display:none;font-size:.75rem;color:var(--e);font-weight:500;padding:.42rem .68rem;background:rgba(229,57,53,.05);border:1px solid rgba(229,57,53,.18);border-radius:6px;margin-top:.32rem"></div>
      <button type="button" id="cpRetry" style="display:none;margin-top:.38rem;padding:.32rem .85rem;border-radius:6px;background:var(--p);color:#fff;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:600">â†º Reintentar</button>
      <div id="cpBadges" style="display:none;flex-wrap:wrap;gap:.4rem;margin-top:.45rem">
        <span class="cp-tag">Municipio: <strong id="cpMun"></strong></span>
        <span class="cp-tag">Estado: <strong id="cpEst"></strong></span>
        <span id="cpCiuWrap" class="cp-tag" style="display:none">Ciudad: <strong id="cpCiu"></strong></span>
      </div>
    </div>
    <div class="fg" id="colBlk" style="display:none">
      <label class="lbl req" for="colonia">
        Colonia <span id="colCnt" style="font-size:.68rem;font-weight:500;color:var(--a);background:rgba(22,93,255,.08);border-radius:8px;padding:.07rem .48rem;margin-left:.3rem"></span>
      </label>
      <select id="colonia" name="colonia">
        <option value="" disabled selected>Selecciona tu colonia</option>
      </select>
      <span class="em" id="ecolonia"></span>
      <div id="colRegLbl" style="display:none;font-size:.68rem;font-weight:700;color:var(--mid);letter-spacing:.05em;margin-top:.48rem;margin-bottom:.2rem">âœ“ COLONIA REGISTRADA</div>
      <input id="colSel" name="coloniaSeleccionada" type="text" readonly style="display:none;border:2px solid var(--a);background:rgba(22,93,255,.04);font-weight:600;color:var(--a);cursor:default" placeholder="Colonia registrada">
      <input type="hidden" id="hMun" name="municipio">
      <input type="hidden" id="hEst" name="estado">
      <input type="hidden" id="hCiu" name="ciudad">
    </div>
  </div>
</div><!-- /s1 -->

<!-- â•â•â• S2 â€” REFERENCIAS â•â•â• -->
<div class="sec" id="s2">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg></div>
    <h2 class="sec-title">REFERENCIAS</h2>
  </div>
  <div class="sub-t">REFERENCIAS FAMILIARES</div>
  <div class="sub-n">No conviven con el solicitante</div>
  <div class="ref"><div class="ref-t">Familiar 1</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="f1n">Nombre Completo</label><input id="f1n" name="f1n" type="text" placeholder="Nombre completo"><span class="em" id="ef1n"></span></div>
    <div class="fg"><label class="lbl req" for="f1t">TelÃ©fono</label><input id="f1t" name="f1t" type="tel" placeholder="2221234567" maxlength="15"><span class="em" id="ef1t"></span></div>
    <div class="fg"><label class="lbl req" for="f1e">Correo</label><input id="f1e" name="f1e" type="email" placeholder="nombre@correo.com"><span class="em" id="ef1e"></span></div>
    <div class="fg full"><label class="lbl req" for="f1d">DirecciÃ³n</label><textarea id="f1d" name="f1d" rows="2" placeholder="Calle, nÃºmero, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ef1d"></span></div>
  </div></div>
  <div class="ref"><div class="ref-t">Familiar 2</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="f2n">Nombre Completo</label><input id="f2n" name="f2n" type="text" placeholder="Nombre completo"><span class="em" id="ef2n"></span></div>
    <div class="fg"><label class="lbl req" for="f2t">TelÃ©fono</label><input id="f2t" name="f2t" type="tel" placeholder="2221234567" maxlength="15"><span class="em" id="ef2t"></span></div>
    <div class="fg"><label class="lbl req" for="f2e">Correo</label><input id="f2e" name="f2e" type="email" placeholder="nombre@correo.com"><span class="em" id="ef2e"></span></div>
    <div class="fg full"><label class="lbl req" for="f2d">DirecciÃ³n</label><textarea id="f2d" name="f2d" rows="2" placeholder="Calle, nÃºmero, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ef2d"></span></div>
  </div></div>
  <div class="sub-t" style="margin-top:.6rem">REFERENCIAS DE AMISTAD</div>
  <div class="sub-n">&nbsp;</div>
  <div class="ref"><div class="ref-t">Amistad 1</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="a1n">Nombre Completo</label><input id="a1n" name="a1n" type="text" placeholder="Nombre completo"><span class="em" id="ea1n"></span></div>
    <div class="fg"><label class="lbl req" for="a1t">TelÃ©fono</label><input id="a1t" name="a1t" type="tel" placeholder="2221234567" maxlength="15"><span class="em" id="ea1t"></span></div>
    <div class="fg"><label class="lbl req" for="a1e">Correo</label><input id="a1e" name="a1e" type="email" placeholder="nombre@correo.com"><span class="em" id="ea1e"></span></div>
    <div class="fg full"><label class="lbl req" for="a1d">DirecciÃ³n</label><textarea id="a1d" name="a1d" rows="2" placeholder="Calle, nÃºmero, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ea1d"></span></div>
  </div></div>
  <div class="ref"><div class="ref-t">Amistad 2</div><div class="grid">
    <div class="fg full"><label class="lbl req" for="a2n">Nombre Completo</label><input id="a2n" name="a2n" type="text" placeholder="Nombre completo"><span class="em" id="ea2n"></span></div>
    <div class="fg"><label class="lbl req" for="a2t">TelÃ©fono</label><input id="a2t" name="a2t" type="tel" placeholder="2221234567" maxlength="15"><span class="em" id="ea2t"></span></div>
    <div class="fg"><label class="lbl req" for="a2e">Correo</label><input id="a2e" name="a2e" type="email" placeholder="nombre@correo.com"><span class="em" id="ea2e"></span></div>
    <div class="fg full"><label class="lbl req" for="a2d">DirecciÃ³n</label><textarea id="a2d" name="a2d" rows="2" placeholder="Calle, nÃºmero, colonia, ciudad, estado, C.P."></textarea><span class="em" id="ea2d"></span></div>
  </div></div>
</div><!-- /s2 -->

<!-- â•â•â• S3 â€” VEHÃCULO â•â•â• -->
<div class="sec" id="s3">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/></svg></div>
    <h2 class="sec-title">VEHÃCULO Y FINANCIAMIENTO</h2>
  </div>
  <div class="grid">
    <div class="fg"><label class="lbl req" for="marca">Marca</label>
      <select id="marca" name="marca">
        <option value="" disabled selected>Selecciona marca</option>
        <option>Acura</option><option>Alfa Romeo</option><option>Audi</option>
        <option>BMW</option><option>BYD</option>
        <option>Chevrolet</option><option>Chrysler</option><option>CitroÃ«n</option>
        <option>Dodge</option>
        <option>Ferrari</option><option>Fiat</option><option>Ford</option>
        <option>GAC</option><option>Genesis</option>
        <option>Honda</option><option>Hyundai</option>
        <option>Infiniti</option><option>Isuzu</option>
        <option>JAC</option><option>Jaguar</option><option>Jeep</option>
        <option>Kia</option>
        <option>Lamborghini</option><option>Land Rover</option><option>Lexus</option><option>Lincoln</option>
        <option>Maserati</option><option>Mazda</option><option>Mercedes-Benz</option>
        <option>MINI</option><option>Mitsubishi</option>
        <option>Nissan</option>
        <option>Peugeot</option><option>Porsche</option>
        <option>RAM</option><option>Renault</option>
        <option>Seat</option><option>Subaru</option><option>Suzuki</option>
        <option>Toyota</option>
        <option>Volkswagen</option><option>Volvo</option>
        <option value="Otra">Otra</option>
      </select>
      <span class="em" id="emarca"></span>
    </div>
    <!-- Campo "Otra marca" â€” visible solo si selecciona Otra -->
    <div class="fg" id="otraMarcaBlk" style="display:none">
      <label class="lbl req" for="otraMarca">Especifica la Marca</label>
      <input id="otraMarca" name="otraMarca" type="text" placeholder="Escribe la marca del vehÃ­culo" disabled>
      <span class="em" id="eotraMarca"></span>
    </div>
    <div class="fg"><label class="lbl req" for="version">VersiÃ³n</label>
      <input id="version" name="version" type="text" placeholder="Ej: Jetta Highline 1.4T">
      <span class="em" id="eversion"></span>
    </div>
    <div class="fg"><label class="lbl req" for="anio">AÃ±o</label>
      <select id="anio" name="anio"><option value="" disabled selected>Selecciona aÃ±o</option></select>
      <span class="em" id="eanio"></span>
    </div>
    <div class="fg"><label class="lbl req" for="costo">Costo Total del VehÃ­culo</label>
      <div class="cur-wr"><span class="cur-pre">MX$</span>
        <input id="costo" name="costo" type="text" placeholder="0.00" inputmode="decimal">
      </div>
      <span class="em" id="ecosto"></span>
    </div>
    <div class="fg full"><label class="lbl req">Pago Inicial</label>
      <div class="pay-box">
        <div class="pay-ttl">Selecciona el tipo de pago inicial</div>
        <div class="pay-row">
          <div class="radios">
            <label class="rlbl"><input type="radio" name="tipoPago" value="enganche"><span class="rc"></span>Enganche</label>
            <label class="rlbl"><input type="radio" name="tipoPago" value="monto"><span class="rc"></span>Monto Inicial</label>
          </div>
          <div class="pay-in">
            <div id="payH" style="color:var(--lt);font-size:.82rem;padding:.55rem 0">â† Selecciona tipo de pago</div>
            <div id="engF" class="fg" style="display:none">
              <label class="lbl req" for="valEng">Enganche</label>
              <!-- Selector de tipo de enganche -->
              <div style="display:flex;gap:.55rem;margin-bottom:.5rem">
                <label class="rlbl" id="engPctLbl" style="font-size:.79rem;padding:.32rem .65rem">
                  <input type="radio" name="engTipo" value="porcentaje" id="engPct" checked>
                  <span class="rc"></span>Porcentaje %
                </label>
                <label class="rlbl" id="engMonLbl" style="font-size:.79rem;padding:.32rem .65rem">
                  <input type="radio" name="engTipo" value="monto_eng" id="engMon">
                  <span class="rc"></span>Monto fijo $
                </label>
              </div>
              <!-- Control % con flechas -->
              <div id="engPctCtrl">
                <div style="display:flex;align-items:center;gap:.5rem">
                  <button type="button" id="engMinus" style="width:34px;height:34px;border-radius:6px;background:var(--bg);border:1.5px solid var(--bd);font-size:1.1rem;font-weight:700;cursor:pointer;color:var(--p);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s" title="Reducir 5%">âˆ’</button>
                  <div style="position:relative;flex:1">
                    <input id="valEng" name="valEng" type="text" placeholder="10%" style="padding-right:2rem;text-align:center;font-weight:600">
                    <span style="position:absolute;right:.75rem;top:50%;transform:translateY(-50%);font-size:.88rem;font-weight:700;color:var(--a);pointer-events:none" id="engPctSym">%</span>
                  </div>
                  <button type="button" id="engPlus" style="width:34px;height:34px;border-radius:6px;background:var(--bg);border:1.5px solid var(--bd);font-size:1.1rem;font-weight:700;cursor:pointer;color:var(--p);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s" title="Aumentar 5%">+</button>
                </div>
                <small style="color:var(--mid);font-size:.67rem;margin-top:.22rem;display:block">Usa las flechas (de 5 en 5) o escribe libremente. El % se agrega automÃ¡ticamente.</small>
              </div>
              <!-- Control monto fijo -->
              <div id="engMonCtrl" style="display:none">
                <div class="cur-wr"><span class="cur-pre">MX$</span>
                  <input id="valEngMonto" name="valEngMonto" type="text" placeholder="0.00" inputmode="decimal">
                </div>
              </div>
              <span class="em" id="evalEng"></span>
            </div>
            <div id="monF" class="fg" style="display:none">
              <label class="lbl req" for="valMon">Monto Inicial</label>
              <div class="cur-wr"><span class="cur-pre">MX$</span>
                <input id="valMon" name="valMon" type="text" placeholder="0.00" inputmode="decimal">
              </div>
              <span class="em" id="evalMon"></span>
            </div>
          </div>
        </div>
      </div>
      <span class="em" id="etipoPago"></span>
    </div>
  </div>
</div><!-- /s3 -->

<!-- â•â•â• S4 â€” DOCUMENTOS Y ENVÃO â•â•â• -->
<div class="sec" id="s4">
  <div class="sec-hdr">
    <div class="sec-ico"><svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/></svg></div>
    <h2 class="sec-title">DOCUMENTOS Y ENVÃO</h2>
  </div>

  <!-- ADJUNTAR DOCUMENTOS -->
  <div class="fg" style="margin-bottom:1.5rem">
    <label class="lbl">Adjuntar Documentos</label>
    <div class="up-area" id="upA">
      <!-- name="documentos[]" para que SubmitForm reciba los archivos -->
      <input type="file" id="upI" name="documentos[]" multiple accept=".pdf,.jpg,.jpeg,.png,.docx">
      <div class="up-main">Arrastra archivos o haz clic para seleccionar</div>
      <div class="up-sub">PDF, JPG, PNG, DOCX Â· MÃ¡x <strong>5 MB</strong> por archivo</div>
    </div>
    <div class="f-list" id="fList"></div>
    <span class="em" id="eupErr"></span>
  </div>

  <!-- RESUMEN -->
  <div class="sumbox" id="sumBox" style="display:none">
    <div class="sum-ttl">RESUMEN DE SOLICITUD</div>
    <div id="sumCont"></div>
  </div>

  <!-- â•â•â• DECLARACIÃ“N JURADA (CHECKBOX OBLIGATORIO) â•â•â• -->
  <div class="decl-box" id="declBox">
    <div class="decl-head">
      DeclaraciÃ³n y AceptaciÃ³n
      <span class="decl-req">Obligatorio</span>
    </div>
    <div class="decl-row" id="declRow" role="checkbox" aria-checked="false" tabindex="0">
      <div class="chk-vis" id="chkVis">
        <svg viewBox="0 0 12 10"><polyline points="1,5 4.5,8.5 11,1"/></svg>
      </div>
      <span class="decl-text">
        Declaro bajo mi exclusiva responsabilidad que toda la informaciÃ³n y los documentos
        proporcionados en esta solicitud son veraces, completos y autÃ©nticos. Al marcar esta
        casilla, ratifico que acepto los tÃ©rminos y condiciones del proceso, y reconozco que
        este acto tiene la misma validez legal que una firma autÃ³grafa.
      </span>
    </div>
    <!-- Campo oculto que se envÃ­a con el formulario -->
    <input type="hidden" id="declVal" name="declaracion_aceptada" value="">
    <span class="em" id="edecl" style="margin-top:.55rem;display:block"></span>
  </div>

</div><!-- /s4 -->

<!-- NAV -->
<div class="nav">
  <button type="button" class="btn btn-p" id="btnPrev" disabled>
    <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>Anterior
  </button>
  <span class="step-ind">Paso <strong id="curS">1</strong> de <strong>4</strong></span>
  <button type="button" class="btn btn-p" id="btnNext">
    Siguiente<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
  </button>
  <button type="submit" class="btn btn-s" id="btnSub" style="display:none">
    <svg viewBox="0 0 24 24" style="width:14px;height:14px;fill:currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>ENVIAR SOLICITUD
  </button>
</div>

</div><!-- /card -->
</form>
</div><!-- /wrap -->

<!-- MODAL Ã‰XITO -->
<div class="modal" id="modal">
  <div class="mbox">
    <div class="m-ico"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg></div>
    <div class="m-t">Â¡Solicitud Enviada!</div>
    <div class="m-m"><strong>Tu solicitud fue enviada con Ã©xito.</strong><br>Nos pondremos en contacto contigo pronto para continuar con tu crÃ©dito vehicular.</div>
    <button class="m-btn" id="mClose">Aceptar</button>
  </div>
</div>

<!-- OVERLAY ENVIANDO -->
<div class="s-ov" id="sOv">
  <div class="s-ring"></div>
  <div class="s-msg">Enviando solicitudâ€¦</div>
</div>

<script>
(function(){
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIGURACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// reCAPTCHA v3
// Site Key:   6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV  (frontend)
// Secret Key: 6Lc9zGUsAAAAAHifaydBuJYHlSEX77P_6zCtACum  (backend â€” NO exponer aquÃ­)
var RECAPTCHA_SITE_KEY = '6Lc9zGUsAAAAAG2K5TAav3VrS9obGfFqXO5cnOkV';

// FormSubmit.co â€” el destino del correo se define en el action del <form>

// COPOMEX â€” CÃ³digo Postal
var CP_TOKEN = '36da398a-1848-44f3-a952-06c9bfb02cc8';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function Q(id){ return document.getElementById(id); }
function V(id){ var e=Q(id); return e?e.value:''; }
function SHOW(id){ Q(id).style.display=''; }
function HIDE(id){ Q(id).style.display='none'; }
function SHOWF(id){ Q(id).style.display='flex'; }

function setErr(id,msg){
  var e=Q('e'+id); if(e) e.textContent=msg;
  var i=Q(id); if(i){ i.classList.add('bad'); i.classList.remove('ok'); }
}
function clrErr(id){
  var e=Q('e'+id); if(e) e.textContent='';
  var i=Q(id); if(i){ i.classList.remove('bad'); if(i.value&&i.value.trim()) i.classList.add('ok'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVEGACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var cur=1, TOTAL=4;

function slideTo(n){
  document.querySelectorAll('.sec').forEach(function(s){ s.classList.remove('active'); });
  Q('s'+n).classList.add('active');
  document.querySelectorAll('.step').forEach(function(s,i){
    s.classList.remove('active','done');
    if(i+1<n) s.classList.add('done');
    if(i+1===n) s.classList.add('active');
  });
  Q('curS').textContent=n;
  Q('btnPrev').disabled=(n===1);
  var last=(n===TOTAL);
  Q('btnNext').style.display=last?'none':'inline-flex';
  Q('btnSub').style.display=last?'inline-flex':'none';
  if(last) buildSummary();
  cur=n;
  window.scrollTo({top:Q('prog').offsetTop-20,behavior:'smooth'});
}

Q('btnNext').addEventListener('click',function(){
  if(validateSection(cur)){ if(cur<TOTAL) slideTo(cur+1); }
  else{ var f=Q('s'+cur).querySelector('.bad'); if(f) f.scrollIntoView({behavior:'smooth',block:'center'}); }
});
Q('btnPrev').addEventListener('click',function(){ if(cur>1) slideTo(cur-1); });
document.querySelectorAll('.step').forEach(function(s){
  s.addEventListener('click',function(){ var t=parseInt(s.dataset.s); if(t<=cur) slideTo(t); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  YEAR SELECTOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var s=Q('anio'), y=new Date().getFullYear();
  for(var i=y;i>=2000;i--){ var o=document.createElement('option'); o.value=i; o.textContent=i; s.appendChild(o); }
})();

// RFC/CURP uppercase
['rfc','curp'].forEach(function(id){
  Q(id).addEventListener('input',function(){ this.value=this.value.toUpperCase(); });
});

// Edad automÃ¡tica
Q('fNac').addEventListener('change',function(){
  if(!this.value){ Q('edad').value=''; return; }
  var b=new Date(this.value),t=new Date(),a=t.getFullYear()-b.getFullYear();
  if(t.getMonth()<b.getMonth()||(t.getMonth()===b.getMonth()&&t.getDate()<b.getDate())) a--;
  Q('edad').value=a>=0?a+' aÃ±os':'';
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CURP â€” solo mayÃºsculas y validaciÃ³n de formato en vSec1
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MARCA â€” mostrar campo "Otra marca" si selecciona Otra
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Q('marca').addEventListener('change',function(){
  var blk=Q('otraMarcaBlk'), inp=Q('otraMarca');
  if(this.value==='Otra'){
    blk.style.display=''; inp.disabled=false; inp.focus();
  } else {
    blk.style.display='none'; inp.disabled=true; inp.value='';
    inp.classList.remove('ok','bad'); var e=Q('eotraMarca'); if(e) e.textContent='';
  }
  clrErr('marca');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ENGANCHE â€” control porcentaje con botones +5/-5 y sÃ­mbolo %
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var ENG_MIN=0, ENG_MAX=100, ENG_STEP=5, ENG_DEFAULT=10;
var engEsPct=true; // true=porcentaje, false=monto fijo

function engGetPct(){
  var raw=V('valEng').replace(/[^0-9.]/g,'');
  var n=parseFloat(raw);
  return isNaN(n)?ENG_DEFAULT:Math.min(ENG_MAX,Math.max(ENG_MIN,n));
}
function engSetPct(n){
  n=Math.min(ENG_MAX,Math.max(ENG_MIN,Math.round(n)));
  Q('valEng').value=n+'%';
  Q('valEng').classList.remove('bad');
  clrErr('valEng');
}
function engFormatInput(){
  var raw=this.value.replace(/[^0-9.]/g,'');
  // Reinserta % al final mientras escribe
  if(raw!=='') this.value=raw+'%';
  else this.value='';
}

Q('engPlus').addEventListener('click',function(){ engSetPct(engGetPct()+ENG_STEP); });
Q('engMinus').addEventListener('click',function(){ engSetPct(engGetPct()-ENG_STEP); });

Q('valEng').addEventListener('input', function(){
  // Permite escritura libre pero siempre mantiene %
  var raw=this.value.replace(/[^0-9.]/g,'');
  var pos=this.selectionStart;
  if(raw!==''){
    this.value=raw+'%';
    // Colocar cursor antes del %
    var newPos=Math.min(pos, raw.length);
    this.setSelectionRange(newPos,newPos);
  }
});
Q('valEng').addEventListener('blur',function(){
  var raw=this.value.replace(/[^0-9.]/g,'');
  if(raw!==''){
    var n=Math.min(ENG_MAX,Math.max(ENG_MIN,parseFloat(raw)||0));
    this.value=n+'%';
  }
});
Q('valEng').addEventListener('focus',function(){
  // Al enfocar, posicionar cursor antes del %
  var len=this.value.replace('%','').length;
  setTimeout(function(){ Q('valEng').setSelectionRange(len,len); },0);
});
// Flechas del teclado en el campo %
Q('valEng').addEventListener('keydown',function(e){
  if(e.key==='ArrowUp'){ e.preventDefault(); engSetPct(engGetPct()+ENG_STEP); }
  if(e.key==='ArrowDown'){ e.preventDefault(); engSetPct(engGetPct()-ENG_STEP); }
});

// Tipo de enganche: % vs monto fijo
document.querySelectorAll('input[name=engTipo]').forEach(function(r){
  r.addEventListener('change',function(){
    engEsPct=(this.value==='porcentaje');
    if(engEsPct){
      Q('engPctCtrl').style.display='';
      Q('engMonCtrl').style.display='none';
      if(!V('valEng')) engSetPct(ENG_DEFAULT);
    } else {
      Q('engPctCtrl').style.display='none';
      Q('engMonCtrl').style.display='';
      Q('valEngMonto').focus();
    }
    clrErr('valEng');
  });
});
Q('estCivil').addEventListener('change',function(){
  var blk=Q('regimenBlk'),sel=Q('regimen');
  if(this.value==='Casado(a)'){ blk.classList.add('open'); sel.disabled=false; }
  else{ blk.classList.remove('open'); sel.disabled=true; sel.value=''; sel.classList.remove('ok','bad'); var e=Q('eregimen'); if(e) e.textContent=''; }
  clrErr('estCivil');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEPENDIENTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var RANGOS=['0â€“5 aÃ±os','6â€“12 aÃ±os','13â€“18 aÃ±os','19+ aÃ±os'];
function buildDepFields(n){
  var c=Q('depAges'); c.innerHTML=''; Q('edepAges').textContent='';
  for(var i=1;i<=n;i++){
    var id='depAge'+i;
    var item=document.createElement('div'); item.className='dep-item';
    item.innerHTML='<label class="dep-lbl" for="'+id+'">Dependiente '+i+'</label>'+
      '<select id="'+id+'" name="'+id+'"><option value="" disabled selected>Rango de edad</option>'+
      RANGOS.map(function(r){return '<option value="'+r+'">'+r+'</option>';}).join('')+
      '<option value="manual">Ingresar edadâ€¦</option></select>'+
      '<input type="number" id="'+id+'M" name="'+id+'M" min="0" max="99" placeholder="Edad exacta" style="display:none;margin-top:.35rem">'+
      '<span class="em" id="e'+id+'"></span>';
    c.appendChild(item);
    (function(sId,mId){
      Q(sId).addEventListener('change',function(){
        if(this.value==='manual'){ SHOW(mId); Q(mId).focus(); } else{ HIDE(mId); Q(mId).value=''; }
      });
    })(id,id+'M');
  }
}
Q('tieneDep').addEventListener('change',function(){
  var blk=Q('depBlk'),num=Q('numDep'); clrErr('tieneDep');
  if(this.value==='Si'){ blk.classList.add('open'); num.disabled=false; }
  else{ blk.classList.remove('open'); num.disabled=true; num.value=''; Q('depAges').innerHTML=''; num.classList.remove('ok','bad'); Q('edepAges').textContent=''; var e=Q('enumDep'); if(e) e.textContent=''; }
});
Q('numDep').addEventListener('change',function(){
  var n=parseInt(this.value); if(n>0) buildDepFields(n); clrErr('numDep');
});

// PAYMENT RADIO
document.querySelectorAll('input[name=tipoPago]').forEach(function(r){
  r.addEventListener('change',function(){
    HIDE('payH');
    if(this.value==='enganche'){
      SHOWF('engF'); HIDE('monF'); Q('valMon').value='';
      // Inicializar porcentaje por defecto si no tiene valor
      if(!V('valEng')) engSetPct(ENG_DEFAULT);
    } else {
      SHOWF('monF'); HIDE('engF'); Q('valEng').value='';
    }
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COPOMEX â€” CÃ³digo Postal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cpClear(){
  HIDE('cpSpin'); Q('cp').disabled=false;
  HIDE('cpErrBox'); Q('cpErrBox').textContent=''; HIDE('cpRetry'); HIDE('cpBadges');
  Q('cpMun').textContent=''; Q('cpEst').textContent=''; Q('cpCiu').textContent=''; HIDE('cpCiuWrap');
  HIDE('colBlk');
  Q('colonia').innerHTML='<option value="" disabled selected>Selecciona tu colonia</option>';
  Q('colonia').classList.remove('ok','bad'); Q('colCnt').textContent='';
  HIDE('colRegLbl'); HIDE('colSel'); Q('colSel').value='';
  Q('hMun').value=''; Q('hEst').value=''; Q('hCiu').value=''; clrErr('cp');
}
function cpFail(msg){
  HIDE('cpSpin'); Q('cp').disabled=false;
  Q('cpErrBox').textContent=msg; SHOW('cpErrBox'); SHOW('cpRetry'); setErr('cp',msg);
}
function cpFetch(cp){
  cpClear(); SHOW('cpSpin'); Q('cp').disabled=true; clrErr('cp');
  fetch('https://api.copomex.com/query/info_cp/'+cp+'?token='+CP_TOKEN)
    .then(function(r){ if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); })
    .then(function(data){
      HIDE('cpSpin'); Q('cp').disabled=false;
      if(!Array.isArray(data)||data.length===0){ cpFail('CÃ³digo postal no encontrado.'); return; }
      var first=data[0];
      if(first.error===true||first.error==='true'){ cpFail(first.error_message||'C.P. no encontrado.'); return; }
      var resp=first.response||{};
      var mun=resp.municipio||'',est=resp.estado||'',ciu=resp.ciudad||'';
      Q('cpMun').textContent=mun||'â€”'; Q('cpEst').textContent=est||'â€”';
      if(ciu){ Q('cpCiu').textContent=ciu; SHOW('cpCiuWrap'); }
      SHOWF('cpBadges');
      Q('hMun').value=mun; Q('hEst').value=est; Q('hCiu').value=ciu;
      var seen={},cols=[];
      data.forEach(function(item){
        if(!item.error&&item.response&&item.response.asentamiento){
          var c=(item.response.asentamiento||'').trim();
          if(c&&!seen[c]){ seen[c]=1; cols.push(c); }
        }
      });
      cols.sort(function(a,b){ return a.localeCompare(b,'es',{sensitivity:'base'}); });
      if(cols.length===0){ cpFail('No se encontraron colonias para este C.P.'); return; }
      var sel=Q('colonia');
      cols.forEach(function(c){ var o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); });
      Q('colCnt').textContent=cols.length+' colonia'+(cols.length!==1?'s':'');
      SHOWF('colBlk');
      Q('cp').classList.add('ok'); Q('cp').classList.remove('bad');
    })
    .catch(function(err){
      HIDE('cpSpin'); Q('cp').disabled=false;
      cpFail(err.message&&err.message.indexOf('HTTP')===0?'Error '+err.message+' al consultar COPOMEX.':'Sin conexiÃ³n con COPOMEX.');
    });
}
function cpTrigger(){
  var v=Q('cp').value.replace(/\D/g,''); Q('cp').value=v;
  if(v.length===5) cpFetch(v);
  else if(v.length>0) setErr('cp','El cÃ³digo postal debe tener 5 dÃ­gitos.');
}
Q('cp').addEventListener('blur',cpTrigger);
Q('cp').addEventListener('keydown',function(e){ if(e.key==='Enter'){ e.preventDefault(); cpTrigger(); } });
Q('cp').addEventListener('input',function(){
  var raw=this.value.replace(/\D/g,'').slice(0,5);
  if(this.value!==raw) this.value=raw;
  cpClear(); this.classList.remove('ok','bad');
});
Q('cpRetry').addEventListener('click',function(){ var v=Q('cp').value.replace(/\D/g,''); if(v.length===5) cpFetch(v); });
Q('colonia').addEventListener('change',function(){
  if(this.value){
    this.classList.add('ok'); this.classList.remove('bad');
    Q('colSel').value=this.value; SHOW('colRegLbl'); SHOW('colSel'); clrErr('colonia');
  } else{ Q('colSel').value=''; HIDE('colRegLbl'); HIDE('colSel'); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHECKBOX DE DECLARACIÃ“N JURADA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var declChecked=false;

function toggleDecl(){
  declChecked=!declChecked;
  var vis=Q('chkVis'), box=Q('declBox'), row=Q('declRow');
  if(declChecked){
    vis.classList.add('on');
    box.classList.add('ok'); box.classList.remove('bad');
    Q('declVal').value='Acepto';
    row.setAttribute('aria-checked','true');
    var e=Q('edecl'); if(e) e.textContent='';
  } else{
    vis.classList.remove('on');
    box.classList.remove('ok');
    Q('declVal').value='';
    row.setAttribute('aria-checked','false');
  }
}

Q('declRow').addEventListener('click', toggleDecl);
Q('declRow').addEventListener('keydown',function(e){
  if(e.key===' '||e.key==='Enter'){ e.preventDefault(); toggleDecl(); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VALIDACIONES POR SECCIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function isEmpty(v){ return !v||!String(v).trim(); }
function isName(v){ return /^[a-zÃ¡Ã©Ã­Ã³ÃºÃ¼Ã±A-ZÃÃ‰ÃÃ“ÃšÃœÃ‘\s]{2,}$/.test((v||'').trim()); }
function isEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v||'').trim()); }
function isTel(v){ return /^\d{7,15}$/.test((v||'').replace(/\D/g,'')); }

function validateSection(n){
  if(n===1) return vSec1();
  if(n===2) return vSec2();
  if(n===3) return vSec3();
  if(n===4) return vSec4();
  return true;
}

function vSec1(){
  var ok=true;
  function req(id,msg){ if(isEmpty(V(id))){ setErr(id,msg||'Campo requerido.'); ok=false; } else clrErr(id); }
  function chk(id,fn,msg){ if(!fn(V(id))){ setErr(id,msg); ok=false; } else clrErr(id); }

  chk('pNombre',isName,'Solo letras y espacios, mÃ­n. 2 caracteres.');
  chk('pApellido',isName,'Solo letras y espacios, mÃ­n. 2 caracteres.');
  chk('sApellido',isName,'Solo letras y espacios, mÃ­n. 2 caracteres.');
  req('genero','Selecciona una opciÃ³n.');

  if(isEmpty(V('fNac'))){ setErr('fNac','Selecciona tu fecha de nacimiento.'); ok=false; }
  else{
    var b=new Date(V('fNac')),t=new Date(),a=t.getFullYear()-b.getFullYear();
    if(t.getMonth()<b.getMonth()||(t.getMonth()===b.getMonth()&&t.getDate()<b.getDate())) a--;
    if(a<18){ setErr('fNac','Debes ser mayor de 18 aÃ±os.'); ok=false; } else clrErr('fNac');
  }

  req('estCivil','Selecciona tu estado civil.');
  if(V('estCivil')==='Casado(a)') req('regimen','Selecciona el rÃ©gimen matrimonial.');

  if(!/^[A-ZÃ‘&]{3,4}\d{6}[A-Z0-9]{3}$/.test(V('rfc').toUpperCase())){ setErr('rfc','Formato invÃ¡lido. Ej: ABC123456XYZ'); ok=false; } else clrErr('rfc');

  var cv=V('curp').toUpperCase();
  if(!/^[A-Z]{4}\d{6}[HM][A-Z]{5}[A-Z0-9]{2}$/.test(cv)){ setErr('curp','Formato invÃ¡lido. Ej: ABCD123456HDFLRN01'); ok=false; } else clrErr('curp');

  req('tieneDep','Indica si tienes dependientes econÃ³micos.');
  if(V('tieneDep')==='Si'){
    req('numDep','Indica el nÃºmero de dependientes.');
    var n=parseInt(V('numDep'));
    if(n>0){
      var allOk=true;
      for(var i=1;i<=n;i++){
        var sId='depAge'+i,mId='depAge'+i+'M',sEl=Q(sId),mEl=Q(mId);
        if(!sEl) continue;
        if(sEl.value==='manual'){
          if(isEmpty(mEl?mEl.value:'')){ var e1=Q('e'+sId); if(e1) e1.textContent='Ingresa la edad.'; sEl.classList.add('bad'); allOk=false; }
          else{ var e2=Q('e'+sId); if(e2) e2.textContent=''; sEl.classList.remove('bad'); }
        } else if(isEmpty(sEl.value)){
          var e3=Q('e'+sId); if(e3) e3.textContent='Selecciona un rango.'; sEl.classList.add('bad'); allOk=false;
        } else{ var e4=Q('e'+sId); if(e4) e4.textContent=''; sEl.classList.remove('bad'); sEl.classList.add('ok'); }
      }
      if(!allOk){ Q('edepAges').textContent='Completa la edad de todos los dependientes.'; ok=false; }
      else Q('edepAges').textContent='';
    }
  }

  if(!/^\d{5}$/.test(V('cp').trim())){ setErr('cp','Ingresa un C.P. de 5 dÃ­gitos.'); ok=false; } else clrErr('cp');
  if(Q('colBlk').style.display!=='none'){
    if(isEmpty(V('colonia'))){ setErr('colonia','Selecciona una colonia.'); ok=false; } else clrErr('colonia');
  }
  return ok;
}

function vSec2(){
  var ok=true;
  function chk(id,fn,msg){ if(!fn(V(id))){ setErr(id,msg); ok=false; } else clrErr(id); }
  function req(id){ if(isEmpty(V(id))){ setErr(id,'Campo requerido.'); ok=false; } else clrErr(id); }
  [['f1n','f1t','f1e','f1d'],['f2n','f2t','f2e','f2d'],['a1n','a1t','a1e','a1d'],['a2n','a2t','a2e','a2d']].forEach(function(g){
    chk(g[0],isName,'Nombre invÃ¡lido.'); chk(g[1],isTel,'TelÃ©fono invÃ¡lido (7-15 dÃ­gitos).');
    chk(g[2],isEmail,'Correo invÃ¡lido.'); req(g[3]);
  });
  return ok;
}

function vSec3(){
  var ok=true;
  function req(id,msg){ if(isEmpty(V(id))){ setErr(id,msg||'Campo requerido.'); ok=false; } else clrErr(id); }
  req('marca','Selecciona la marca.');
  // Si eligiÃ³ "Otra", validar campo libre
  if(V('marca')==='Otra'){
    if(isEmpty(V('otraMarca'))){ setErr('otraMarca','Escribe la marca del vehÃ­culo.'); ok=false; } else clrErr('otraMarca');
  }
  req('version','Ingresa la versiÃ³n.'); req('anio','Selecciona el aÃ±o.');
  var c=parseFloat(V('costo').replace(/[^0-9.]/g,''));
  if(!c||c<=0){ setErr('costo','Ingresa el costo del vehÃ­culo.'); ok=false; } else clrErr('costo');
  var tp=document.querySelector('input[name=tipoPago]:checked');
  if(!tp){ setErr('tipoPago','Selecciona el tipo de pago inicial.'); ok=false; }
  else{
    clrErr('tipoPago');
    if(tp.value==='enganche'){
      // Validar segÃºn sub-tipo seleccionado
      var ePct=document.querySelector('input[name=engTipo]:checked');
      var esTipo=(ePct&&ePct.value==='porcentaje')||engEsPct;
      if(esTipo){
        var pctRaw=V('valEng').replace(/[^0-9.]/g,'');
        if(isEmpty(pctRaw)||parseFloat(pctRaw)<=0){ setErr('valEng','Ingresa el porcentaje de enganche.'); ok=false; } else clrErr('valEng');
      } else {
        var mE=parseFloat(V('valEngMonto').replace(/[^0-9.]/g,''));
        if(!mE||mE<=0){ setErr('valEng','Ingresa el monto del enganche.'); ok=false; } else clrErr('valEng');
      }
    }
    else{ var m=parseFloat(V('valMon').replace(/[^0-9.]/g,'')); if(!m||m<=0){ setErr('valMon','Ingresa el monto inicial.'); ok=false; } else clrErr('valMon'); }
  }
  return ok;
}

// SecciÃ³n 4: valida que el checkbox estÃ© marcado
function vSec4(){
  if(!declChecked){
    var e=Q('edecl'); if(e) e.textContent='Debes aceptar la declaraciÃ³n para poder enviar la solicitud.';
    Q('declBox').classList.add('bad'); Q('declBox').classList.remove('ok');
    Q('declRow').scrollIntoView({behavior:'smooth',block:'center'});
    return false;
  }
  var e=Q('edecl'); if(e) e.textContent='';
  Q('declBox').classList.remove('bad');
  return true;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESUMEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSummary(){
  var tp=document.querySelector('input[name=tipoPago]:checked');
  var pago='â€”';
  if(tp){
    if(tp.value==='enganche'){
      var ePct=document.querySelector('input[name=engTipo]:checked');
      var esTipo=(ePct&&ePct.value==='porcentaje')||engEsPct;
      pago=esTipo?'Enganche: '+V('valEng'):'Enganche: MX$'+V('valEngMonto');
    } else {
      pago='Monto Inicial: MX$'+V('valMon');
    }
  }
  var marcaFinal=V('marca')==='Otra'?'Otra ('+V('otraMarca')+')':V('marca');
  var depStr='No';
  if(V('tieneDep')==='Si'){
    var nd=parseInt(V('numDep'))||0;
    if(nd>0){
      var ages=[];
      for(var i=1;i<=nd;i++){
        var sv=V('depAge'+i),mv=V('depAge'+i+'M');
        ages.push('Dep.'+i+': '+(sv==='manual'?(mv+' aÃ±os'):sv));
      }
      depStr='SÃ­ ('+nd+') â€” '+ages.join(', ');
    } else depStr='SÃ­';
  }
  var rows=[
    ['Nombre',[V('pNombre'),V('sNombre'),V('pApellido'),V('sApellido')].filter(Boolean).join(' ')],
    ['GÃ©nero',V('genero')],['F. Nacimiento',V('fNac')],
    ['Estado Civil',V('estCivil')],
    ['RÃ©gimen Matrimonial',V('estCivil')==='Casado(a)'?V('regimen'):'N/A'],
    ['Dependientes',depStr],
    ['RFC',V('rfc')],['CURP',V('curp')],
    ['C.P.',V('cp')],['Colonia',V('colSel')||V('colonia')],
    ['Municipio',V('hMun')],['Estado',V('hEst')],
    null,
    ['Marca',marcaFinal],['VersiÃ³n',V('version')],['AÃ±o',V('anio')],
    ['Costo','MX$ '+V('costo')],['Pago Inicial',pago]
  ];
  Q('sumCont').innerHTML=rows.map(function(r){
    if(!r) return '<hr class="sum-sep">';
    return '<div class="sum-row"><span class="sum-k">'+r[0]+':</span><span>'+r[1]+'</span></div>';
  }).join('');
  Q('sumBox').style.display='block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UPLOAD (UI visual â€” los archivos van en el input name="documentos[]")
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var upFiles=[];
var upA=Q('upA'),upI=Q('upI'),fL=Q('fList');
upA.addEventListener('dragover',function(e){e.preventDefault();upA.classList.add('drag');});
upA.addEventListener('dragleave',function(){upA.classList.remove('drag');});
upA.addEventListener('drop',function(e){
  e.preventDefault(); upA.classList.remove('drag');
  doFiles(e.dataTransfer.files);
});
upI.addEventListener('change',function(){ doFiles(upI.files); upI.value=''; });

function doFiles(fl){
  var errs=[];
  Array.from(fl).forEach(function(f){
    if(upFiles.some(function(x){return x.name===f.name;})) return;
    var ext='.'+f.name.split('.').pop().toLowerCase();
    if(!['.pdf','.jpg','.jpeg','.png','.docx'].includes(ext)){errs.push('"'+f.name+'" tipo no permitido.');return;}
    if(f.size>5242880){errs.push('"'+f.name+'" supera 5 MB.');return;}
    upFiles.push(f);
    var d=document.createElement('div'); d.className='f-item';
    d.innerHTML='<span>ğŸ“„</span><span class="f-nm">'+f.name+'</span><span class="f-sz">'+fmtSz(f.size)+'</span><span class="f-ok">âœ“</span><button type="button" class="f-rm" title="Eliminar">âœ•</button>';
    d.querySelector('.f-rm').addEventListener('click',function(){upFiles=upFiles.filter(function(x){return x.name!==f.name;});d.remove();});
    fL.appendChild(d);
  });
  var eu=Q('eupErr');
  if(errs.length){eu.textContent=errs.join(' ');eu.style.display='block';} else eu.style.display='none';
}
function fmtSz(b){return b<1048576?(b/1024).toFixed(0)+' KB':(b/1048576).toFixed(1)+' MB';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT â€” reCAPTCHA v3 + SubmitForm (multipart con archivos)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Q('frm').addEventListener('submit',function(e){
  e.preventDefault();

  // Validar todas las secciones antes de enviar
  for(var s=1;s<=TOTAL;s++){
    if(!validateSection(s)){
      if(s!==cur) slideTo(s);
      return;
    }
  }

  // Mostrar overlay y deshabilitar botÃ³n
  Q('sOv').classList.add('on');
  Q('btnSub').disabled=true;

  // Obtener token reCAPTCHA v3 y luego enviar
  if(typeof grecaptcha!=='undefined'){
    grecaptcha.ready(function(){
      grecaptcha.execute(RECAPTCHA_SITE_KEY,{action:'submit_credito_ava'})
        .then(function(token){ Q('rcToken').value=token; submitForm(); })
        .catch(function(){ submitForm(); }); // continÃºa aunque reCAPTCHA falle
    });
  } else {
    submitForm(); // fallback si reCAPTCHA no carga
  }
});

function submitForm(){
  var fd=new FormData(Q('frm'));

  // Agregar archivos adjuntos (drag & drop) al FormData
  upFiles.forEach(function(f,i){
    fd.append('adjunto_'+(i+1), f, f.name);
  });

  // Subject dinÃ¡mico con nombre del solicitante
  var nm=[V('pNombre'),V('sNombre'),V('pApellido'),V('sApellido')].filter(Boolean).join(' ').replace(/\s+/,' ').trim();
  fd.set('_subject','Solicitud CrÃ©dito Vehicular AVA â€” '+nm);

  // FormSubmit.co: POST multipart â†’ redirige a pÃ¡gina de confirmaciÃ³n
  // Usamos fetch con redirect:'follow'; el Ã©xito se detecta por status 200/ok
  fetch(Q('frm').action,{
    method:'POST',
    body:fd,
    redirect:'follow'
  })
  .then(function(r){
    Q('sOv').classList.remove('on');
    Q('btnSub').disabled=false;
    // FormSubmit.co retorna 200 al redirigir a su pÃ¡gina de agradecimiento
    if(r.ok||r.redirected||r.status===200||r.status===302){
      Q('modal').classList.add('on');
    } else {
      alert('Hubo un problema al enviar (cÃ³digo '+r.status+'). Intenta de nuevo.');
    }
  })
  .catch(function(){
    Q('sOv').classList.remove('on');
    Q('btnSub').disabled=false;
    alert('Error al enviar la solicitud. Verifica tu conexiÃ³n e intenta de nuevo.');
  });
}

// MODAL
Q('mClose').addEventListener('click',function(){Q('modal').classList.remove('on');});
Q('modal').addEventListener('click',function(e){if(e.target===this)this.classList.remove('on');});
document.addEventListener('keydown',function(e){if(e.key==='Escape')Q('modal').classList.remove('on');});

// INIT
slideTo(1);

})();
</script>
</body>
</html>
